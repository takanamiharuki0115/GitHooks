//@ts-disabled-nocheck

// 2308
// alter table frdcall_admins add column sms_pw varchar(255) default "";
// alter table frdcall_admins add index sms_id_ind(sms_id);
// alter table frdcall_admins add index sms_pw_ind(sms_pw);

// alter table sms_url_list add index replied_users_ind(replied_users(768));

import _configs from "./config"

const configs = {
    smsMode: "dryrun", // "dryrun" || "real"
    smsUrl: "https://www.sms-console.jp/api/",
    smsUser: "ademo-account-2956-u",
    smsPassword: "aH23AfdSe",
    smsRedirectPrefix: "https://ds-calldevel.frd.cloud/api/redirect",
    redisHost: "127.0.0.1",
    redisPort: 27509,
    sharedKey: "7dbb72ae21b1b5a81b855cc7e310ae6547ad88102b231f416cdb31b744b1115d0de454ae93205048d2b407edc2a0080031c3895d27b02a7dced54e42998369149e8e8987e7e0f9de8f88a0cfffefca098f8ffdef883e8f8f8f8f8f8f8f8f8f8f8f",
    baseDir: "/srv/frontend",
    publicDirPrefix: "/srv/frontend/dist/client",
    downloadDirPrefix: "/srv/frontend/downloads",
    uploadDirPrefix: "/srv/frontend/uploads",
    frdcUrl: "https://op.ai-devel.frd.cloud",
    frdcMySQLHost: "ai-devel.frd.cloud",
    frdcMySQLPort: 6033,
    frdcMySQLUser: "crm",
    frdcMySQLPass: "crm",
    frdcMySQLDB: _configs.ctiDBName,
    CRMMySQLHost: _configs.crmDomain,
    CRMMySQLPort: 6033,
    CRMMySQLUser: "crm",
    CRMMySQLPass: "crm",
    CRMMySQLDB: _configs.crmDBName,
    OPCBasePath: "/srv/frontend/htdocs/opc",
    // 各要素の0番目がパス、1番目がデフォルト値
    excludedStates: [
        ["/userprofile/userIcon", ""],
        ["/layoutData", ""],
    ],
    ttsPath: "/var/spool/asterisk/monitorDONE/TXT",
    mp3Path: "/var/spool/asterisk/monitorDONE/MP3",
    sfSecurityToken: "HjYU5MUT6d1USPpTwtEWEq236",
    smSecurityToken: "Bearer 17c25f2e-5a9e-11ee-8c99-0242ac120002",
    smBaseUrl: "https://external.sales-marker.jp",
    queryDesc: {
        q0000_orig: `
        SELECT avg(call_per_day) call_per_day, avg(significant_call_per_day) significant_call_per_day, avg(talk_time_per_call) talk_time_per_call
        FROM(
          SELECT avg(cnt) call_per_day, avg(sig) significant_call_per_day, SUM(talk)/SUM(res_call) talk_time_per_call
          FROM (
          SELECT 
            SUM(IF(cst.status IS NOT NULL,al.talk_sec,0)) talk, 
            count(fl.uniqueid) cnt, 
            SUM(if(al.talk_sec <> 0 AND cst.status IS NOT NULL, 1, 0)) res_call, 
            SUM(if(cst.category ='有効通話', 1, 0)) sig
          FROM frdcall_log fl
          LEFT JOIN frdcall_agent_log al
          ON fl.uniqueid = al.uniqueid
          LEFT JOIN frdcall_campaign_statuses cst
          ON fl.status = cst.status
          AND fl.campaign_id = cst.campaign_id
          LEFT JOIN frdcall_statuses st
          ON fl.status = st.status
          WHERE fl.campaign_id IN ('#P:0#')
          AND fl.call_date > (NOW() - INTERVAL 1 MONTH)
          AND (st.status IN('A','AA','AB','ADC','ADCT','B','DNC','N','NA','DROP','PDROP','PM','PU','QUEUE','AFTHRS','TIMEOT','XFER','INCALL','WBFORM','SVYCLM') OR st.status IS NULL )
          AND (st.status IS NOT NULL OR cst.status IS NOT NULL)
          GROUP BY fl.campaign_id,YEAR(fl.call_date),MONTH(fl.call_date),DAY(fl.call_date)
          )a
        )b
        `,
        q0000: `
        SELECT avg(call_per_day) call_per_day, avg(significant_call_per_day) significant_call_per_day, avg(talk_time_per_call) talk_time_per_call
        FROM(
          SELECT avg(cnt) call_per_day, avg(sig) significant_call_per_day, SUM(talk)/SUM(res_call) talk_time_per_call
          FROM (
          SELECT 
            SUM(IF(cst.status IS NOT NULL,al.length_in_sec,0)) talk, 
            count(fl.uniqueid) cnt, 
            SUM(if(al.length_in_sec <> 0 AND cst.status IS NOT NULL, 1, 0)) res_call, 
            SUM(if(cst.category ='有効通話', 1, 0)) sig
          FROM frdcall_log fl
          LEFT JOIN recording_log al ON fl.uniqueid = al.uniqueid
          LEFT JOIN frdcall_campaign_statuses cst
          ON fl.status = cst.status
          AND fl.campaign_id = cst.campaign_id
          LEFT JOIN frdcall_statuses st
          ON fl.status = st.status
          WHERE fl.campaign_id IN ('#P:0#')
          AND fl.call_date > (NOW() - INTERVAL 1 MONTH)
          AND (st.status IN('A','AA','AB','ADC','ADCT','B','DNC','N','NA','DROP','PDROP','PM','PU','QUEUE','AFTHRS','TIMEOT','XFER','INCALL','WBFORM','SVYCLM') OR st.status IS NULL )
          AND (st.status IS NOT NULL OR cst.status IS NOT NULL)
          GROUP BY fl.campaign_id,YEAR(fl.call_date),MONTH(fl.call_date),DAY(fl.call_date)
          )a
        )b
        `,
        q0001: `SELECT al.remark FROM frdcall_agent_log al WHERE al.agent_log_id = "#P:0#";`,
        q0002: `SELECT al.remark FROM frdcall_agent_log al inner join frdcall_list l on al.lead_id=l.lead_id WHERE l.phone_number="#P:0#" and al.agent_log_id = "#P:1#";`,
        q0003: `UPDATE frdcall_log SET processed="R" where uniqueid="#P:0#" and LOWER(campaign_id)=LOWER("#P:1#") and list_id="#P:2#" and user="#P:3#" LIMIT 1`,
        q0004: `UPDATE frdcall_log SET callback_time="#P:0#" where uniqueid="#P:1#" and LOWER(campaign_id)=LOWER("#P:2#") and list_id="#P:3#" and user="#P:4#" LIMIT 1`,
        q0005: `UPDATE frdcall_agent_log SET remark="#P:0#" where agent_log_id=#P:1# LIMIT 1`,
        q0006: `
            SELECT DISTINCT l.*,IFNULL(rl.length_in_sec, 0) length_in_sec,u.full_name,rl.dispo_form->>"$[0]" AS form,rl.filename AS filename
            FROM (SELECT * FROM frdcall_agent_log WHERE lead_id="#P:0#")  l 
            LEFT JOIN (SELECT * FROM recording_log WHERE lead_id="#P:0#" AND uniqueid <> '' GROUP BY uniqueid, user ) rl 
            ON l.uniqueid=rl.uniqueid AND l.user = rl.user
            inner join frdcall_users u on l.user=u.user
            order by l.agent_log_id desc`,
        q0007: `
            SELECT DISTINCT l.*, rl.length_in_sec AS length_in_sec2, leads.last_name, leads.first_name, leads.title, list.list_name
            FROM (
                SELECT * FROM frdcall_log
                WHERE uniqueid <> "" AND call_date > DATE_SUB(CURRENT_DATE, INTERVAL 3 MONTH) AND campaign_id="#P:0#" AND list_id IN (#P:1#) AND user="#P:2#"
            )l
            INNER JOIN (SELECT list_id, lead_id, last_name, first_name, title FROM frdcall_list WHERE list_id IN (#P:1#) ) leads ON leads.lead_id=l.lead_id
            INNER JOIN frdcall_lists list ON l.list_id=list.list_id
            LEFT JOIN (SELECT uniqueid, length_in_sec FROM recording_log WHERE start_time > DATE_SUB(CURRENT_DATE, INTERVAL 3 MONTH) ) rl ON l.uniqueid=rl.uniqueid
            ORDER BY l.call_date desc
            `,
        q0008: `
            SELECT DISTINCT l.*, rl.length_in_sec AS length_in_sec2, leads.last_name, leads.first_name, leads.title, list.list_name
            FROM (
                SELECT *
                FROM frdcall_closer_log USE INDEX(user)
                WHERE uniqueid <> "" AND list_id IN (#P:1#) AND user="#P:2#" AND call_date > DATE_SUB(CURRENT_DATE, INTERVAL 3 MONTH)
                AND (SELECT closer_campaigns FROM frdcall_campaigns WHERE campaign_id="#P:0#" LIMIT 1) RLIKE campaign_id
            ) l
            INNER JOIN (SELECT list_id, lead_id, last_name, first_name, title FROM frdcall_list WHERE list_id IN (#P:1#) ) leads ON leads.lead_id=l.lead_id
            INNER JOIN frdcall_lists list ON l.list_id=list.list_id
            LEFT JOIN (SELECT uniqueid, length_in_sec FROM recording_log WHERE start_time > DATE_SUB(CURRENT_DATE, INTERVAL 3 MONTH) ) rl ON l.uniqueid=rl.uniqueid
            ORDER BY l.call_date DESC
        `,
        q0009: `select status from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") order by item_order`,
        q0010: `SELECT count(*) \`count\` FROM frdcall_dnc where phone_number="#P:0#"`,
        q0011: `INSERT IGNORE INTO frdcall_campaign_dnc (phone_number, campaign_id) VALUES ("#P:0#","#P:1#");`,
        q0012: `DELETE FROM frdcall_campaign_dnc WHERE phone_number = "#P:0#" AND campaign_id = "#P:1#" LIMIT 1`,
        q0013: `UPDATE frdcall_list SET called_count=called_count+1, last_local_call_time=NOW(), called_since_last_reset="Y", modify_date=NOW() WHERE lead_id="#P:0#" LIMIT 1`,
        q0014: `DELETE FROM frdcall_hopper WHERE LOWER(campaign_id)=LOWER("#P:0#") AND lead_id="#P:1#" LIMIT 1`,
        q0015: `
        SELECT DISTINCT f.formbuilderid,f.name,cf_940,"" AS "promiseName","" AS "formid"

        FROM frd_campaignscf ccf
        
        INNER JOIN frd_formbuildercf fcf
            ON JSON_VALID(fcf.extra_configs) = 1
            AND LOWER(fcf.extra_configs->>"$[*].campid") RLIKE LOWER('"#P:0#"')
            AND (LENGTH("#P:1#") > 0 AND fcf.extra_configs ->> "$[*].dispoid[*]" RLIKE '"#P:2#"|"<ALL>"')

        INNER JOIN frd_formbuilder f
            ON f.formbuilderid=fcf.formbuilderid
            
        WHERE JSON_VALID(fcf.extra_configs) = 1
            AND LOWER(fcf.extra_configs->>"$[*].campid") RLIKE LOWER('"#P:3#"')
            AND (LENGTH("#P:4#") > 0 AND fcf.extra_configs ->> "$[*].dispoid[*]" RLIKE '"#P:5#"|"<ALL>"') `,
        q0016: `SELECT campaign_allow_inbound FROM frdcall_campaigns WHERE campaign_id="#P:0#"`,
        q0017: `UPDATE frdcall_list SET #P:0#, modify_date=NOW() WHERE lead_id=#P:1# LIMIT 1`,
        q0018: `UPDATE frdcall_list_extend SET extend_col='#P:0#' WHERE lead_id=#P:1# LIMIT 1`,
        q0019: `select l.*,ex.extend_col from frdcall_lists ls inner join frdcall_list l on l.lead_id=#P:0# AND ls.list_id=l.list_id left join frdcall_list_extend ex on l.lead_id=ex.lead_id where ls.active='Y' and l.lead_id=#P:1# limit 1`,
        q0020: `select l.*,ex.extend_col from frdcall_lists ls inner join frdcall_list l on l.lead_id=#P:0# AND ls.list_id=l.list_id left join frdcall_list_extend ex on l.lead_id=ex.lead_id where ls.active='Y' and l.lead_id=#P:1# limit 1`,
        q0021: `select l.*,ex.extend_col from frdcall_lists ls inner join frdcall_list l on l.phone_number="#P:0#" AND ls.list_id=l.list_id left join frdcall_list_extend ex on l.lead_id=ex.lead_id where ls.active='Y' and l.phone_number="#P:1#" and ls.campaign_id="#P:2#" limit 1`,
        q0022: `select list_id, list_name, campaign_id, list_description from frdcall_lists where active='Y' and campaign_id="#P:0#"`,
        q0023: `select ls.list_id, count(ls.list_id) as "count" from frdcall_lists ls inner join frdcall_list l ON ls.list_id=l.list_id where ls.active='Y' and campaign_id="#P:0#" group by ls.list_id order by ls.list_id`,
        q0024: `select clcf.leadid,tl.lead_id,clcf.cf_1159->>"$.formData" from #P:0#.frdcall_list tl inner join #P:1#.frd_leadscf clcf on clcf.cf_1159->>"$.leadId"=tl.lead_id where JSON_VALID(clcf.cf_1159)=1 and JSON_KEYS(clcf.cf_1159->>"$.formData") is not null and JSON_KEYS(clcf.cf_1159->>"$.formData") rlike '(#P:2#)' #P:3#`,
        q0025: `select l.*,ex.extend_col from frdcall_lists ls inner join frdcall_list l ON l.list_id=#P:0# #P:1# AND ls.list_id=l.list_id left join frdcall_list_extend ex on l.lead_id=ex.lead_id where ls.active='Y' and l.list_id=#P:0# #P:1# #P:2# #P:3# #P:4# order by l.lead_id`,
        q0026: `SELECT DISTINCT value, label FROM(SELECT main.status as value, CONCAT(main.status, " - ", main.status_name) as label, ext.item_order FROM frdcall_campaign_statuses main LEFT JOIN frdcall_campaign_statuses_ext ext ON main.status=ext.status AND main.campaign_id=ext.campaign_id WHERE main.campaign_id = '#P:0#' AND main.selectable = 'Y' UNION ALL SELECT status as value, CONCAT(status, " - ", status_name) as label, 999 AS item_order FROM frdcall_statuses WHERE selectable = 'Y')a ORDER BY item_order, value`,
        q0027: `SELECT DISTINCT value, label FROM(SELECT main.status as value, CONCAT(main.status, " - ", main.status_name) as label, ext.item_order FROM frdcall_campaign_statuses main LEFT JOIN frdcall_campaign_statuses_ext ext ON main.status=ext.status AND main.campaign_id=ext.campaign_id WHERE main.campaign_id = '#P:0#' AND main.selectable = 'Y' AND main.sale = 'Y' UNION ALL SELECT status as value, CONCAT(status, " - ", status_name) as label, 999 AS item_order FROM frdcall_statuses WHERE selectable = 'Y' AND sale = 'Y')a ORDER BY item_order, value`,
        q0028: `SELECT DISTINCT value, label FROM(SELECT main.status as value, CONCAT(main.status, " - ", main.status_name) as label, ext.item_order FROM frdcall_campaign_statuses main LEFT JOIN frdcall_campaign_statuses_ext ext ON main.status=ext.status AND main.campaign_id=ext.campaign_id WHERE main.campaign_id = '#P:0#' AND main.selectable = 'Y' AND main.dnc = 'Y' UNION ALL SELECT status as value, CONCAT(status, " - ", status_name) as label, 999 AS item_order FROM frdcall_statuses WHERE selectable = 'Y' AND dnc = 'Y')a ORDER BY item_order, value`,
        q0029: `SELECT
        a.formbuilderid,
        a.name,
        b.extra_configs->>"$[*].campid" AS campids,
        b.extra_configs->>"$[*].dispoid" AS dispoids,
        j.*
        FROM
            frd_formbuildercf b
            JOIN frd_formbuilder a ON a.formbuilderid = b.formbuilderid
            JOIN JSON_TABLE(
                urldecode(b.cf_940),
                "$[*]" COLUMNS(
                    access BOOLEAN PATH "$.access", classname TEXT PATH "$.className", description_ TEXT PATH "$.description",
                    inline BOOLEAN PATH "$.inline", label TEXT PATH "$.label", max INT PATH "$.max",
                    maxlength INT PATH "$.maxlength", min INT PATH "$.min", multiple BOOLEAN PATH "$.multiple",
                    name_ TEXT PATH "$.name", other BOOLEAN PATH "$.other", placeholder TEXT PATH "$.placeholder",
                    required BOOLEAN PATH "$.required", step INT PATH "$.step", style TEXT PATH "$.style",
                    subtype TEXT PATH "$.subtype", toggle BOOLEAN PATH "$.toggle", type_ TEXT PATH "$.type",
                    values_ JSON PATH "$.values"
                )
            ) AS j
        WHERE
            JSON_VALID(urldecode(b.cf_940)) = 1 and JSON_VALID(b.extra_configs) = 1 AND (LOWER(b.extra_configs->>"$[*].campid") RLIKE '"#P:0#"' OR b.extra_configs->>"$[*].campid" RLIKE '"<ALL>"')
            AND j.type_ NOT IN ("button", "header", "paragraph"); `,
        q0030: `SELECT \`#P:0#\` FROM #P:1# WHERE \`#P:2#\` = '#P:3#' #P:4# LIMIT 1`,
        q0031: `UPDATE #P:0# SET \`#P:1#\`='#P:5#' WHERE \`#P:2#\` = '#P:3#' #P:4# LIMIT 1`,
        q0032: `UPDATE #P:0# SET category='#P:1#' WHERE status = '#P:2#' #P:3# LIMIT 1`,
        q0033: `SELECT tts_voice FROM frdcall_tts_prompts where tts_name="#P:0#" and tts_text = "#P:1#"`,
        q0034: `SELECT extension, fullname
        FROM phones a
        INNER JOIN (
          SELECT frdcall_user_groups.admin_viewable_groups 
          FROM (
            SELECT user_group 
            FROM frdcall_users 
            WHERE user= "#P:0#"
          )AS frdcall_users 
          LEFT JOIN frdcall_user_groups 
          ON frdcall_users.user_group = frdcall_user_groups.user_group
        )AS b 
        ON (
            LOCATE('-ALL-', b.admin_viewable_groups) BETWEEN 1 AND 5
            OR LOCATE(CONCAT(' ', a.user_group, ' '), b.admin_viewable_groups) > 0
            )
            AND a.user_group <> ""
        ORDER BY extension`,
        q0035: `SELECT carrier_id, carrier_name, carrier_description, globals_string
        FROM frdcall_server_carriers a
        INNER JOIN (
          SELECT frdcall_user_groups.admin_viewable_groups 
          FROM (
            SELECT user_group 
            FROM frdcall_users 
            WHERE user= "#P:0#"
          )AS frdcall_users 
          LEFT JOIN frdcall_user_groups 
          ON frdcall_users.user_group = frdcall_user_groups.user_group
        )AS b 
        ON LOCATE('-ALL-', b.admin_viewable_groups) BETWEEN 1 AND 5
        OR LOCATE(CONCAT(' ', a.user_group, ' '), b.admin_viewable_groups) > 0
        WHERE globals_string <>"" AND globals_string IS NOT NULL AND active="Y" 
        ORDER BY carrier_description`,
        q0036: `SELECT group_id, group_name
        FROM frdcall_inbound_groups a
        INNER JOIN (
          SELECT frdcall_user_groups.admin_viewable_groups 
          FROM (
            SELECT user_group 
            FROM frdcall_users 
            WHERE user= "#P:0#"
          )AS frdcall_users 
          LEFT JOIN frdcall_user_groups 
          ON frdcall_users.user_group = frdcall_user_groups.user_group
        )AS b 
        ON LOCATE('-ALL-', b.admin_viewable_groups) BETWEEN 1 AND 5
        OR LOCATE(CONCAT(' ', a.user_group, ' '), b.admin_viewable_groups) > 0
        WHERE group_id <> 'OPERATORQUE'
        ORDER BY group_name`,
        q0037: `SELECT group_id, group_name
        FROM frdcall_inbound_groups a
        INNER JOIN (
          SELECT frdcall_user_groups.admin_viewable_groups 
          FROM (
            SELECT user_group 
            FROM frdcall_users 
            WHERE user= "#P:0#"
          )AS frdcall_users 
          LEFT JOIN frdcall_user_groups 
          ON frdcall_users.user_group = frdcall_user_groups.user_group
        )AS b 
        ON LOCATE('-ALL-', b.admin_viewable_groups) BETWEEN 1 AND 5
        OR LOCATE(CONCAT(' ', a.user_group, ' '), b.admin_viewable_groups) > 0
        WHERE group_id <> 'OPERATORQUE'
        ORDER BY group_name`,
        q0038: `
        SELECT DISTINCT list_id, list_name
        FROM frdcall_lists a
        INNER JOIN (
            SELECT ug2.allowed_campaigns, user_level
            FROM (
                SELECT admin_viewable_groups, user_level
                FROM frdcall_users us
                INNER JOIN frdcall_user_groups ug1
                ON us.user_group = ug1.user_group
                WHERE user= "#P:0#"
            )AS us 
            INNER JOIN frdcall_user_groups ug2
            ON user_level = 9
            OR us.admin_viewable_groups RLIKE CONCAT("\\\\b", ug2.user_group, "\\\\b")
        )AS b
        ON user_level = 9
        OR b.allowed_campaigns RLIKE CONCAT("\\\\b", a.campaign_id, "\\\\b")
        ORDER BY list_name
        ;
        `,
        q0039: `SELECT call_time_id, call_time_name
        FROM frdcall_call_times a
        INNER JOIN (
          SELECT frdcall_user_groups.admin_viewable_groups 
          FROM (
            SELECT user_group 
            FROM frdcall_users 
            WHERE user= "#P:0#"
          )AS frdcall_users 
          LEFT JOIN frdcall_user_groups 
          ON frdcall_users.user_group = frdcall_user_groups.user_group
        )AS b 
        ON LOCATE('-ALL-', b.admin_viewable_groups) BETWEEN 1 AND 5
        OR LOCATE(CONCAT(' ', a.user_group, ' '), b.admin_viewable_groups) > 0`,
        q0040: `SELECT frdcall_users.user_id, frdcall_users.user, frdcall_users.user_level, frdcall_users.full_name,frdcall_users.user_group, frdcall_users.user_hide_realtime, frdcall_users.last_login_date,phones.dialplan_number, phones.status, phones.protocol,frdcall_user_groups.group_name
        FROM frdcall_users
        LEFT JOIN phones ON frdcall_users.phone_login = phones.login
        LEFT JOIN frdcall_user_groups ON frdcall_users.user_group = frdcall_user_groups.user_group
        INNER JOIN (
          SELECT frdcall_user_groups.admin_viewable_groups 
            FROM (
            SELECT user_group 
            FROM frdcall_users 
            WHERE user= "#P:0#"
            )AS frdcall_users 
            LEFT JOIN frdcall_user_groups 
            ON frdcall_users.user_group = frdcall_user_groups.user_group
        )AS view_groups 
        ON LOCATE('-ALL-', view_groups.admin_viewable_groups) BETWEEN 1 AND 5
        OR LOCATE(CONCAT(' ', frdcall_users.user_group, ' '), view_groups.admin_viewable_groups) > 0;`,
        q0041: `UPDATE frdcall_call_menu set diagram_xml="#P:0#", json_config="#P:1#" where menu_id="#P:2#" LIMIT 1`,
        q0042: `select diagram_xml from frdcall_call_menu where menu_id="#P:0#"`,
        q0043: `select diagram_xml, menu_name from frdcall_call_menu where menu_id="#P:0#"`,
        q0044: `UPDATE frdcall_log AS cl 
            JOIN (SELECT MAX(CAST(uniqueid AS float8)) AS max_uniqueid 
                FROM frdcall_log 
		        WHERE user="#P:1#" AND LOWER(campaign_id)=LOWER("#P:2#") AND lead_id="#P:3#") cl2
            SET cl.callback_time="#P:0#", cl.processed = "N"
            WHERE cl.user="#P:1#" AND LOWER(cl.campaign_id)=LOWER("#P:2#") AND cl.lead_id="#P:3#" AND CAST(cl.uniqueid AS float8)=cl2.max_uniqueid AND true`,
        q0045: `select smsId AS "value", template_name AS "label", message AS "body" 
        from frd_sms_template 
        INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user =  "#P:0#"), ' '), admin_viewable_groups))a 
            ON admin_viewable_groups LIKE '%-ALL-%' 
            OR LOCATE(CONCAT(' ', user_group, ' '), admin_viewable_groups) > 0 
        ORDER BY smsId ASC`,
        q0046: `UPDATE frdcall_closer_log SET processed="R" where closecallid="#P:0#" and list_id="#P:1#" and user="#P:2#" LIMIT 1`,
        q0047: `SELECT u.full_name,a.* FROM frdcall_remote_agents a LEFT JOIN frdcall_users u ON a.user_start = u.user WHERE campaign_id IN ('#P:0#');`,

        q0600: `select status from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") order by item_order`,
        q0601: `DELETE from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") AND true`,
        q0602: `select count(*) as cnt from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") and status in ('#P:1#')`,
        q0603: `select count(*) as cnt from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#")`,
        q0604: `DELETE from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") AND true`,
        q0605: `insert into frdcall_campaign_statuses_ext (campaign_id,status,item_order) values ("#P:0#","#P:1#",#P:2#)`,
        q0606: `DELETE from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") and status not in ('#P:1#') AND true`,
        q0607: `select status from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") order by item_order`,
        q0608: `SELECT group_id AS value, CONCAT(group_id, " - ", group_name) AS label FROM frdcall_inbound_groups WHERE group_handling='PHONE' #P:0# ORDER BY group_id`,
        q0609: `SELECT DISTINCT rl.uniqueid AS uniqueid, 
                (CASE WHEN al.event_time IS NULL THEN cl.call_date ELSE al.event_time END) AS call_date, 
                cl.campaign_id AS campaign_id, 
                cc.campaign_name AS campaign_name, 
                sci.name AS channel, 
                cu.phone_login AS phone_login, 
                cl.phone_number AS phone_number, 
                cl.user AS user, 
                rl.filename AS filename, 
                "" AS call_text
            FROM frdcall_log cl 
            LEFT JOIN call_log cl2 ON cl2.uniqueid=cl.uniqueid 
            LEFT JOIN frdcall_server_carriers_index sci ON sci.prefix=left(cl2.extension,7)
            LEFT JOIN frdcall_campaigns cc ON cc.campaign_id=cl.campaign_id
            LEFT JOIN frdcall_users cu ON cu.user=cl.user 
            LEFT JOIN recording_log rl ON cl.uniqueid = rl.uniqueid
            LEFT JOIN frdcall_agent_log al ON cl.uniqueid = al.uniqueid
            WHERE cl.uniqueid <> "" AND (CASE WHEN al.event_time IS NULL THEN cl.call_date ELSE al.event_time END) BETWEEN '#P:0# 00:00:00' AND '#P:1# 23:59:59' 
                AND cl.campaign_id IN ('#P:2#')
                AND cl.list_id IN ('#P:3#')
                AND (CASE WHEN al.status IS NULL THEN cl.status ELSE al.status END) IN ('#P:4#')
                AND cl.user_group IN ('#P:5#')
                AND cl.length_in_sec > 0 
                AND rl.filename IS NOT NULL
            ORDER BY cl.uniqueid LIMIT 10000`,
        q0610: `SELECT DISTINCT rl.uniqueid AS uniqueid, 
                (CASE WHEN al.event_time IS NULL THEN cl.call_date ELSE al.event_time END) AS call_date, 
                cl.campaign_id AS campaign_id, 
                ig.group_name AS campaign_name, 
                cl2.channel AS channel, 
                cu.phone_login AS phone_login, 
                cl.phone_number AS phone_number, 
                cl.user AS user, 
                rl.filename AS filename, 
                "" AS call_text
            FROM frdcall_closer_log cl 
            LEFT JOIN call_log cl2 ON cl2.uniqueid=cl.uniqueid 
            LEFT JOIN frdcall_inbound_groups ig ON ig.group_id=cl.campaign_id
            LEFT JOIN frdcall_users cu ON cu.user=cl.user 
            LEFT JOIN recording_log rl ON cl.uniqueid = rl.uniqueid
            LEFT JOIN frdcall_agent_log al ON cl.uniqueid = al.uniqueid
            WHERE cl.uniqueid <> "" AND (CASE WHEN al.event_time IS NULL THEN cl.call_date ELSE al.event_time END) BETWEEN '#P:0# 00:00:00' AND '#P:1# 23:59:59' 
                AND cl.campaign_id IN ('#P:2#')
                AND cl.list_id IN ('#P:3#')
                AND (CASE WHEN al.status IS NULL THEN cl.status ELSE al.status END) IN ('#P:4#')
                AND cl.user_group IN ('#P:5#')
                AND cl.length_in_sec > 0 
                AND rl.filename IS NOT NULL
                AND CASE WHEN cl.status='GONE' THEN JSON_VALID(cl.comments) = 1 ELSE true END
            ORDER BY cl.uniqueid LIMIT 10000`,
        q0611: `
                    SELECT 
                        "camp" AS class,
                        status AS value, 
                        CONCAT(status, " - ", status_name) AS label 
                    FROM (
                        SELECT DISTINCT main.status,main.status_name 
                        FROM frdcall_campaign_statuses main
                        LEFT JOIN frdcall_campaign_statuses_ext ext
                        ON main.status=ext.status AND main.campaign_id=ext.campaign_id
                        WHERE main.campaign_id IN ('#P:0#')
                        ORDER BY ext.item_order, main.status
                    )a
                                                        UNION
                    SELECT 
                        "drop" AS class,
                        status AS value, 
                        CONCAT(status, " - ", status_name) AS label 
                    FROM frdcall_statuses 
                    WHERE status = 'DROP' OR status = 'GONE'
                                                        UNION
                    SELECT 
                        "system" AS class,
                        status AS value, 
                        CONCAT(status, " - ", status_name) AS label 
                    FROM (
                        SELECT DISTINCT status,status_name
                        FROM frdcall_statuses 
                        WHERE status IN('A','AA','AB','ADC','ADCT','B','DNC','N','NA','PDROP','PM','PU','QUEUE','AFTHRS','TIMEOT','XFER','INCALL','WBFORM','SVYCLM')
                        ORDER BY status
                    )a
                    `,
        q0612: `UPDATE  frdcall_users SET phone_login = #P:0# WHERE user = "#P:1#" LIMIT 1`,
        q0613: `SELECT user, phone_pass, user_level, user_group FROM frdcall_users WHERE user = '#P:0#' LIMIT 1`,
        q0614: `UPDATE frdcall_users SET phone_login = '#P:0#' WHERE user = '#P:1#' LIMIT 1`,
        q0615: `UPDATE phones SET pass = '#P:0#', conf_secret = '#P:0#', user_group = '#P:2#' WHERE extension = (SELECT phone_login FROM frdcall_users WHERE user = '#P:1#') LIMIT 1`,
        q0616: `SELECT modify_tts FROM frdcall_users WHERE user = "#P:0#" LIMIT 1;`,
        q0617: `UNUSED`,
        q0618: `SELECT user_id,user,full_name,user_level,user_group,modify_users as users,modify_lists as lists,modify_leads as leads,modify_campaigns as campaigns,modify_ingroups as ingroups,modify_inbound_dids as inbound_dids,modify_remoteagents as remoteagents,modify_call_times as call_times,modify_tts as tts 
            FROM frdcall_users 
            INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = (SELECT user_group FROM frdcall_users WHERE user =  "#P:0#"))a 
            ON admin_viewable_groups LIKE '%-ALL-%' 
            OR LOCATE(CONCAT(' ', user_group, ' '), admin_viewable_groups) > 0 
            WHERE user_level <= #P:1#
            AND user = "#P:2#"`,
        q0619: `SELECT us.user_id,us.user,us.full_name,us.user_level,us.user_group,delete_users as users,delete_lists as lists,delete_campaigns as campaigns,delete_ingroups as ingroups,delete_inbound_dids as inbound_dids,delete_remote_agents as remoteagents,delete_call_times as call_times, delete_leads as \`leads\`, delete_tts as tts
                FROM frdcall_users us
                INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = (SELECT user_group FROM frdcall_users WHERE user =  "#P:0#"))a 
                ON admin_viewable_groups LIKE '%-ALL-%' 
                OR LOCATE(CONCAT(' ', us.user_group, ' '), admin_viewable_groups) > 0 
                LEFT JOIN frdcall_user_extend_privilege ep
                ON us.user = ep.user
                WHERE us.user_level <= #P:1#
                AND us.user = "#P:2#"
                ;`,
        q0620: `SELECT id,read_import,read_export,report_export,graph_export,audio_export,op_audio_display 
            FROM frdcall_user_features
            WHERE user_id = (
                SELECT user
                FROM frdcall_users 
                INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = (SELECT user_group FROM frdcall_users WHERE user =  "#P:0#"))a 
                ON admin_viewable_groups LIKE '%-ALL-%' 
                OR LOCATE(CONCAT(' ', user_group, ' '), admin_viewable_groups) > 0 
                WHERE is_delete = 0 
                AND user_level <= #P:1#
                AND user = "#P:2#"
                LIMIT 1
            )
            AND is_delete = 0
            LIMIT 1`,
        q0621: `INSERT INTO frdcall_user_features (user_id,create_datetime) VALUES('#P:0#','#P:1#') ON DUPLICATE KEY UPDATE read_import = 'N',read_export = 'N',report_export = 'N',graph_export = 'N',audio_export = 'N',op_audio_display = 'N',is_delete = 0,create_datetime = '#P:1#'`,
        q0622: `UNUSED`,
        q0623: `SELECT user_level FROM frdcall_users WHERE user = '#P:0#'`,
        q0624: `SELECT 
                a.id,
                a.feature_name,
                (CASE WHEN b.create = 'Y' THEN a.create ELSE 'DISABLE' END) as \`create\`,
                (CASE WHEN b.read = 'Y' THEN a.read ELSE 'DISABLE' END) as \`read\`,
                (CASE WHEN b.update = 'Y' THEN a.update ELSE 'DISABLE' END) as \`update\`,
                (CASE WHEN b.delete = 'Y' THEN a.delete ELSE 'DISABLE' END) as \`delete\`
            FROM frdcall_user_extend_features a
            LEFT JOIN frdcall_admin_features b
            ON a.customer_id = b.customer_id
            AND a.feature_name = b.feature_name
            WHERE a.user = 
            (
                SELECT user
                FROM frdcall_users 
                INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = (SELECT user_group FROM frdcall_users WHERE user =  "#P:0#"))a 
                ON admin_viewable_groups LIKE '%-ALL-%' 
                OR LOCATE(CONCAT(' ', user_group, ' '), admin_viewable_groups) > 0 
                WHERE user_level <= #P:1#
                AND user = "#P:2#"
                LIMIT 1
            )
            AND a.is_delete = 0 
            ;`,
        q0625: `
            INSERT INTO frdcall_user_extend_features
            SELECT null,
                ad.customer_id,
                '#P:0#',
                ad.feature_name,
                'N' as \`create\`,
                'N' as \`read\`,
                'N' as \`update\`,
                'N' as \`delete\`,
                ad.ex_col,
                '0' as is_delete
            FROM frdcall_admin_features ad
            WHERE customer_id = 
                (
                    SELECT a.id 
                    FROM frdcall_admins a 
                    LEFT JOIN frdcall_user_groups b 
                    ON a.customer_id = b.user_group 
                    WHERE is_delete = 0 
                    AND LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1),' '), b.admin_viewable_groups) > 0 
                    LIMIT 1
                )
            AND NOT EXISTS (SELECT 1 FROM frdcall_user_extend_features us WHERE us.user = "#P:0#" AND ad.feature_name = us.feature_name AND is_delete = 0 )
            `,
        q0626: `UNUSED`,
        q0627: `UPDATE frdcall_user_extend_privilege SET \`#P:0#\`='#P:1#' WHERE user="#P:2#" LIMIT 1`,
        q0628: `UPDATE frdcall_users SET \`#P:0#\`='#P:1#' WHERE user="#P:2#" LIMIT 1`,
        q0629: `UPDATE frdcall_user_features SET \`#P:0#\`='#P:1#' WHERE id="#P:2#" LIMIT 1`,
        q0630: `UPDATE frdcall_user_extend_features SET \`#P:0#\`='#P:1#' WHERE id="#P:2#" LIMIT 1`,
        q0631: `SELECT full_name FROM frdcall_users WHERE user="#P:0#"`,
        q0632: `UPDATE frdcall_users SET full_name="#P:0#" WHERE user="#P:1#" LIMIT 1`,
        q0633: `UNUSED`,
        q0634: `SELECT modify_users,modify_usergroups,modify_phones,modify_remoteagents,modify_lists,modify_leads,modify_campaigns,modify_ingroups,modify_inbound_dids,modify_tts,modify_call_times FROM frdcall_users WHERE user = "#P:0#"`,
        q0635: `SELECT \`create\`, \`read\`, \`update\`, \`delete\` FROM frdcall_admin_features WHERE (feature_name = 'ダッシュボード' OR feature_name = 'CRM' OR feature_name = 'フォームビルダー') AND customer_id = (SELECT a.id FROM frdcall_admins a LEFT JOIN frdcall_user_groups b ON a.customer_id = b.user_group WHERE is_delete = 0 AND LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1),' '), b.admin_viewable_groups) > 0 LIMIT 1) ORDER BY feature_name;`,
        q0636: `SELECT feature_name,\`create\`, \`read\`, \`update\`, \`delete\` FROM frdcall_user_extend_features WHERE (feature_name = 'ダッシュボード' OR feature_name = 'CRM' OR feature_name = 'フォームビルダー') AND user = '#P:0#' ORDER BY feature_name;`,
        q0637: `SELECT read_import FROM frdcall_user_features WHERE user_id = "#P:0#" AND is_delete = 0 LIMIT 1;`,
        q0638: `SELECT modify_users,modify_usergroups,modify_phones,modify_remoteagents,modify_lists,modify_leads,modify_campaigns,modify_ingroups,modify_inbound_dids,modify_tts,modify_call_times FROM frdcall_users WHERE user = "#P:0#"`,
        q0639: `
            SELECT
                g2.admin_viewable_groups
            FROM
                frdcall_users u2
                INNER JOIN frdcall_user_groups g2 ON u2.user_group = g2.user_group
            WHERE
                u2.user = "#P:0#"`,
        q0640: `
            SELECT
                u.user_id,
                u.user,
                u.full_name,
                u.user_level,
                u.user_group,
                u.phone_login,
                g.admin_viewable_groups,
                g.group_name,
                g.allowed_campaigns,
                l.conf_exten,
                l.extension,
                l.status,
                UPPER(l.campaign_id) \`campaign_id\`
            FROM
                frdcall_users u
                INNER JOIN frdcall_user_groups g ON u.user_group = g.user_group
                LEFT JOIN frdcall_live_agents l ON u.user = l.user
            WHERE u.user_group = (SELECT customer_id FROM frdcall_admins WHERE id = "#P:1#" LIMIT 1) 
				OR (
					SELECT admin_viewable_groups 
					FROM frdcall_user_groups a 
                    WHERE a.user_group = (SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1)
                    LIMIT 1
				) RLIKE CONCAT( "\\\\b", u.user_group, "\\\\b")
            ORDER BY
                u.user_group,
                u.user;`,
        q0641 /* or q0680 */: `SELECT feature_name,\`#P:1#\` FROM frdcall_admin_features WHERE customer_id = (SELECT a.id FROM frdcall_admins a LEFT JOIN frdcall_user_groups b ON a.customer_id = b.user_group WHERE is_delete = 0 AND LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1),' '), b.admin_viewable_groups) > 0 LIMIT 1);`,
        q0642: `SELECT modify_users,modify_usergroups,modify_phones,modify_remoteagents,modify_lists,modify_leads,modify_campaigns,modify_ingroups,modify_inbound_dids,modify_tts,modify_call_times FROM frdcall_users WHERE user = "#P:0#"`,
        q0643: `SELECT read_import FROM frdcall_user_features WHERE user_id = "#P:0#" AND is_delete = 0 LIMIT 1;`,
        q0644: `SELECT \`#P:0#\` FROM frdcall_admin_features WHERE feature_name = "#P:1#" AND customer_id = (SELECT a.id FROM frdcall_admins a LEFT JOIN frdcall_user_groups b ON a.customer_id = b.user_group WHERE is_delete = 0 AND LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user = "#P:2#" LIMIT 1),' '), b.admin_viewable_groups) > 0 LIMIT 1);`,
        q0645: `SELECT \`#P:0#\` FROM frdcall_user_extend_features WHERE feature_name = "#P:1#" AND user = "#P:2#" LIMIT 1;`,
        q0646: `SELECT #P:0# as privilege FROM frdcall_users WHERE user = "#P:1#";`,
        q0647: (p0, p1, p2) => getValidityGroupList(p0, p1, p2),
        q0648: `SELECT count(*) \`count\` FROM frdcall_dnc where phone_number="#P:0#"`,
        q0649: `SELECT count(*) \`count\` FROM frdcall_campaign_dnc where phone_number="#P:0#" AND campaign_id = "#P:1#"`,
        q0650: `SELECT IFNULL((SELECT MAX(CAST(dialplan_number as SIGNED)) as num FROM phones WHERE dialplan_number BETWEEN #P:0# AND #P:1#),#P:2#) as num`,
        q0651: `SELECT user_id,user,full_name,user_level,user_group,modify_users as users,modify_lists as lists,modify_leads as leads,modify_campaigns as campaigns,modify_ingroups as ingroups,modify_inbound_dids as inbound_dids,modify_remoteagents as remote_agents,modify_call_times as call_times,modify_tts as tts 
        FROM frdcall_users 
        INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = (SELECT user_group FROM frdcall_users WHERE user =  "#P:0#"))a 
        ON admin_viewable_groups LIKE '%-ALL-%' 
        OR LOCATE(CONCAT(' ', user_group, ' '), admin_viewable_groups) > 0 
        WHERE user = "#P:1#"`,
        q0652: `SELECT us.user_id,us.user,us.full_name,us.user_level,us.user_group,delete_users as users,delete_lists as lists,delete_campaigns as campaigns,delete_ingroups as ingroups,delete_inbound_dids as inbound_dids,delete_remote_agents as remote_agents,delete_call_times as call_times, delete_leads as \`leads\`, delete_tts as tts
        FROM frdcall_users us
        INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = (SELECT user_group FROM frdcall_users WHERE user =  "#P:0#"))a 
        ON admin_viewable_groups LIKE '%-ALL-%' 
        OR LOCATE(CONCAT(' ', us.user_group, ' '), admin_viewable_groups) > 0 
        LEFT JOIN frdcall_user_extend_privilege ep
        ON us.user = ep.user
        WHERE us.user = "#P:1#"`,
        q0653: `DELETE FROM frdcall_hopper ho 
                                WHERE EXISTS (SELECT * 
                                    FROM frdcall_list li 
                                    WHERE ho.lead_id = li.lead_id 
                                    #P:0#
                                    ) 
                                #P:1#
                                AND true`,
        q0654: `UPDATE frdcall_list le 
                                    SET status = 'NEW', modify_date=NOW()
                                    WHERE status IN ('DNCC','DNCL')
                                    AND EXISTS(SELECT 1 
                                        FROM frdcall_lists li 
                                        WHERE li.list_id = le.list_id 
                                        #P:0#
                                        )
                                    #P:1#
                                    AND true`,
        q0655: `SELECT a.max_user FROM frdcall_admins a LEFT JOIN frdcall_user_groups b ON a.customer_id = b.user_group WHERE is_delete = 0 AND LOCATE(CONCAT(' ', #P:0# ,' '), b.admin_viewable_groups) > 0 LIMIT 1`,
        q0656: `
        SELECT ga.user_group,COUNT(DISTINCT(gb.user_group))group_count,COUNT(DISTINCT(gb.user))user_count
        FROM frdcall_user_groups ga
        LEFT JOIN (
            SELECT g.user_group,u.user
            FROM frdcall_user_groups g
            LEFT JOIN frdcall_users u
            ON g.user_group = u.user_group
        ) gb
        ON LOCATE(CONCAT(' ', gb.user_group, ' '), ga.admin_viewable_groups)
        INNER JOIN(
            SELECT a.customer_id 
            FROM frdcall_admins a 
            LEFT JOIN frdcall_user_groups b 
            ON a.customer_id = b.user_group 
            WHERE is_delete = 0 
            AND LOCATE(CONCAT(' ', #P:0# ,' '), b.admin_viewable_groups)
            LIMIT 1
        )ad
        ON ga.user_group = ad.customer_id
        GROUP BY ga.user_group;`,
        q0657: `SELECT status FROM frdcall_live_agents WHERE user="#P:0#"`,
        q0658: `SELECT channel FROM live_sip_channels WHERE channel_group="system" AND extension="#P:0#"`,
        q0659: `SELECT channel, server_ip FROM live_sip_channels WHERE channel_group="system" AND extension="#P:0#"`,
        q0660: `INSERT INTO frdcall_manager values('','',NOW(),'NEW','N','#P:0#','','Hangup','HUPINTERNAL#P:1#','Channel: #P:2#','','','','','','','','','');`,
        q0661: `SELECT channel, server_ip FROM live_sip_channels WHERE channel_group!="system" AND extension="#P:0#" AND channel_data NOT LIKE '%FG(loggedin-frd-call-system)'`,
        q0662: `SELECT channel, server_ip FROM live_channels WHERE extension="#P:0#"`,
        q0663: `INSERT INTO frdcall_manager values('','',NOW(),'NEW','N','#P:0#','','Hangup','HUPALL#P:1#','Channel: #P:2#','','','','','','','','','');`,
        q0664: `SELECT channel FROM live_sip_channels WHERE channel_group="system" AND extension="#P:0#"`,
        q0665: `SELECT channel FROM live_sip_channels WHERE channel_group="system" AND extension="#P:0#"`,
        q0666: `SELECT extension, server_ip FROM live_sip_channels WHERE channel RLIKE '^SIP/#P:0#\\\\b' LIMIT 1;`,
        q0667: `INSERT INTO frdcall_manager values('','',NOW(),'NEW','N','#P:0#','','Originate','ORGINTERNAL#P:1#TO#P:2#','Exten: #P:3#','Context: default','Channel: Local/#P:4#@default','Priority: 1','Callerid: "system" <#P:5#TO#P:6#>','Timeout: 26000','','','','');`,
        q0668: `SELECT p.extension, p.server_ip, u.full_name FROM frdcall_users u INNER JOIN phones p ON p.login=u.user WHERE p.login="#P:0#" LIMIT 1`,
        q0669: `INSERT INTO websocket_commmands (src, target, req, status, params_json) values ("showNotif", "/user/#P:0#", "runFunc", "Created", '#P:1#');`,
        q0670: `
        SELECT a.id, a.customer_name
        FROM frdcall_admins a 
        LEFT JOIN frdcall_user_groups b 
        ON a.customer_id = b.user_group 
        WHERE is_delete = 0 
        AND b.admin_viewable_groups RLIKE CONCAT('\\\\b',(SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1), '\\\\b')
        LIMIT 1;
        `,
        q0671: `SELECT user_level FROM frdcall_users WHERE user='#P:0#';`,
        q0672: `SELECT menu_id, menu_name
                                                      FROM frdcall_call_menu a
                                                      INNER JOIN (
                                                        SELECT frdcall_user_groups.admin_viewable_groups 
                                                        FROM (
                                                          SELECT user_group 
                                                          FROM frdcall_users 
                                                          WHERE user= "#P:0#"
                                                        )AS frdcall_users 
                                                        LEFT JOIN frdcall_user_groups 
                                                        ON frdcall_users.user_group = frdcall_user_groups.user_group
                                                      )AS b 
                                                      ON LOCATE('-ALL-', b.admin_viewable_groups) BETWEEN 1 AND 5
                                                      OR LOCATE(CONCAT(' ', a.user_group, ' '), b.admin_viewable_groups) > 0
                                                      ORDER BY menu_name`,
        q0680: `SELECT ad.feature_name,( CASE WHEN ad.#P:1# = 'Y' THEN us.#P:1# ELSE 'N' END ) as \`#P:1#\` FROM frdcall_admin_features ad LEFT JOIN frdcall_user_extend_features us ON ad.customer_id = us.customer_id AND ad.feature_name = us.feature_name AND us.user = "#P:0#" WHERE ad.customer_id = (SELECT a.id FROM frdcall_admins a LEFT JOIN frdcall_user_groups b ON a.customer_id = b.user_group WHERE is_delete = 0 AND LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1),' '), b.admin_viewable_groups) > 0 LIMIT 1);`,

        q0681: `INSERT INTO websocket_commmands (src, target, req, status, params_json) values ("#P:0#", "/group/#P:1#", "runFunc", "Created", '{
                      "func":       "updateLeadViaWS", 
                      "funcParams": { "listId": "#P:2#", "leadId": "#P:3#" }
                  }');`,

        q0200: `UPDATE frdcall_campaigns set campaign_description="#P:0#", user_group="#P:1#", drop_action="CALLMENU", active="#P:2#", local_call_time="#P:3#" where campaign_id="#P:4#" LIMIT 1`,
        q0201: `SELECT ct_default_stop FROM frdcall_call_times where call_time_id = '#P:0#'`,
        q0202: `DELETE from frdcall_hopper where campaign_id='#P:0#' and status IN('READY','QUEUE','DONE') AND true`,
        q0203: `SELECT list_id, daily_reset_limit,resets_today from frdcall_lists where campaign_id='#P:0#'`,
        q0204: `UPDATE frdcall_lists set resets_today=(resets_today + 1) where list_id='#P:0#' LIMIT 1`,
        q0205: `UPDATE frdcall_list set called_since_last_reset='N', modify_date=NOW() where list_id='#P:0#' AND true`,
        q0206: `UPDATE frdcall_user_groups SET allowed_campaigns = REPLACE(allowed_campaigns ," #P:0# " ," ") WHERE true AND true`,
        q0207: `SELECT * FROM frdcall_admins WHERE customer_id = "#P:0#" AND is_delete = 0;`,

        q0208: `INSERT INTO frdcall_admins (customer_id, customer_name, max_user, url_list_upload, create_datetime,sms_id,sms_pw,sm_user_id,sm_customer_id) VALUES("#P:0#","#P:1#","#P:2#", '#P:3#',"#P:4#","#P:5#","#P:6#","#P:7#","#P:8#");`,
        q0209: `INSERT INTO frdcall_admin_features SELECT null as id,(SELECT id FROM frdcall_admins WHERE customer_id = "#P:0#") as customer_id, feature_name,\`create\`,\`read\`,\`update\`,\`delete\`,ex_col,0 as is_delete FROM frdcall_admin_features WHERE customer_id = "#P:1#" AND is_delete = 0;`,
        q0210: `INSERT INTO frdcall_admin_features 
        (customer_id,feature_name,\`create\`,\`read\`,\`update\`,\`delete\`,ex_col) 
        VALUES((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"マップビュー",'DISABLE','Y','DISABLE','DISABLE',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"CCDX",'N','N','N','N',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"フォームビルダー",'Y','Y','Y','Y',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"WEBフォーム",'N','N','N','N',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"SMS",'DISABLE','N','DISABLE','DISABLE',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"メールテンプレート",'N','N','N','N',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"ロボットコール",'Y','Y','Y','Y',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"テキストマイニング",'N','N','N','N',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"CRM",'DISABLE','Y','DISABLE','DISABLE',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"ダッシュボード",'DISABLE','Y','DISABLE','DISABLE',"{}"),
        ((SELECT id FROM frdcall_admins WHERE customer_name = "#P:0#" AND is_delete = 0 LIMIT 1),"キャリア設定",'Y','Y','Y','Y',"{}");`,
        q0211: `INSERT INTO frdcall_user_features (user_id,read_import,read_export,report_export,graph_export,audio_export,is_delete,create_datetime) VALUES('#P:0#','Y','Y','Y','Y','Y',0,'#P:1#') ON DUPLICATE KEY UPDATE create_datetime= '#P:1#'`,
        q0212: `UPDATE frdcall_user_extend_privilege SET delete_leads = '1',delete_tts = '1' WHERE user = '#P:0#' LIMIT 1`,
        q0213: `UPDATE frdcall_admins SET update_datetime = "#P:0#", customer_name = "#P:1#", url_list_upload = '#P:2#',max_user = '#P:3#',sms_id = '#P:5#',sms_pw = '#P:6#',sm_user_id = '#P:7#',sm_customer_id = '#P:8#' WHERE id = "#P:4#" AND is_delete = 0 LIMIT 1`,
        q0214: `SELECT customer_name, url_list_upload, max_user,sms_id,sms_pw, sm_user_id, sm_customer_id FROM frdcall_admins WHERE id = '#P:0#' AND is_delete = 0 LIMIT 1;`,
        q0215: `UPDATE frdcall_admins SET update_datetime = "#P:0#" WHERE customer_id = "#P:1#" LIMIT 1`,
        q0216: `SELECT ad.id,ad.customer_id,ad.customer_name,ad.active,gc.group_count, gc.user_count, ad.max_user, DATE_FORMAT(gc.last_login_date,'%Y-%m-%d %H:%i:%S')as last_login_date, DATE_FORMAT(create_datetime,'%Y-%m-%d %H:%i:%S')as create_datetime,DATE_FORMAT(update_datetime,'%Y-%m-%d %H:%i:%S')as update_datetime
        FROM frdcall_admins ad
        LEFT JOIN (
          SELECT ga.user_group,COUNT(gb.user_group)group_count,SUM(IFNULL(gb.user_count,0))user_count,MAX(gb.last_login_date)last_login_date
          FROM frdcall_user_groups ga
          LEFT JOIN (
            SELECT g.user_group,COUNT(u.user)user_count,MAX(l.date)last_login_date
            FROM frdcall_user_groups g
            LEFT JOIN frdcall_users u
            ON g.user_group = u.user_group
            LEFT JOIN (
              SELECT user,MAX(event_date)date 
              FROM  frdcall_user_log
              WHERE event = 'LOGIN'
              GROUP BY user
            )l
            ON l.user = u.user
                -- WHERE u.active = 'Y'
            GROUP BY g.user_group
          ) gb
          ON LOCATE(CONCAT(' ', gb.user_group, ' '), ga.admin_viewable_groups)
          GROUP BY ga.user_group
        )gc
        ON ad.customer_id = gc.user_group
        WHERE is_delete = 0
        ;`,
        q0217: `SELECT user FROM frdcall_users WHERE LOCATE(CONCAT(" ",user_group," "), (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = "#P:0#" LIMIT 1) )`,
        q0218: `SELECT campaign_id FROM frdcall_campaigns WHERE LOCATE(CONCAT(" ",user_group," "), (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = "#P:0#" LIMIT 1) )`,
        q0219: `SELECT user_group FROM frdcall_user_groups WHERE LOCATE(CONCAT(" ",user_group," "), (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = "#P:0#" LIMIT 1) )`,
        q0220: `UPDATE frdcall_users SET \`active\` = 'N' WHERE LOCATE(user_group, (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = "#P:0#" LIMIT 1) ) > 0 AND true`,
        q0221: `UPDATE frdcall_admin_features SET is_delete = 1 WHERE customer_id='#P:0#' AND true`,
        q0222: `UPDATE frdcall_admins SET update_datetime = "#P:0#", is_delete = 1 WHERE id='#P:1#' LIMIT 1`,
        q0223: `SELECT user_group FROM frdcall_user_groups WHERE LOCATE(CONCAT(' ', user_group, ' '), (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = '#P:0#')) > 0;`,
        q0224: `SELECT a.id, a.customer_id, b.customer_name,a.feature_name, a.create, a.read, a.update, a.delete, a.ex_col FROM frdcall_admin_features a LEFT JOIN frdcall_admins b ON a.customer_id = b.id WHERE a.is_delete = 0 #P:0#`,
        q0225: `UPDATE frdcall_admin_features SET \`#P:0#\`='#P:1#' WHERE id=#P:2# LIMIT 1`,
        q0226: `SELECT DISTINCT id,customer_id,customer_name FROM frdcall_admins WHERE is_delete = 0;`,
        q0227: `
        SELECT customer_id, CONCAT(YEAR(event_date), '-', LPAD(MONTH(event_date),2,0)) mon_date,
          MAX(active_admin) active_admin,
            MAX(active_sub_admin) active_sub_admin,
            MAX(active_closer) active_closer,
            MAX(active_operator) active_operator,
          MAX(month_login_admin) month_login_admin,
            MAX(month_login_sub_admin) month_login_sub_admin,
            MAX(month_login_closer) month_login_closer,
            MAX(month_login_operator) month_login_operator,
          DATE_FORMAT(MAX(lastdate_month_login_admin),'%Y-%m-%d %H:%i:%s') lastdate_month_login_admin,
            DATE_FORMAT(MAX(lastdate_month_login_sub_admin),'%Y-%m-%d %H:%i:%s') lastdate_month_login_sub_admin,
            DATE_FORMAT(MAX(lastdate_month_login_closer),'%Y-%m-%d %H:%i:%s') lastdate_month_login_closer,
            DATE_FORMAT(MAX(lastdate_month_login_operator),'%Y-%m-%d %H:%i:%s') lastdate_month_login_operator,
          NULLIF(GREATEST(
            IFNULL(DATE_FORMAT(MAX(lastdate_month_login_admin),'%Y-%m-%d %H:%i:%s'), '2000-01-01'), 
            IFNULL(DATE_FORMAT(MAX(lastdate_month_login_sub_admin),'%Y-%m-%d %H:%i:%s'), '2000-01-01'), 
            IFNULL(DATE_FORMAT(MAX(lastdate_month_login_closer),'%Y-%m-%d %H:%i:%s'), '2000-01-01'), 
            IFNULL(DATE_FORMAT(MAX(lastdate_month_login_operator),'%Y-%m-%d %H:%i:%s'), '2000-01-01')
            ), '2000-01-01') lastdate_month_login_all
            
        FROM frdcall_admin_user_log a
        WHERE event_type = 'auto_process'
        AND YEAR(event_date) BETWEEN YEAR(NOW()) - 1 AND YEAR(NOW())
        GROUP BY customer_id, YEAR(event_date), MONTH(event_date)
        ;`,
        q0228: `SELECT server_ip, a.campaign_id, b.campaign_name, status, a.lead_id, c.title, channel, phone_number, stage, queue_priority, agent_only, queue_position, extension  FROM frdcall_auto_calls as a LEFT JOIN (SELECT campaign_id, campaign_name FROM frdcall_campaigns) as b ON a.campaign_id = b.campaign_id LEFT JOIN (SELECT lead_id,title FROM frdcall_list) as c ON a.lead_id = c.lead_id #P:0#`,
        q0229: `UPDATE frdcall_users set last_login_date = NOW() where user='#P:0#' LIMIT 1`,
        q0230: `SELECT list_id FROM frdcall_lists WHERE campaign_id IN ('#P:0#') LIMIT 100;`,
        q0231: `UPDATE phones SET user_group = (SELECT user_group FROM frdcall_users WHERE user = '#P:0#' LIMIT 1) WHERE extension = "#P:1#" LIMIT 1`,
        q0232: `SELECT extension FROM phones WHERE fullname = '#P:0#' LIMIT 1;`,
        q0233: `SELECT active FROM phones WHERE extension='#P:0#' LIMIT 1`,
        q0234: `INSERT IGNORE INTO frdcall_dnc (phone_number) VALUES ('#P:0#');`,
        q0235: `INSERT IGNORE INTO frdcall_campaign_dnc (phone_number, campaign_id) VALUES ('#P:0#', '#P:1#');`,
        q0236: `DELETE FROM frdcall_dnc WHERE phone_number='#P:0#' LIMIT 1;`,
        q0237: `DELETE FROM frdcall_campaign_dnc WHERE phone_number='#P:0#' AND campaign_id = '#P:1#' LIMIT 1;`,
        q0238: `INSERT INTO frdcall_admin_log set event_date=NOW(), user='#P:0#', ip_address='${_configs.defaultCTIIP}', event_section='LISTS', event_type='#P:1#', record_id='#P:2#', event_code='#P:3#', event_sql="#P:4#", event_notes='';`,
        q0239: `INSERT INTO frdcall_dnc_log SET phone_number='#P:0#', campaign_id='#P:1#', action='#P:2#', action_date=NOW(), user='#P:3#';`,

        q0400: `UPDATE phones SET active = '#P:0#', status = '#P:1#' WHERE extension = "#P:2#" LIMIT 1`,
        q0401: `SELECT user_group FROM frdcall_users WHERE user = "#P:0#";`,
        q0402: `SELECT user FROM frdcall_users WHERE user_group = "#P:0#";`,
        q0403: `SELECT campaign_id FROM frdcall_campaigns WHERE user_group = "#P:0#";`,
        q0404: `UPDATE frdcall_user_groups SET allowed_campaigns = REPLACE(allowed_campaigns ," #P:0# " ," ") WHERE true AND true`,
        q0405: `UPDATE frdcall_user_groups SET admin_viewable_groups = REPLACE(admin_viewable_groups ," #P:0# " ," ") WHERE true AND true`,
        q0406: `SELECT read_export FROM frdcall_user_features WHERE user_id = "#P:0#" AND is_delete = 0 LIMIT 1`,
        q0407: `SELECT daily_reset_limit,resets_today from frdcall_lists where list_id='#P:0#'`,
        q0408: `UPDATE frdcall_lists set resets_today=(resets_today + 1) where list_id='#P:0#' LIMIT 1`,
        q0409: `UPDATE frdcall_list set called_since_last_reset='N', modify_date=NOW() where list_id='#P:0#' AND true`,
        q0410: `
      SELECT url_list_upload
      FROM frdcall_admins a 
      LEFT JOIN frdcall_user_groups b 
      ON a.customer_id = b.user_group 
      WHERE is_delete = 0 
      AND LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1),' '), b.admin_viewable_groups) > 0 
      LIMIT 1
    `,
        q0411: `DELETE from frdcall_list where list_id = #P:0# AND lead_id IN (#P:1#) AND true`,
        q0412: `DELETE from frdcall_list_extend where list_id = #P:0# AND lead_id IN (#P:1#) AND true`,
        q0413: `SELECT *
            FROM frdcall_list vi
            LEFT JOIN frdcall_list_extend ve ON ve.lead_id = vi.lead_id
            WHERE vi.list_id = "#P:0#"`,
        q0414: `UPDATE frdcall_list set #P:0#='#P:1#', modify_date=NOW() where lead_id = #P:2# LIMIT 1`,
        q0415: `SELECT li.list_id, li.lead_id,li.sforceId, li.source_id, date_format(li.last_local_call_time,'%Y-%m-%d %H:%i:%s') last_local_call_time, li.user, li.called_since_last_reset, li.status, 
		li.called_count, li.security_phrase, li.phone_number, li.alt_phone, li.title, li.last_name, li.last_name_kana, li.gender, li.postal_code, li.state, li.city, li.address1, li.address1_kana, 
        li.address2, li.address2_kana, li.fax, li.url, li.email, li.comments, date_format(li.entry_date,'%Y-%m-%d %H:%i:%s') entry_date, 
        date_format(IF(li.modify_date="0000-00-00 00:00:00",null,li.modify_date),'%Y-%m-%d %H:%i:%s') modify_date, li.vendor_lead_code, al.remark, le.sms_data, le.extend_col
        FROM frdcall_list li
        LEFT JOIN  frdcall_list_extend le
        ON li.lead_id = le.lead_id
        LEFT JOIN (
            SELECT a.lead_id, a.remark 
            FROM frdcall_agent_log a 
            WHERE lead_id IS NOT NULL 
            AND a.event_time = (
                SELECT MAX(event_time)
                FROM frdcall_agent_log b 
                WHERE b.remark IS NOT NULL 
                AND a.lead_id = b.lead_id
            )
        ) al
        ON li.lead_id = al.lead_id
        WHERE li.list_id = '#P:0#'
        LIMIT 10000
        `,
        q0416: `SELECT lead_id,extend_col FROM frdcall_list_extend WHERE list_id = '#P:0#'`,
        q0417: `DELETE from frdcall_list where lead_id = #P:0# and phone_number = '#P:1#' LIMIT 1`,
        q0418: `DELETE from frdcall_list_extend where lead_id = #P:0# LIMIT 1`,
        q0419: `UPDATE frdcall_remote_agents SET status='#P:0#' WHERE remote_agent_id='#P:1#' LIMIT 1`,
        q0420: `SELECT CONCAT(ig.user_group, " - ", cc.campaign_id) AS uc, cc.campaign_id, ig.user_group, group_id AS value, CONCAT(group_id, " - ", group_name) AS label FROM frdcall_inbound_groups ig INNER JOIN frdcall_campaigns cc ON cc.closer_campaigns RLIKE ig.group_id WHERE group_handling='PHONE' #P:0# GROUP BY label ORDER BY group_id`,
        q0421: `SELECT user_group, campaign_id AS value, CONCAT(campaign_id, " - ", campaign_name) AS label FROM frdcall_campaigns #P:0# GROUP BY label order by campaign_id`,
        q0422: `SELECT cc.campaign_id, cc.closer_campaigns, cl.list_id AS value, CONCAT(cl.list_id, " - ", cl.list_name) AS label 
        FROM frdcall_lists cl
        INNER JOIN frdcall_campaigns cc ON cc.campaign_id=cl.campaign_id #P:0# GROUP BY label`,
        q0423: `SELECT user_group AS value, user_group AS label FROM frdcall_user_groups #P:0#`,
        q0424: `
            SELECT 
                campaign_id AS class,
                closer_campaigns AS class2, 
                status AS value, 
                CONCAT(status, " - ", status_name) AS label 
            FROM (
                SELECT DISTINCT main.status,main.status_name,ext.campaign_id,cc.closer_campaigns
                FROM frdcall_campaign_statuses main
                LEFT JOIN frdcall_campaign_statuses_ext ext
                ON main.status=ext.status AND main.campaign_id=ext.campaign_id
                LEFT JOIN frdcall_campaigns cc
                ON cc.campaign_id=ext.campaign_id
                #P:0#
                ORDER BY ext.campaign_id, ext.item_order, main.status
            )a
                                                UNION
            SELECT 
                "drop" AS class,
                null AS class2,
                status AS value, 
                CONCAT(status, " - ", status_name) AS label 
            FROM frdcall_statuses 
            WHERE status = 'DROP' OR status = 'GONE'
                                                UNION
            SELECT 
                "system" AS class,
                null AS class2,
                status AS value, 
                CONCAT(status, " - ", status_name) AS label 
            FROM (
                SELECT DISTINCT status,status_name
                FROM frdcall_statuses 
                WHERE status IN('A','AA','AB','ADC','ADCT','B','DNC','N','NA','PDROP','PM','PU','QUEUE','AFTHRS','TIMEOT','XFER','INCALL','WBFORM','SVYCLM')
                ORDER BY status
            )a
            `,
        q0425: `
            WITH uniqueids AS (
                SELECT 
                    l.in, 
                    l.out, 
                    min(l.call_date) AS call_date, 
                    l.uniqueid AS uniqueid 
                FROM 
                ((
                    SELECT 
                        cl.uniqueid, 
                        cl.call_date, 
                        false AS "in", 
                        true AS "out"
                    FROM
                        frdcall_log cl
                    LEFT JOIN 
                        call_log l ON l.uniqueid=cl.uniqueid
                    WHERE 
                        cl.call_date BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59"
                        AND cl.uniqueid <> ""
                        #P:2#
                        AND (cl.user_group IN(#P:4#) OR cl.user='FRAD' OR l.channel='CONGESTION')
                        AND cl.status IN(#P:6#)
                        AND cl.list_id IN(#P:7#)
                )
                UNION
                (
                    SELECT 
                        uniqueid, 
                        call_date, 
                        true AS "in", 
                        false AS "out"
                    FROM 
                        frdcall_closer_log
                    WHERE 
                        call_date BETWEEN "#P:0# 00:00:00"
                        AND "#P:1# 23:59:59"
                        AND uniqueid <> ""
                        #P:3#
                        AND (user_group IN(#P:4#) OR user='FRCL' OR status='XFER' OR status='DROP' OR status='GONE')
                        AND status IN(#P:6#)
                        AND list_id IN(#P:7#)
                        AND CASE WHEN status='GONE' THEN JSON_VALID(comments) = 1 ELSE true END
                )) AS l
                GROUP BY 
                    l.uniqueid
                LIMIT 10000
            )
            SELECT DISTINCT
                #P:8#
            FROM
                frdcall_closer_log vl
                INNER JOIN uniqueids ids ON ids.#P:12# = 1 AND ids.uniqueid = vl.uniqueid
                LEFT JOIN (
                    SELECT *, ROW_NUMBER() OVER(PARTITION BY uniqueid ORDER BY event_time ASC) Num
                    FROM frdcall_agent_log
                    WHERE user_group IN(#P:4#)
                        AND event_time BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59"
                    ) al ON vl.uniqueid = al.uniqueid
                LEFT JOIN (
                    SELECT *, ROW_NUMBER() OVER(PARTITION BY uniqueid ORDER BY start_time ASC) Num
                    FROM recording_log a
                    INNER JOIN (SELECT user FROM frdcall_users WHERE user_group IN(#P:4#))b USING(user)
                    WHERE start_time BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59"
                ) rl ON vl.uniqueid=rl.uniqueid AND (al.Num IS NULL OR al.Num=rl.Num)
                #P:9#
        `,
        q0426: `
            WITH uniqueids AS (
                SELECT 
                    l.in, 
                    l.out, 
                    min(l.call_date) AS call_date, 
                    l.uniqueid AS uniqueid 
                FROM 
                ((
                    SELECT 
                        cl.uniqueid, 
                        cl.call_date, 
                        false AS "in", 
                        true AS "out"
                    FROM
                        frdcall_log cl
                    LEFT JOIN 
                        call_log l ON l.uniqueid=cl.uniqueid
                    WHERE 
                        cl.call_date BETWEEN "#P:0# 00:00:00"
                        AND "#P:1# 23:59:59"
                        AND cl.uniqueid <> ""
                        #P:2#
                        AND (cl.user_group IN(#P:4#) OR cl.user='FRAD' OR l.channel='CONGESTION')
                        AND cl.status IN(#P:6#)
                        AND cl.list_id IN(#P:7#)
                )
                UNION
                (
                    SELECT 
                        uniqueid, 
                        call_date, 
                        true AS "in", 
                        false AS "out"
                    FROM 
                        frdcall_closer_log
                    WHERE 
                        call_date BETWEEN "#P:0# 00:00:00"
                        AND "#P:1# 23:59:59"
                        AND uniqueid <> ""
                        #P:3#
                        AND (user_group IN(#P:4#) OR user='FRCL' OR status='XFER' OR status='DROP' OR status='GONE')
                        AND status IN(#P:6#)
                        AND list_id IN(#P:7#)
                        AND CASE WHEN status='GONE' THEN JSON_VALID(comments) = 1 ELSE true END
                )) AS l
                GROUP BY 
                    l.uniqueid
                LIMIT 10000
            )
            SELECT DISTINCT * FROM (
                (SELECT DISTINCT
                    #P:8#
                FROM    
                    frdcall_closer_log vl
                    INNER JOIN uniqueids ids ON ids.#P:12# = 1 AND ids.uniqueid = vl.uniqueid
                    LEFT JOIN (
                        SELECT *, ROW_NUMBER() OVER(PARTITION BY uniqueid ORDER BY event_time ASC) Num
                        FROM frdcall_agent_log
                        WHERE user_group IN(#P:4#)
                        AND event_time BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59"
                    ) al ON vl.uniqueid = al.uniqueid
                    LEFT JOIN (
                        SELECT *, ROW_NUMBER() OVER(PARTITION BY uniqueid ORDER BY start_time ASC) Num
                        FROM recording_log a
                        INNER JOIN (SELECT user FROM frdcall_users WHERE user_group IN(#P:4#))b USING(user)
                        WHERE start_time BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59"
                    ) rl ON vl.uniqueid=rl.uniqueid AND (al.Num IS NULL OR al.Num=rl.Num)
                    #P:9#
                    WHERE vl.list_id IN(#P:7#)
                )
            UNION (SELECT DISTINCT
                    #P:10#
                FROM
                    frdcall_log vl
                    INNER JOIN uniqueids ids ON ids.#P:12# = 1 AND ids.uniqueid = vl.uniqueid
                    LEFT JOIN call_log cl ON cl.uniqueid=vl.uniqueid 
                    LEFT JOIN frdcall_server_carriers_index sci ON sci.prefix=left(cl.extension,7)
                    LEFT JOIN (SELECT * FROM recording_log INNER JOIN (SELECT user FROM frdcall_users WHERE user_group IN(#P:4#))b USING(user) WHERE start_time BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59") rl ON vl.uniqueid=rl.uniqueid
                    LEFT JOIN (SELECT * FROM frdcall_agent_log WHERE user_group IN(#P:4#) AND event_time BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59") al ON vl.uniqueid = al.uniqueid
                    #P:11#)
                ) AS l
        `,
        q0427: `SELECT talk_sec, dispo_sec, uniqueid FROM frdcall_agent_log WHERE uniqueid != "" AND event_time BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59" LIMIT 11000`,
        q0428: `SELECT list_id, count(*) as allc from frdcall_list group by list_id`,
        q0429: `SELECT DISTINCT user, full_name FROM frdcall_users WHERE user = '#P:0#';`,
        q0430: `SELECT MAX(b.changedon), cf.cf_1159->>'$.leadId' AS leadid, cf.cf_1159->>'$.formData' AS formData FROM frd_leaddetails l inner join frd_leadscf cf on l.leadid=cf.leadid INNER JOIN frd_modtracker_basic b ON b.crmid=l.leadid INNER JOIN frd_modtracker_detail d ON b.id=d.id WHERE b.changedon BETWEEN "#P:0# 00:00:00" AND "#P:1# 23:59:59" and d.fieldname="cf_1159" GROUP BY leadid`,
        q0431: `SELECT * FROM frdcall_campaign_statuses WHERE campaign_id IN ('#P:0#')`,
        q0432: `SELECT report_export FROM frdcall_user_features WHERE user_id = "#P:0#" AND is_delete = 0 LIMIT 1;`,
        q0433: `SELECT group_id AS value, CONCAT(group_id, " - ", group_name) AS label FROM frdcall_inbound_groups WHERE group_handling='PHONE' #P:0# ORDER BY group_id`,
        q0434: `WITH uniqueids AS (
                SELECT 
                    l.in, 
                    l.out, 
                    min(l.call_date) AS call_date, 
                    l.uniqueid AS uniqueid 
                FROM 
                ((
                    SELECT 
                        cl.uniqueid, 
                        cl.call_date, 
                        false AS "in", 
                        true AS "out"
                    FROM
                        frdcall_log cl
                    LEFT JOIN 
                        call_log l ON l.uniqueid=cl.uniqueid
                    WHERE 
						cl.call_date BETWEEN "#P:5# 00:00:00"
                        AND "#P:6# 23:59:59"
                        AND cl.uniqueid <> ""
                        AND (cl.user_group IN('#P:2#') OR cl.user='FRAD' OR l.channel='CONGESTION')
                        AND cl.status IN('#P:3#')
                        AND cl.list_id IN ('#P:1#')
                )
                UNION
                (
                    SELECT 
                        uniqueid, 
                        call_date, 
                        true AS "in", 
                        false AS "out"
                    FROM 
                        frdcall_closer_log
                    WHERE 
						call_date BETWEEN "#P:5# 00:00:00"
                        AND "#P:6# 23:59:59"
                        AND uniqueid <> ""
                        AND (user_group IN('#P:2#') OR user='FRCL' OR status='XFER' OR status='DROP' OR status='GONE')
                        AND status IN('#P:3#')
                        AND list_id IN ('#P:1#')
                        AND campaign_id IN ('#P:0#')
                        AND CASE WHEN status='GONE' THEN JSON_VALID(comments) = 1 ELSE true END
                )) AS l
                GROUP BY 
                    l.uniqueid
            )
            SELECT DISTINCT
                  cl.call_date, cl.status, rl.length_in_sec AS length_in_sec, s.human_answered AS ha1, s.sale AS sale1, s.dnc AS dnc1, s.customer_contact AS cc1, s.unworkable AS unw1, cs.human_answered AS ha2, cs.sale AS sale2, cs.dnc AS dnc2, cs.customer_contact AS cc2, cs.unworkable AS unw2, cl.list_id, cl.uniqueid
              FROM
                  frdcall_closer_log cl
              INNER JOIN 
                  uniqueids ids ON ids.in = 1 AND ids.call_date = cl.call_date AND ids.uniqueid = cl.uniqueid
              LEFT JOIN frdcall_lists ls ON cl.list_id = ls.list_id
              LEFT JOIN 
                  frdcall_statuses s 
                ON s.status=cl.status AND s.status IN('A','AA','AB','ADC','ADCT','B','DNC','N','NA','PDROP','PM','PU','QUEUE','AFTHRS','TIMEOT','XFER','DROP','INCALL','GONE','WBFORM','SVYCLM')
              LEFT JOIN 
                  frdcall_campaign_statuses cs 
                ON cs.status=cl.status AND ls.campaign_id=cs.campaign_id
              LEFT JOIN recording_log rl ON cl.uniqueid=rl.uniqueid
              WHERE CASE WHEN cl.status='GONE' THEN JSON_VALID(cl.comments) = 1 ELSE true END
              GROUP BY cl.uniqueid`,
        q0435: `SELECT graph_export FROM frdcall_user_features WHERE user_id = "#P:0#" AND is_delete = 0 LIMIT 1;`,
        q0436: `SELECT campaign_id AS value, CONCAT(campaign_id, " - ", campaign_name) AS label FROM frdcall_campaigns #P:0# order by campaign_id`,
        q0437: `SELECT user_group AS value, user_group AS label FROM frdcall_user_groups #P:0#`,
        q0438: `SELECT user AS value, CONCAT(user, " - ", full_name) AS label FROM frdcall_users #P:0#`,
        q0439: `SELECT group_id AS value, CONCAT(group_id, " - ", group_name) AS label FROM frdcall_inbound_groups WHERE group_handling='PHONE' AND user_group IN ('#P:0#') ORDER BY group_id`,
        q0440: ``,
        q0441: ``,
        q0442: `SELECT DISTINCT al.event_time, al.status, rl.length_in_sec AS length_in_sec, s.human_answered AS ha1, s.sale AS sale1, s.dnc AS dnc1, s.customer_contact AS cc1, s.unworkable AS unw1, cs.human_answered AS ha2, cs.sale AS sale2, cs.dnc AS dnc2, cs.customer_contact AS cc2, cs.unworkable AS unw2, cl.user, us.full_name
                FROM frdcall_agent_log al 
                INNER JOIN frdcall_log cl ON al.uniqueid=cl.uniqueid
                INNER JOIN recording_log rl ON al.uniqueid=rl.uniqueid
                LEFT JOIN frdcall_statuses s ON s.status=al.status
                LEFT JOIN frdcall_campaign_statuses cs ON cs.status=al.status
                LEFT JOIN frdcall_users us ON cl.user = us.user 
                WHERE al.uniqueid <> "" AND cl.campaign_id IN ('#P:0#') AND cl.user_group IN ('#P:1#') AND cl.user IN ('#P:2#') AND al.event_time >= '#P:3# 00:00:00' AND al.event_time <= '#P:4# 23:59:59'`,
        q0443: `SELECT DISTINCT al.event_time, al.status, rl.length_in_sec AS length_in_sec, s.human_answered AS ha1, s.sale AS sale1, s.dnc AS dnc1, s.customer_contact AS cc1, s.unworkable AS unw1, cs.human_answered AS ha2, cs.sale AS sale2, cs.dnc AS dnc2, cs.customer_contact AS cc2, cs.unworkable AS unw2, cl.user, cl.list_id, us.full_name
                FROM frdcall_agent_log al 
                INNER JOIN frdcall_closer_log cl ON al.uniqueid=cl.uniqueid
                INNER JOIN recording_log rl ON al.uniqueid=rl.uniqueid
                LEFT JOIN frdcall_statuses s ON s.status=al.status
                LEFT JOIN frdcall_campaign_statuses cs ON cs.status=al.status
                LEFT JOIN frdcall_users us ON cl.user = us.user 
                WHERE al.uniqueid <> "" AND cl.user_group IN ('#P:0#') AND cl.user IN ('#P:1#') AND al.event_time >= '#P:2# 00:00:00' AND al.event_time <= '#P:3# 23:59:59'`,
        q0444: `WITH uniqueids AS (
                SELECT 
                    l.in, 
                    l.out, 
                    min(l.call_date) AS call_date, 
                    l.uniqueid AS uniqueid 
                FROM 
                ((
                    SELECT 
                        cl.uniqueid, 
                        cl.call_date, 
                        false AS "in", 
                        true AS "out"
                    FROM
                        frdcall_log cl
                    LEFT JOIN 
                        call_log l ON l.uniqueid=cl.uniqueid
                    WHERE 
						cl.call_date BETWEEN "#P:5# 00:00:00"
                        AND "#P:6# 23:59:59"
                        AND cl.uniqueid <> ""
                        AND (cl.user_group IN('#P:2#') OR cl.user='FRAD' OR l.channel='CONGESTION')
                        AND cl.status IN('#P:3#')
                        AND cl.campaign_id IN ('#P:0#')
                        AND cl.list_id IN ('#P:1#')
                )
                UNION
                (
                    SELECT 
                        uniqueid, 
                        call_date, 
                        true AS "in", 
                        false AS "out"
                    FROM 
                        frdcall_closer_log
                    WHERE 
						call_date BETWEEN "#P:5# 00:00:00"
                        AND "#P:6# 23:59:59"
                        AND uniqueid <> ""
                        AND (user_group IN('#P:2#') OR user='FRCL' OR status='XFER' OR status='DROP' OR status='GONE')
                        AND status IN('#P:3#')
                        AND list_id IN ('#P:1#')
                        AND CASE WHEN status='GONE' THEN JSON_VALID(comments) = 1 ELSE true END
                )) AS l
                GROUP BY 
                    l.uniqueid
            )
            SELECT DISTINCT
                  cl.call_date, cl.status, rl.length_in_sec AS length_in_sec, s.human_answered AS ha1, s.sale AS sale1, s.dnc AS dnc1, s.customer_contact AS cc1, s.unworkable AS unw1, cs.human_answered AS ha2, cs.sale AS sale2, cs.dnc AS dnc2, cs.customer_contact AS cc2, cs.unworkable AS unw2, cl.list_id, li.list_name, cl.uniqueid
              FROM
                  frdcall_log cl
              INNER JOIN 
                  uniqueids ids
                ON ids.out = 1 AND ids.call_date = cl.call_date AND ids.uniqueid = cl.uniqueid
              LEFT JOIN frdcall_statuses s ON s.status=cl.status AND s.status IN('A','AA','AB','ADC','ADCT','B','DNC','N','NA','PDROP','PM','PU','QUEUE','AFTHRS','TIMEOT','XFER','DROP','INCALL','WBFORM','SVYCLM')
              LEFT JOIN frdcall_campaign_statuses cs ON cs.status=cl.status AND cl.campaign_id=cs.campaign_id
              LEFT JOIN recording_log rl ON cl.uniqueid=rl.uniqueid 
              LEFT JOIN frdcall_lists li ON cl.list_id = li.list_id
              GROUP BY cl.uniqueid`,
        q0445: `SELECT DISTINCT rl2.uniqueid AS uniqueid, 
              cl.call_date AS call_date, 
              cl.campaign_id AS campaign_id, 
              #P:0# AS campaign_name, 
              sci.name AS channel, 
              cl.length_in_sec AS length_in_sec, 
              cu.phone_login AS phone_login, 
              cl.phone_number AS phone_number, 
              cl.user AS user, 
              rl2.file_name AS filename
          FROM #P:1# cl 
          LEFT JOIN call_log cl2 ON cl2.uniqueid=cl.uniqueid 
          LEFT JOIN frdcall_server_carriers_index sci ON sci.prefix=left(cl2.extension,7)
          #P:2# 
          LEFT JOIN frdcall_users cu ON cu.user=cl.user 
          LEFT JOIN recording_log2 rl2 ON cl.uniqueid=rl2.uniqueid
          WHERE cl.uniqueid <> "" AND cl.call_date >= '#P:3# 00:00:00' 
              AND cl.call_date <= '#P:4# 23:59:59' 
              #P:5# 
              AND cl.list_id IN ('#P:6#')
              AND cl.status IN ('#P:7#')
              AND cl.user_group IN ('#P:8#')
              AND cl.length_in_sec > 5 
              AND rl2.file_name IS NOT NULL
          ORDER BY cl.uniqueid LIMIT 10000`,
        q0446: `SELECT report_export, audio_export FROM frdcall_user_features WHERE user_id = "#P:0#" AND is_delete = 0 LIMIT 1;`,
        q0447: `select status from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") order by item_order`,
        q0448: `DELETE from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") AND true`,
        q0449: `select count(*) as cnt from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") and status in ('#P:1#')`,
        q0450: `select count(*) as cnt from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#")`,
        q0451: `insert into frdcall_campaign_statuses_ext (campaign_id,status,item_order) values ("#P:0#","#P:1#",#P:2#)`,
        q0452: `DELETE from frdcall_campaign_statuses_ext where LOWER(campaign_id)=LOWER("#P:0#") and status not in ('#P:1#') AND true`,
        q0453: `SELECT f.formbuilderid AS value, f.name AS label, fcf.cf_940 AS data FROM frd_formbuildercf fcf INNER JOIN frd_formbuilder f ON f.formbuilderid=fcf.formbuilderid WHERE JSON_VALID(fcf.extra_configs) = 1
      AND LOWER(fcf.extra_configs->>"$[*].campid") RLIKE LOWER('#P:0#')
      AND fcf.extra_configs ->> "$[*].dispoid[*]" RLIKE '#P:1#|<ALL>'`,
        q0454: ``,
        q0455: ``,
        q0456: ``,
        q0457: ``,
        q0458: `SELECT * FROM frdcall_statuses`,
        q0459: `SELECT * FROM frdcall_campaign_statuses WHERE campaign_id = '#P:0#'`,
        q0460: `
        SELECT DISTINCT
		cl.call_date, cl.status, rl.length_in_sec AS length_in_sec, s.human_answered AS ha1, s.sale AS sale1, s.dnc AS dnc1, s.customer_contact AS cc1, s.unworkable AS unw1, cs.human_answered AS ha2, cs.sale AS sale2, cs.dnc AS dnc2, cs.customer_contact AS cc2, cs.unworkable AS unw2, COALESCE(s.category, cs.category) AS category,us.full_name AS user_label, us.user
        FROM
            (
                SELECT 
                    *
                FROM
                    frdcall_log
                WHERE 
                    call_date BETWEEN "#P:2# 00:00:00" AND "#P:3# 23:59:59"
                    AND uniqueid <> ""
                    AND campaign_id IN ('#P:0#')
                    AND list_id IN ('#P:1#')
            ) cl
        LEFT JOIN (SELECT * FROM recording_log WHERE start_time BETWEEN "#P:2# 00:00:00" AND "#P:3# 23:59:59" ) rl ON cl.uniqueid=rl.uniqueid 
        LEFT JOIN frdcall_statuses s ON s.status=cl.status
        LEFT JOIN frdcall_campaign_statuses cs ON cs.status=cl.status AND cl.campaign_id=cs.campaign_id
        LEFT JOIN frdcall_users us ON cl.user = us.user
        GROUP BY cl.uniqueid
        `,
        q0461: `
        SELECT DISTINCT
            cl.call_date, cl.status, 
            rl.length_in_sec AS length_in_sec, 
            s.completed AS comp1, s.human_answered AS ha1, s.sale AS sale1, s.dnc AS dnc1, s.customer_contact AS cc1, s.unworkable AS unw1, 
            cs.completed AS comp2, cs.human_answered AS ha2, cs.sale AS sale2, cs.dnc AS dnc2, cs.customer_contact AS cc2, cs.unworkable AS unw2, 
            cl.list_id, cl.uniqueid, cl.queue_seconds, 
            al.dispo_sec, al.talk_sec, al.user AS al_user, cl.user, al.uniqueid AS al_uniqueid, 
            us.full_name AS user_label
        FROM
            frdcall_closer_log cl
        LEFT JOIN (
            SELECT *
            FROM recording_log
            WHERE start_time BETWEEN "#P:2# 00:00:00" AND "#P:3# 23:59:59"
        )rl ON cl.uniqueid=rl.uniqueid
        LEFT JOIN frdcall_users us ON cl.user = us.user
        LEFT JOIN (
            SELECT * 
            FROM frdcall_agent_log
            WHERE event_time BETWEEN "#P:2# 00:00:00" AND "#P:3# 23:59:59"
        ) al ON cl.uniqueid=al.uniqueid
        LEFT JOIN frdcall_lists ls ON cl.list_id = ls.list_id
        LEFT JOIN 
            frdcall_statuses s 
        ON s.status=cl.status
        LEFT JOIN 
            frdcall_campaign_statuses cs 
        ON cs.status=cl.status AND ls.campaign_id=cs.campaign_id
        WHERE 
            cl.call_date BETWEEN "#P:2# 00:00:00" AND "#P:3# 23:59:59"
            AND cl.uniqueid <> ""
            AND cl.list_id IN ('#P:1#')
            AND cl.campaign_id IN ('#P:0#')
            AND CASE WHEN cl.status='GONE' THEN JSON_VALID(cl.comments) = 1 ELSE true END
        GROUP BY cl.uniqueid
            `,
        q0462: ``,
        q0463: ``,
        q0464: ``,
        q0465: ``,
        q0466: ``,
        q0467: ``,
        q0468: ``,
        q0469: ``,
        q0470: ``,
        q0471: ``,
        q0472: ``,
        q0473: ``,
        q0474: ``,
        q0475: ``,
        q0476: ``,
        q0477: ``,
        q0478: ``,
        q0479: ``,
        q0480: ``,
        q0481: `select count(*) \`count\` from frdcall_log where phone_number="#P:0#" and campaign_id="#P:1#" and (call_date > now() - interval 5 minute or end_epoch > unix_timestamp() - 300) and (call_date <= now() or end_epoch <= unix_timestamp())`,
        q0482: ``,
        q0483: ``,
        q0484: ``,
        q0485: ``,
        q0486: ``,
        q0487: ``,
        q0488: ``,
        q0489: ``,
        q0490: ``,
        q0491: ``,
        q0492: ``,
        q0493: ``,
        q0494: ``,
        q0495: ``,
        q0496: ``,
        q0497: ``,
        q0498: ``,
        q0499: ``,
        q0500: `INSERT INTO frdcall_admin_log set event_date=NOW(), user='#P:0#', ip_address='#P:1#', event_section='#P:2#', event_type='#P:3#', record_id='#P:4#', event_code='#P:5#', event_sql='#P:6#', event_notes='#P:7#';`,
        // オペレーター作成 0:user, 1:pass, 2:full_name, 3:group , 4:phone_number
        q0501: `INSERT INTO frdcall_users(
            user_id, user, pass, full_name, user_level, user_group, phone_login, phone_pass, delete_users, delete_user_groups, delete_lists, delete_campaigns, delete_ingroups, delete_remote_agents, load_leads, campaign_detail, ast_admin_access, ast_delete_phones, delete_scripts, modify_leads, hotkeys_active, change_agent_campaign, agent_choose_ingroups, closer_campaigns, scheduled_callbacks, agentonly_callbacks, agentcall_manual, frdcall_recording, frdcall_transfers, delete_filters, alter_agent_interface_options, closer_default_blended, delete_call_times, modify_call_times, modify_users, modify_campaigns, modify_lists, modify_scripts, modify_filters, modify_ingroups, modify_usergroups, modify_remoteagents, modify_servers, view_reports, frdcall_recording_override, alter_custdata_override, qc_enabled, qc_user_level, qc_pass, qc_finish, qc_commit, add_timeclock_log, modify_timeclock_log, delete_timeclock_log, alter_custphone_override, vdc_agent_api_access, modify_inbound_dids, delete_inbound_dids, active, alert_enabled, download_lists, agent_shift_enforcement_override, manager_shift_enforcement_override, shift_override_flag, export_reports, delete_from_dnc, email, user_code, territory, allow_alerts, agent_choose_territories, custom_one, custom_two, custom_three, custom_four, custom_five, voicemail_id, agent_call_log_view_override, callcard_admin, agent_choose_blended, realtime_block_user_info, custom_fields_modify, force_change_password, agent_lead_search_override, modify_shifts, modify_phones, modify_carriers, modify_labels, modify_statuses, modify_voicemail, modify_audiostore, modify_moh, modify_tts, preset_contact_search, modify_contacts, modify_same_user_level, admin_hide_lead_data, admin_hide_phone_data, agentcall_email, modify_email_accounts, failed_login_count, last_login_date, last_ip, pass_hash, alter_admin_interface_options, max_inbound_calls, modify_custom_dialplans, wrapup_seconds_override, modify_languages, selected_language, user_choose_language, ignore_group_on_search, api_list_restrict, api_allowed_functions, lead_filter_id, admin_cf_show_hidden, agentcall_chat, user_hide_realtime, access_recordings, modify_colors, user_nickname, user_new_lead_limit, api_only_user, modify_auto_reports, modify_ip_lists, ignore_ip_list, ready_max_logout, export_gdpr_leads, pause_code_approval, max_hopper_calls, max_hopper_calls_hour, mute_recordings, hide_call_log_info, next_dial_my_callbacks, user_admin_redirect_url, max_inbound_filter_enabled, max_inbound_filter_statuses, max_inbound_filter_ingroups, max_inbound_filter_min_sec, status_group_id, mobile_number, two_factor_override, manual_dial_filter
        )
        VALUES (
            '', '#P:0#', '#P:1#', '#P:2#', '5', '#P:3#', '#P:4#', '#P:1#', '0', '0', '0', '0', '0', '0', '1', '1', '1', '1', '0', '0', '0', '1', '1', '', '0', '0', '1', '1', '1', '0', '1', '1', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '1', '1', 'DISABLED', 'NOT_ACTIVE', '0', '1', '0', '0', '0', '0', '0', '0', 'NOT_ACTIVE', '1', '0', '0', 'Y', '0', '1', 'DISABLED', '1', '0', '1', '1', '', '', '', '0', '0', '', '', '', '', '', '', 'DISABLED', '1', '1', '0', '0', 'N', 'NOT_ACTIVE', '1', '1', '1', '1', '1', '1', '1', '1', '0', 'NOT_ACTIVE', '1', '0', '0', '0', '0', '0', '0', '2001-01-01 00:00:01', '', '', '1', '0', '0', '-1', '1', 'Japanese', '0', '0', '1', ' ALL_FUNCTIONS ', 'NONE', '0', '0', '0', '0', '1', '', '-1', '0', '0', '0', '0', '-1', '0', '0', '0', '0', 'DISABLED', 'DISABLED', 'NOT_ACTIVE', '', '0', '', '', '-1', '', '', 'NOT_ACTIVE', 'DISABLED'
        );
        `,
        q0502: `INSERT INTO frdcall_users (
            user, pass, full_name, user_level, user_group, phone_login, phone_pass, delete_users, delete_user_groups, delete_lists, delete_campaigns, delete_ingroups, delete_remote_agents, load_leads, campaign_detail, ast_admin_access, ast_delete_phones, delete_scripts, modify_leads, hotkeys_active, change_agent_campaign, agent_choose_ingroups, closer_campaigns, scheduled_callbacks, agentonly_callbacks, agentcall_manual, frdcall_recording, frdcall_transfers, delete_filters, alter_agent_interface_options, closer_default_blended, delete_call_times, modify_call_times, modify_users, modify_campaigns, modify_lists, modify_scripts, modify_filters, modify_ingroups, modify_usergroups, modify_remoteagents, modify_servers, view_reports, frdcall_recording_override, alter_custdata_override, qc_enabled, qc_user_level, qc_pass, qc_finish, qc_commit, add_timeclock_log, modify_timeclock_log, delete_timeclock_log, alter_custphone_override, vdc_agent_api_access, modify_inbound_dids, delete_inbound_dids, active, alert_enabled, download_lists, agent_shift_enforcement_override, manager_shift_enforcement_override, shift_override_flag, export_reports, delete_from_dnc, email, user_code, territory, allow_alerts, agent_choose_territories
        )
        VALUES (
            '#P:0#', '#P:1#', '#P:2#', '6', '#P:3#', '#P:4#', '#P:1#', '0', '0', '0', '0', '0', '0', '1', '1', '1', '1', '0', '0', '0', '1', '1', '', '0', '0', '1', '1', '1', '0', '1', '1', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '1', '1', 'DISABLED', 'NOT_ACTIVE', '0', '1', '0', '0', '0', '0', '0', '0', 'NOT_ACTIVE', '1', '0', '0', 'Y', '0', '1', 'DISABLED', '1', '0', '1', '1', '', '', '0', '0', '', '', 'DISABLED', '1', '1', '0', '0', 'N', 'NOT_ACTIVE', '1', '1', '1', '1', '1', '1', '1', '1', '0', 'NOT_ACTIVE', '1', '0', '0', '0', '0', '0', '0', '2001-01-01 00:00:01', '', '', '1', '0', '0', '-1', '1', 'Japanese', '0', '0', '1', ' ALL_FUNCTIONS ', 'NONE', '0', '0', '0', '0', '1', '', '-1', '0', '0', '0', '0', '-1', '0', '0', '0', '0', 'DISABLED', 'DISABLED', 'NOT_ACTIVE', '', '0', '', '', '-1', '', '', 'NOT_ACTIVE', 'DISABLED', '', '', '', '', '', 'DISABLED', 'DISABLED', 'NOT_ACTIVE', '', '0', '', '', '-1', '', '', 'NOT_ACTIVE', 'DISABLED', '', '', '', '', '', '', 'DISABLED', 'DISABLED', 'NOT_ACTIVE'
        );
        `,
        q0503: `INSERT INTO frdcall_users (
            user, pass, full_name, user_level, user_group, phone_login, phone_pass, delete_users, delete_user_groups, delete_lists, delete_campaigns, delete_ingroups, delete_remote_agents, load_leads, campaign_detail, ast_admin_access, ast_delete_phones, delete_scripts, modify_leads, hotkeys_active, change_agent_campaign, agent_choose_ingroups, scheduled_callbacks, agentonly_callbacks, agentcall_manual, frdcall_recording, frdcall_transfers, delete_filters, alter_agent_interface_options, closer_default_blended, delete_call_times, modify_call_times, modify_users, modify_campaigns, modify_lists, modify_scripts, modify_filters, modify_ingroups, modify_usergroups, modify_remoteagents, modify_servers, view_reports, frdcall_recording_override, alter_custdata_override, qc_enabled, qc_user_level, qc_pass, qc_finish, qc_commit, add_timeclock_log, modify_timeclock_log, delete_timeclock_log, alter_custphone_override, vdc_agent_api_access, modify_inbound_dids, delete_inbound_dids, active, alert_enabled, download_lists, agent_shift_enforcement_override, manager_shift_enforcement_override, shift_override_flag, export_reports, delete_from_dnc, email, user_code, territory, allow_alerts, agent_choose_territories, last_login_date, last_ip, failed_login_count, max_inbound_calls, modify_languages, selected_language, user_choose_language, api_list_restrict, api_allowed_functions, alter_admin_interface_options, max_hopper_calls
        ) VALUES (
            '#P:0#', '#P:1#', '#P:2#', '7', '#P:3#', '#P:4#', '#P:1#', '1', '0', '1', '1', '1', '1', '1', '1', '1', '1', '0', '1', '0', '1', '1', '', '0', '0', '1', '1', '1', '0', '1', '1', '1', '1', '1', '1', '1', '0', '0', '1', '0', '1', '1', '1', 'DISABLED', 'NOT_ACTIVE', '0', '1', '0', '0', '0', '0', '0', '0', 'NOT_ACTIVE', '1', '1', '1', 'Y', '0', '1', 'DISABLED', '1', '0', '1', '1', '', '', '0', '0', '', '', 'DISABLED', '1', '1', '0', '0', 'N', 'NOT_ACTIVE', '1', '1', '1', '1', '1', '1', '1', '1', '1', 'NOT_ACTIVE', '1', '0', '0', '0', '0', '0', '0', '2001-01-01 00:00:01', '', '0', '-1', '1', 'Japanese', '0', '0', '1', ' ALL_FUNCTIONS ', 'NONE', '0', '0', '0', '0', '1', '1', '-1', '0', '0', '0', '0', '-1'
        );
        `,
        q0504: `INSERT INTO frdcall_users (
            user, pass, full_name, user_level, user_group, phone_login, phone_pass, delete_users, delete_user_groups, delete_lists, delete_campaigns, delete_ingroups, delete_remote_agents, load_leads, campaign_detail, ast_admin_access, ast_delete_phones, delete_scripts, modify_leads, hotkeys_active, change_agent_campaign, agent_choose_ingroups, scheduled_callbacks, agentonly_callbacks, agentcall_manual, frdcall_recording, frdcall_transfers, delete_filters, alter_agent_interface_options, closer_default_blended, delete_call_times, modify_call_times, modify_users, modify_campaigns, modify_lists, modify_scripts, modify_filters, modify_ingroups, modify_usergroups, modify_remoteagents, modify_servers, view_reports, frdcall_recording_override, alter_custdata_override, qc_enabled, qc_user_level, qc_pass, qc_finish, qc_commit, add_timeclock_log, modify_timeclock_log, delete_timeclock_log, alter_custphone_override, vdc_agent_api_access, modify_inbound_dids, delete_inbound_dids, active, alert_enabled, download_lists, agent_shift_enforcement_override, manager_shift_enforcement_override, shift_override_flag, export_reports, delete_from_dnc, email, user_code, territory, allow_alerts, agent_choose_territories, last_login_date, last_ip, failed_login_count, max_inbound_calls, modify_languages, selected_language, user_choose_language, api_list_restrict, api_allowed_functions, alter_admin_interface_options, max_hopper_calls, modify_custom_dialplans, wrapup_seconds_override, access_recordings, modify_colors, user_nickname, user_new_lead_limit, api_only_user, modify_auto_reports, modify_ip_lists, ignore_ip_list, ready_max_logout, export_gdpr_leads, pause_code_approval, max_hopper_calls_hour, mute_recordings, hide_call_log_info, next_dial_my_callbacks, user_admin_redirect_url, max_inbound_filter_enabled, max_inbound_filter_statuses, max_inbound_filter_ingroups, max_inbound_filter_min_sec, status_group_id, mobile_number, two_factor_override, manual_dial_filter, sf_user, sf_pass, sf_securitytoken, sf_camp, sk_usertoken, sk_bottoken, sk_channel, sf_serverUrl
        ) VALUES (
            '#P:0#', '#P:1#', '#P:2#', '8', '#P:3#', '#P:4#', '#P:1#', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '0', '1', '1', '', '1', '0', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', 'DISABLED', 'NOT_ACTIVE', '0', '1', '0', '0', '0', '1', '1', '1', 'NOT_ACTIVE', '1', '1', '1', 'Y', '0', '1', 'DISABLED', '1', '0', '1', '1', '', '', '0', '0', '', '', 'DISABLED', '1', '1', '0', '0', 'N', 'NOT_ACTIVE', '1', '1', '1', '1', '1', '1', '1', '1', '1', 'NOT_ACTIVE', '1', '0', '0', '0', '0', '0', '0', '2001-01-01 00:00:01', '', '0', '-1', '1', 'Japanese', '1', '0', '0', 'ALL_FUNCTIONS', 'NONE', '0', '0', '0', '0', '1', '-1', '0', '0', '0', '0', '-1', '0', '1', '0', '0', 'DISABLED', 'DISABLED', 'NOT_ACTIVE', '', '0', '', '', '-1', '', '', 'NOT_ACTIVE', 'DISABLED', '', '', '', '', '', 'DISABLED', 'DISABLED', 'NOT_ACTIVE'
        );        
        `,
        q0505: `INSERT INTO frdcall_user_extend_privilege (user) values('#P:0#');`,
        q0510: `
        INSERT INTO phones (
            extension, dialplan_number, voicemail_id, phone_ip, computer_ip, server_ip, login, pass, status, active, phone_type, fullname, company, picture, messages, old_messages, protocol, local_gmt, ASTmgrUSERNAME, ASTmgrSECRET, login_user, login_pass, login_campaign, park_on_extension, conf_on_extension, FRDCALL_park_on_extension, FRDCALL_park_on_filename, monitor_prefix, recording_exten, voicemail_exten, voicemail_dump_exten, ext_context, dtmf_send_extension, call_out_number_group, client_browser, install_directory, local_web_callerID_URL, FRDCALL_web_URL, AGI_call_logging_enabled, user_switching_enabled, conferencing_enabled, admin_hangup_enabled, admin_hijack_enabled, admin_monitor_enabled, call_parking_enabled, updater_check_enabled, AFLogging_enabled, QUEUE_ACTION_enabled, CallerID_popup_enabled, voicemail_button_enabled, enable_fast_refresh, fast_refresh_rate, enable_persistant_mysql, auto_dial_next_number, VDstop_rec_after_each_call, DBX_server, DBX_database, DBX_user, DBX_pass, DBX_port, DBY_server, DBY_database, DBY_user, DBY_pass, DBY_port, outbound_cid, enable_sipsak_messages, email, template_id, conf_override, phone_context, phone_ring_timeout, conf_secret, delete_vm_after_email, is_webphone, use_external_server_ip, codecs_list, codecs_with_template, webphone_dialpad, on_hook_agent, webphone_auto_answer, voicemail_timezone, voicemail_options, user_group, voicemail_greeting, voicemail_dump_exten_no_inst, voicemail_instructions, on_login_report, unavail_dialplan_fwd_exten, unavail_dialplan_fwd_context, nva_call_url, nva_search_method, nva_error_filename, nva_new_list_id, nva_new_phone_code, nva_new_status, webphone_dialbox, webphone_mute, webphone_volume, webphone_debug, outbound_alt_cid, conf_qualify, webphone_layout, mohsuggest, peer_status
        )
        VALUES(
            '#P:0#', '#P:0#', '#P:0#', '', '', '#P:1#', '#P:2#', '#P:3#', 'ACTIVE', 'Y', '', '#P:2#', '', '', '0', '0', 'SIP', '9.00', 'cron', '1234', '', '', '', '8301', '8302', '8301', 'park', '8612', '8309', '8501', '85026666666666', 'default', 'local/8500998@default', 'Zap/g2/', '/usr/bin/mozilla', '/usr/local/perl_TK', 'http://www.frdcall.org/test_callerid_output.php', '', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '1', '0', '1000', '0', '1', '1', '', 'asterisk', 'cron', '1234', '3306', '', 'asterisk', '2024-02-14 17:07:32', '2024-02-14 17:07:32', '3306', '#P:0#', '0', '', '#P:5#', '', 'default', '60', '#P:3#', 'N', 'N', 'N', '', '0', 'Y', 'N', 'Y', 'eastern', '', '#P:4#', '', '85026666666667', 'Y', 'N', '', '', '', 'NONE', '', '995', '1', 'NVAINS', 'Y', 'Y', 'Y', 'N', '', 'Y', '', '', 'UNREGISTERED'
        );
        `,
        q0800: `
        SELECT COUNT(*) as cnt
        FROM frdcall_users 
        INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = (SELECT user_group FROM frdcall_users WHERE user =  '#P:0#'))a 
        ON (SELECT user_level FROM frdcall_users WHERE user =  '#P:0#') = 9 
        OR admin_viewable_groups RLIKE CONCAT('\\\\b',user_group, '\\\\b')
        WHERE user = '#P:1#'`,
        q0801: `SELECT id, user,report_inbound_default,report_inbound_calc,report_inbound_drop,report_inbound_gone  FROM frdcall_user_extend_privilege WHERE user = '#P:0#';`,
        q0802: `SELECT id, user,report_outbound_default,report_outbound_calc,report_outbound_drop  FROM frdcall_user_extend_privilege WHERE user = '#P:0#';`,
        q0803: `
            SELECT id,
                report_inbound_default DIV 2
                +report_inbound_calc DIV 2
                +report_inbound_drop DIV 2
                +report_inbound_gone DIV 2
                +report_outbound_default DIV 2
                +report_outbound_calc DIV 2
                +report_outbound_drop DIV 2
                +report_outbound_gone DIV 2 as priv_cnt
            FROM frdcall_user_extend_privilege WHERE user = '#P:0#';`,
        q0804: `
            SELECT
            (
                @a := (
                    SELECT
                        COUNT(*) as cnt
                    FROM
                        frdcall_live_agents
                    WHERE
                        (
                            comments != 'REMOTE'
                            OR comments IS NULL
                        )
                        AND status IN('READY', 'CLOSER')
                        AND LOWER(campaign_id) = LOWER('#P:0#')
                )
            )
            AND(
                SELECT
                    COUNT(*) as cnt
                FROM
                    frdcall_hopper
                WHERE
                LOWER(campaign_id) = LOWER('#P:0#')
            )
            OR NOT @a as cnt
            `,
        q0805: `
            SELECT a.campaign_id, COUNT( ho.campaign_id) as cnt
            FROM(
                SELECT DISTINCT ca.campaign_id
                FROM (
                    SELECT admin_viewable_groups 
                    FROM frdcall_users us
                    INNER JOIN frdcall_user_groups ug1
                    ON us.user_group = ug1.user_group
                    WHERE user= '#P:0#'
                )AS us 
                INNER JOIN frdcall_user_groups ug2
                ON us.admin_viewable_groups RLIKE CONCAT("\\\\b", ug2.user_group, "\\\\b")
                INNER JOIN frdcall_campaigns ca
                ON ug2.allowed_campaigns RLIKE CONCAT("\\\\b", ca.campaign_id, "\\\\b")
                AND ca.campaign_id <> "53804164"
                AND ca.dial_method IN ("RATIO","ADAPT_AVERAGE","ADAPT_HARD_LIMIT","ADAPT_TAPERED")
                INNER JOIN frdcall_live_agents la
                ON ca.campaign_id = la.campaign_id
                AND (la.comments != 'REMOTE' OR la.comments IS NULL)
                AND la.status IN ('READY', 'CLOSER')
            ) a
            LEFT JOIN frdcall_hopper ho
            ON a.campaign_id = ho.campaign_id
            GROUP BY a.campaign_id
            `,
        q0806: `
        select distinct a.customer_id,a.customer_name,g2.user_group,c.campaign_id,c.campaign_name,c.dial_prefix,d.did_pattern,d.did_description,d.menu_id
        ,group_concat(distinct i.group_id order by i.group_id) \`in_group_id\`,group_concat(distinct i.group_name order by i.group_id) \`in_group_name\`
        ,group_concat(distinct concat(u.user) order by u.user) \`users\`,group_concat(distinct p.extension order by u.user) \`extensions\`
        from frdcall_admins a
        inner join frdcall_user_groups g on a.customer_id=g.user_group
        left join frdcall_user_groups g2 on g.admin_viewable_groups rlike concat('\\\\b',g2.user_group,'\\\\b')
        left join frdcall_inbound_dids d on g.admin_viewable_groups rlike concat('\\\\b',d.user_group,'\\\\b') or g2.admin_viewable_groups rlike concat('\\\\b',d.user_group,'\\\\b')
        inner join frdcall_campaigns c on (true or c.dial_prefix = right(d.did_pattern,7))
        and (g.admin_viewable_groups rlike concat('\\\\b',c.user_group,'\\\\b') or g2.admin_viewable_groups rlike concat('\\\\b',c.user_group,'\\\\b'))
        left join frdcall_inbound_groups i on c.closer_campaigns rlike concat('\\\\b',i.group_id,'\\\\b')
        and (g.admin_viewable_groups rlike concat('\\\\b',i.user_group,'\\\\b') or g2.admin_viewable_groups rlike concat('\\\\b',i.user_group,'\\\\b'))
        inner join frdcall_users u on u.user_group=g2.user_group or u.user_group=g.user_group
        inner join phones p on u.phone_login=p.extension
        where a.customer_id rlike '#P:0#'
        group by a.customer_id,a.customer_name,g2.user_group,c.campaign_id,c.campaign_name,c.dial_prefix,d.did_pattern,d.did_description,d.menu_id
        `,
        q0807: `
        SELECT agent_log_id, event_time, status, remark, full_name
        FROM frdcall_agent_log al
        LEFT JOIN frdcall_users us
        ON al.user = us.user
        WHERE lead_id = '#P:0#'
        ORDER BY event_time DESC;
        `,
        q0808: `
        UPDATE frdcall_agent_log
        SET remark = '#P:1#'
        WHERE agent_log_id = '#P:0#'
        LIMIT 1
        `,
        q0809: `
        WITH
            _frdcall_log as (
                SELECT SUBSTRING_INDEX(uniqueid, '.', 1) as uniqueid, uniqueid as frdcall_id, us.user, us.full_name, call_date, lead_id, status, 1 as close_last_unique, 1 as agent_last_unique 
                FROM frdcall_log a
                LEFT JOIN frdcall_users us
                    ON a.user = us.user
                WHERE lead_id = '#P:0#' AND a.uniqueid IS NOT NULL AND a.uniqueid != '' AND a.uniqueid != 0
                ORDER BY a.uniqueid DESC
                LIMIT 100
            ),
            _frdcall_closer_log as (
                SELECT SUBSTRING_INDEX(a.uniqueid, '.', 1) as uniqueid, a.closecallid, us.user, us.full_name, a.call_date, a.lead_id, a.status, _a.close_last_unique
                FROM frdcall_closer_log a
                LEFT JOIN (SELECT SUBSTRING_INDEX(uniqueid, '.', 1) as uniqueid, MAX(call_date) as call_date, 1 as close_last_unique 
                        FROM frdcall_closer_log _a
                        WHERE lead_id = '#P:0#' AND uniqueid IS NOT NULL AND uniqueid != '' AND uniqueid != 0
                        GROUP BY SUBSTRING_INDEX(uniqueid, '.', 1)
                    ) _a
                    ON SUBSTRING_INDEX(a.uniqueid, '.', 1) = _a.uniqueid
                    AND a.call_date = _a.call_date
                LEFT JOIN frdcall_users us
                    ON a.user = us.user
                WHERE lead_id = '#P:0#' AND a.uniqueid IS NOT NULL AND a.uniqueid != '' AND a.uniqueid != 0
                ORDER BY a.uniqueid DESC
                LIMIT 100
            ),
            _frdcall_agent_log as (
                SELECT SUBSTRING_INDEX(a.uniqueid, '.', 1) as uniqueid, a.agent_log_id, us.user, us.full_name, a.event_time, a.lead_id, a.status, _a.agent_last_unique
                FROM frdcall_agent_log a
                LEFT JOIN (
                        SELECT SUBSTRING_INDEX(uniqueid, '.', 1) as uniqueid, MAX(event_time) as event_time, 1 as agent_last_unique
                        FROM frdcall_agent_log 
                        WHERE lead_id = '#P:0#' AND uniqueid IS NOT NULL AND uniqueid != '' AND uniqueid != 0
                        GROUP BY SUBSTRING_INDEX(uniqueid, '.', 1)
                    ) _a
                    ON SUBSTRING_INDEX(a.uniqueid, '.', 1) = _a.uniqueid
                    AND a.event_time = _a.event_time
                LEFT JOIN frdcall_users us
                    ON a.user = us.user
                WHERE lead_id = '#P:0#' AND a.uniqueid IS NOT NULL AND a.uniqueid != '' AND a.uniqueid != 0
                ORDER BY a.uniqueid DESC
                LIMIT 100
            )
        SELECT frdcall_id,closecallid ,agent_log_id ,COALESCE(c.full_name,b.full_name,a.full_name,c.user,b.user,a.user) as full_name, COALESCE(c.event_time,b.call_date,a.call_date) as call_date, COALESCE(c.status,b.status,a.status, "ERI") as status
        FROM  _frdcall_log a
        LEFT JOIN _frdcall_closer_log b ON a.uniqueid = b.uniqueid AND a.lead_id = b.lead_id AND b.close_last_unique = 1
        LEFT JOIN _frdcall_agent_log c ON a.uniqueid = c.uniqueid AND a.lead_id = c.lead_id AND c.agent_last_unique = 1
        UNION
        SELECT frdcall_id,closecallid ,agent_log_id ,COALESCE(c.full_name,b.full_name,a.full_name,c.user,b.user,a.user) as full_name, COALESCE(c.event_time,b.call_date,a.call_date) as call_date, COALESCE(c.status,b.status,a.status, "ERI") as status
        FROM  _frdcall_closer_log b
        LEFT JOIN _frdcall_log a ON b.uniqueid = a.uniqueid AND b.lead_id = a.lead_id --  USING(uniqueid, lead_id, close_last_unique)
        LEFT JOIN _frdcall_agent_log c ON b.uniqueid = c.uniqueid AND b.lead_id = c.lead_id AND c.agent_last_unique = 1
        UNION
        SELECT frdcall_id,closecallid ,agent_log_id ,COALESCE(c.full_name,b.full_name,a.full_name,c.user,b.user,a.user) as full_name, COALESCE(c.event_time,b.call_date,a.call_date) as call_date, COALESCE(c.status,b.status,a.status, "ERI") as status
        FROM  _frdcall_agent_log c
        LEFT JOIN _frdcall_log a ON c.uniqueid = a.uniqueid AND c.lead_id = a.lead_id
        LEFT JOIN _frdcall_closer_log b ON c.uniqueid = b.uniqueid AND c.lead_id = b.lead_id AND b.close_last_unique = 1
        ORDER BY call_date DESC
        LIMIT 100
        ;
        `,
        q0810: `
        SELECT 
            status AS value, 
            CONCAT(status, " - ", status_name) AS label 
        FROM frdcall_campaign_statuses
        WHERE campaign_id = '#P:0#'
        `,
        q0811: `SELECT campaign_id FROM frdcall_lists WHERE list_id = '#P:0#'`,
        q0812: `UPDATE frdcall_log SET status = '#P:1#' WHERE uniqueid = '#P:0#' LIMIT 1`,
        q0813: `UPDATE frdcall_closer_log SET status = '#P:1#' WHERE closecallid = '#P:0#' LIMIT 1`,
        q0814: `UPDATE frdcall_agent_log SET status = '#P:1#' WHERE agent_log_id = '#P:0#' LIMIT 1`,
        q0815: `
        SELECT DISTINCT COUNT(*) outCallCount, SUM(if(sale='Y', 1, 0)) outApoCount, SUM(if(human_answered='Y', 1, 0)) outHuCount
        FROM (
            SELECT * FROM frdcall_log
            WHERE uniqueid <> "" AND call_date >= DATE(NOW()) AND user="#P:0#" AND campaign_id="#P:1#"
        )l
        LEFT JOIN (SELECT status, sale, human_answered FROM frdcall_campaign_statuses WHERE lower(campaign_id) = lower('#P:1#')) c USING (status)
        LEFT JOIN recording_log rl ON l.uniqueid=rl.uniqueid
        `,
        q0816: `
        SELECT DISTINCT COUNT(*) inCallCount, SUM(if(sale='Y', 1, 0)) inApoCount, SUM(if(human_answered='Y', 1, 0)) inHuCount
        FROM (
            SELECT * 
            FROM frdcall_closer_log
            where uniqueid <> "" AND call_date >= DATE(NOW()) AND user="#P:0#" AND campaign_id="#P:1#"
        ) l
        LEFT JOIN (SELECT status, sale, human_answered FROM frdcall_campaign_statuses WHERE lower(campaign_id) = lower('#P:1#')) c USING (status)
        LEFT JOIN recording_log rl ON l.uniqueid=rl.uniqueid
        `,
        q0817: `
        INSERT INTO
            frdcall_list_extend ( lead_id, list_id, extend_col)
            VALUES( '#P:0#', '#P:1#', '#P:2#')
        ON DUPLICATE KEY UPDATE
            extend_col = '#P:2#'
        `,
        q0818: `
        WITH
        sumarry_last_log as (
            SELECT SUBSTRING_INDEX(uniqueid, '.', 1) as uniqueid, uniqueid as frdcall_id, null as closecallid, null as agent_log_id
            FROM frdcall_log
            WHERE call_date = (SELECT MAX(call_date) FROM frdcall_log WHERE lead_id = '#P:0#') 
            AND lead_id = '#P:0#' AND uniqueid IS NOT NULL AND uniqueid != '' AND uniqueid != 0
            UNION
            SELECT SUBSTRING_INDEX(uniqueid, '.', 1) as uniqueid, null as frdcall_id, closecallid, null as agent_log_id
            FROM frdcall_closer_log
            WHERE call_date = (SELECT MAX(call_date) FROM frdcall_closer_log WHERE lead_id = '#P:0#') 
            AND lead_id = '#P:0#' AND uniqueid IS NOT NULL AND uniqueid != '' AND uniqueid != 0
            UNION
            SELECT SUBSTRING_INDEX(uniqueid, '.', 1) as uniqueid, null as frdcall_id, null as closecallid, agent_log_id
            FROM frdcall_agent_log
            WHERE event_time = (SELECT MAX(event_time) FROM frdcall_agent_log  WHERE lead_id = '#P:0#')
            AND lead_id = '#P:0#' AND uniqueid IS NOT NULL AND uniqueid != '' AND uniqueid != 0
        )
        SELECT MAX(frdcall_id) as frdcall_id, MAX(closecallid) as closecallid, MAX(agent_log_id) as agent_log_id
        FROM sumarry_last_log
        WHERE uniqueid = (SELECT MAX(uniqueid) FROM sumarry_last_log)
        GROUP BY uniqueid
        ;
        `,
        q0819: `UNUSED`,
        // `
        // SELECT group_id, group_name, full_name, live_status,
        //     MAX(call_date) as last_date,
        //     MAX(CASE WHEN status IN ('LIVE') THEN live_queue_seconds ELSE 0 END) as max_queue,
        //     AVG(queue_seconds) as avg_queue,
        //     AVG(talk_sec) as avg_talk,
        //     COUNT(status) as cnt,
        //     COUNT(status NOT IN ('IVR','LIVE','TIMEOT','GONE','DROP','AFTHRS','QUEUE') OR NULL) / COUNT(status) as par_ans,
        //     COUNT(status='LIVE' OR NULL) as cnt_ivr,
        //     COUNT(status='CLOSER' OR NULL) as cnt_call,
        //     COUNT(status='TIMEOT' OR NULL) as cnt_timeout,
        //     COUNT(status='GONE' OR NULL) as cnt_gone,
        //     COUNT(status='AFTHRS' OR NULL) as cnt_aft,
        //     COUNT(status IN ('DROP', 'QUEUE') OR NULL) as cnt_drop,
        //     COUNT(ivr_status = 'OVER' OR NULL) as cnt_over,
        //     COUNT(status NOT IN ('IVR','LIVE','TIMEOT','GONE','DROP','AFTHRS','QUEUE') OR NULL) as cnt_ans
        // FROM (
        // 	SELECT ingrp.group_id, ingrp.group_name, closer.call_date,
        // 			us.user, us.full_name, closer.length_in_sec, closer.queue_seconds,
        // 			IF(rec.length_in_sec <= 0, null, rec.length_in_sec) talk_sec,
        // 			COALESCE(auto.status, closer.status) as status, live.status as live_status, closer.ivr_status,
        // 			TIMESTAMPDIFF(SECOND,auto.call_time,NOW())as live_queue_seconds
        // 	FROM(
        // 		SELECT group_id, group_name
        // 		FROM frdcall_inbound_groups
        // 		WHERE (SELECT GROUP_CONCAT(DISTINCT closer_campaigns SEPARATOR ' ') FROM frdcall_campaigns WHERE campaign_id IN ('#P:0#')) RLIKE CONCAT('\\\\b', group_id, '\\\\b')
        // 		AND group_id <> 'OPERATORQUE'
        // 	) ingrp
        // 	LEFT JOIN (
        // 		SELECT user, GROUP_CONCAT(DISTINCT ingroup SEPARATOR " ") as ingroup
        // 		FROM (
        // 			SELECT user, campaign_id as ingroup FROM frdcall_closer_log WHERE call_date > CONCAT( CASE WHEN HOUR(NOW()) < 6 THEN DATE_SUB(CURRENT_DATE, INTERVAL 1 DAY) ELSE CURRENT_DATE END,' 06:00:00')
        // 			UNION
        // 			SELECT user, closer_campaigns as ingroup FROM frdcall_users
        // 		)a
        // 		GROUP BY user
        // 	)users
        // 	ON users.ingroup RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
        // 	LEFT JOIN(
        // 		SELECT list_id, campaign_id, call_date, user, queue_seconds, length_in_sec, status, uniqueid, ivr_status
        // 		FROM frdcall_closer_log cl
        // 		WHERE call_date > CONCAT( CASE WHEN HOUR(NOW()) < 6 THEN DATE_SUB(CURRENT_DATE, INTERVAL 1 DAY) ELSE CURRENT_DATE END,' 06:00:00')
        // 	) closer
        // 	ON closer.campaign_id = ingrp.group_id
        // 	AND users.user = closer.user
        // 	LEFT JOIN frdcall_users ingrp_us
        // 	ON ingrp_us.closer_campaigns RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
        // 	AND users.user = ingrp_us.user
        // 	LEFT JOIN frdcall_users us
        // 	ON closer.user = us.user
        // 	OR users.user = us.user
        // 	LEFT JOIN frdcall_auto_calls auto
        // 	ON closer.uniqueid = auto.uniqueid
        // 	LEFT JOIN frdcall_live_agents live
        // 	ON live.closer_campaigns RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
        // 	AND live.user = ingrp_us.user
        // 	LEFT JOIN (SELECT uniqueid,SUM(length_in_sec)length_in_sec  FROM recording_log GROUP BY uniqueid) rec
        // 	ON closer.uniqueid = rec.uniqueid
        // )acd
        // GROUP BY group_id, group_name, full_name
        // `,
        q0820: `
        SELECT id,\`index\`,phone_number as value,xfer_name as \`key\` FROM frdcall_campaign_xfer_number WHERE campaign_id = '#P:0#' ORDER BY \`index\`;
        `,
        q0821: `
        INSERT INTO frdcall_campaign_xfer_number (campaign_id, \`index\`, phone_number, xfer_name) VALUES ('#P:0#', '#P:1#', '', '');
        `,
        q0822: `
        UPDATE frdcall_campaign_xfer_number SET xfer_name = '#P:1#' WHERE id = '#P:0#' LIMIT 1
        `,
        q0823: `
        UPDATE frdcall_campaign_xfer_number SET phone_number = '#P:1#' WHERE id = '#P:0#' LIMIT 1
        `,
        q0824: `
        DELETE FROM frdcall_campaign_xfer_number WHERE id = '#P:0#' LIMIT 1
        `,
        q0825: `
        UPDATE frdcall_campaign_xfer_number SET \`index\` = '#P:1#' WHERE id = '#P:0#' LIMIT 1
        `,
        q0826: `
        SELECT phone_number as value, CONCAT(xfer_name, '(' , phone_number, ')') as label FROM frdcall_campaign_xfer_number WHERE phone_number <> '' AND campaign_id = '#P:0#' ORDER BY \`index\`;
        `,
        q0827: `
        INSERT INTO frdcall_settings_containers (container_id,container_notes,container_type,user_group,container_entry) 
        VALUES( 'AMD_AGENT_OPT_#P:0#', 'AMD agent options for #P:0# campaign','AMD_AGENT_OPTIONS','---ALL---','HUMAN,HUMAN\\r\\nMACHINE,INITIALSILENCE\\r\\nNOTSURE,TOOLONG\\r\\nNOTSURE,NOAUDIODATA')
        ON DUPLICATE KEY UPDATE container_entry='HUMAN,HUMAN\\r\\nMACHINE,INITIALSILENCE\\r\\nNOTSURE,TOOLONG\\r\\nNOTSURE,NOAUDIODATA';
        `,
        q0828: `INSERT INTO frdcall_audios (name,customer_id,file_name) VALUES("#P:0#","#P:1#","#P:2#");`,
        q0829: `SELECT id, name, file_name, customer_id FROM frdcall_audios WHERE customer_id = '#P:0#';`,
        q0830: `DELETE FROM frdcall_audios WHERE id = '#P:0#' LIMIT 1`,
        q0831: `SELECT COUNT(*) as cnt FROM frdcall_audios WHERE file_name = '#P:0#';`,
        q0832: `select a.id, a.name, a.file_name, b.customer_name FROM frdcall_audios a LEFT JOIN frdcall_admins b ON a.customer_id = b.id  WHERE (SELECT user_level = 9 FROM frdcall_users WHERE user = '#P:0#');`,
        q0833: `INSERT INTO frdcall_music_on_hold (moh_id,moh_name,active,random,remove,user_group) VALUES("#P:0#","#P:1#","Y","N","N","#P:2#");`,
        q0834: `DELETE FROM frdcall_music_on_hold WHERE moh_id='#P:0#' LIMIT 1`,
        q0835: `INSERT INTO frdcall_music_on_hold_files (moh_id,filename,rankk) VALUES("#P:0#","#P:1#","1");`,
        q0836: `DELETE FROM frdcall_music_on_hold_files WHERE moh_id='#P:0#' LIMIT 1`,
        q0837: `
        SELECT a.id, a.customer_id
        FROM frdcall_admins a 
        LEFT JOIN frdcall_user_groups b 
        ON a.customer_id = b.user_group 
        WHERE is_delete = 0 
        AND b.admin_viewable_groups RLIKE CONCAT('\\\\b',(SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1), '\\\\b')
        LIMIT 1;
        `,
        q0838: `SELECT moh_id,moh_name FROM frdcall_music_on_hold WHERE user_group = '#P:0#';`,
        q0839: `select a.moh_id,a.moh_name, b.customer_name FROM frdcall_music_on_hold a LEFT JOIN frdcall_admins b ON substring_index(a.moh_id, '_', 1) = b.id WHERE (SELECT user_level = 9 FROM frdcall_users WHERE user = '#P:0#');`,
        q0840: `SELECT server_ip,conf_exten,extension,channel,campaign_id,callerid FROM frdcall_live_agents WHERE user = '#P:0#';`,
        q0841: `INSERT INTO frdcall_manager (\`man_id\`,\`uniqueid\`,\`entry_date\`,\`status\`,\`response\`,\`server_ip\`,\`channel\`,\`action\`,\`callerid\`,
                                            \`cmd_line_b\`,\`cmd_line_c\`,\`cmd_line_d\`,\`cmd_line_e\`,\`cmd_line_f\`,\`cmd_line_g\`,\`cmd_line_h\`,\`cmd_line_i\`,\`cmd_line_j\`,\`cmd_line_k\`)
                values('','',NOW(),'NEW','N','#P:0#','','Originate','',
                'Channel: Local/#P:1#',
                'Context: default',
                'Exten: 8390',
                'Priority: 1',
                'CallerID: #P:2#',
                'Variable: CONFNO=#P:3#','','','','');`,
        q0842: `SELECT channel, server_ip FROM live_sip_channels WHERE extension = '#P:0#' AND channel LIKE 'Local%';`,
        q0843: `INSERT INTO frdcall_manager (\`man_id\`,\`uniqueid\`,\`entry_date\`,\`status\`,\`response\`,\`server_ip\`,\`channel\`,\`action\`,\`callerid\`,
                                            \`cmd_line_b\`,\`cmd_line_c\`,\`cmd_line_d\`,\`cmd_line_e\`,\`cmd_line_f\`,\`cmd_line_g\`,\`cmd_line_h\`,\`cmd_line_i\`,\`cmd_line_j\`,\`cmd_line_k\`)
                values('','',NOW(),'NEW','N','#P:0#','','Redirect','',
                'Channel: #P:1#',
                'Context: bridge_to_channel',
                'Exten: #P:2#',
                'Priority: 1','','','','','','');`,
        q0844: `INSERT INTO frdcall_manager (\`man_id\`,\`uniqueid\`,\`entry_date\`,\`status\`,\`response\`,\`server_ip\`,\`channel\`,\`action\`,\`callerid\`,
                                            \`cmd_line_b\`,\`cmd_line_c\`,\`cmd_line_d\`,\`cmd_line_e\`,\`cmd_line_f\`,\`cmd_line_g\`,\`cmd_line_h\`,\`cmd_line_i\`,\`cmd_line_j\`,\`cmd_line_k\`)
                values('','',NOW(),'NEW','N','#P:0#','','Hangup','','Channel: #P:1#','','','','','','','','','');`,
        q0845: `DELETE FROM frdcall_auto_calls WHERE channel = '#P:0#' OR (campaign_id = '#P:1#' AND uniqueid IS NULL) AND true`,
        q0846: `SELECT * FROM frdcall_campaigns WHERE campaign_id="#P:0#"`,
        q0847: `SELECT * FROM live_channels WHERE channel_group="#P:0#" AND channel LIKE 'SIP%'`,
        q0848: `UNUSED`,
        // `INSERT INTO frdcall_manager (\`man_id\`,\`uniqueid\`,\`entry_date\`,\`status\`,\`response\`,\`server_ip\`,\`channel\`,\`action\`,\`callerid\`,
        //         \`cmd_line_b\`,\`cmd_line_c\`,\`cmd_line_d\`,\`cmd_line_e\`,\`cmd_line_f\`,\`cmd_line_g\`,\`cmd_line_h\`,\`cmd_line_i\`,\`cmd_line_j\`,\`cmd_line_k\`)
        // values('','',NOW(),'NEW','N','#P:0#','','Originate','',
        // 'Channel: Local/#P:1#@meetme-kickchannel',
        // 'Context: meetme-kickchannel',
        // 'Exten: #P:1#',
        // 'Priority: 1',
        // 'CallerID: meetme-kickchannel',
        // 'Variable: KICK_CHANNEL=#P:2#','','','','');`,
        q0849: `
        SELECT group_id, group_name, full_name, live_status, 
            MAX(call_date) as last_date,
            MAX(CASE WHEN status IN ('LIVE') THEN live_queue_seconds ELSE 0 END) as max_queue,
            AVG(queue_seconds) as avg_queue, 
            AVG(talk_sec) as avg_talk, 
            COUNT(status IN ('QUEUE') OR NULL) as cnt,
            COUNT(status NOT IN ('IVR','LIVE','TIMEOT','GONE','DROP','AFTHRS','QUEUE') OR NULL) / COUNT(status IN ('QUEUE') OR NULL) as par_ans,
            COUNT(status='LIVE' OR NULL) as cnt_ivr,  
            COUNT(status='CLOSER' OR NULL) as cnt_call,  
            COUNT(status='TIMEOT' OR NULL) as cnt_timeout,  
            COUNT(status='GONE' OR NULL) as cnt_gone,  
            COUNT(status='AFTHRS' OR NULL) as cnt_aft, 
            COUNT(status IN ('DROP') OR NULL) as cnt_drop,  
            COUNT(ivr_status = 'OVER' OR NULL) as cnt_over,  
            COUNT(status NOT IN ('IVR','LIVE','TIMEOT','GONE','DROP','AFTHRS','QUEUE') OR NULL) as cnt_ans
        FROM (
        SELECT ingrp.group_id, ingrp.group_name, closer.call_date,
            us.user, us.full_name, closer.length_in_sec, closer.queue_seconds, 
            rec.length_in_sec talk_sec,
            COALESCE(auto.status, closer.status) as status, live.status as live_status, closer.ivr_status,
            TIMESTAMPDIFF(SECOND,auto.call_time,NOW())as live_queue_seconds
        FROM frdcall_inbound_groups ingrp
        LEFT JOIN (
                SELECT user, GROUP_CONCAT(DISTINCT ingroup SEPARATOR " ") as ingroup
                FROM (
                    SELECT user, campaign_id as ingroup FROM frdcall_closer_log WHERE call_date > CONCAT( CASE WHEN HOUR(NOW()) < 6 THEN DATE_SUB(CURRENT_DATE, INTERVAL 1 DAY) ELSE CURRENT_DATE END,' 06:00:00') 
                    UNION
                    SELECT user, closer_campaigns as ingroup FROM frdcall_users
                )a
                GROUP BY user
            )users
            ON users.ingroup RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
        LEFT JOIN(
                SELECT list_id, campaign_id, call_date, user, queue_seconds, length_in_sec, status, uniqueid, ivr_status
                FROM frdcall_closer_log cl
                WHERE call_date > CONCAT( CASE WHEN HOUR(NOW()) < 6 THEN DATE_SUB(CURRENT_DATE, INTERVAL 1 DAY) ELSE CURRENT_DATE END,' 06:00:00') 
                ) closer
            ON closer.campaign_id = ingrp.group_id
            AND users.user = closer.user
        LEFT JOIN (SELECT user,closer_campaigns FROM frdcall_users) ingrp_us
            ON ingrp_us.closer_campaigns RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
            AND users.user = ingrp_us.user
        LEFT JOIN (SELECT user,full_name FROM frdcall_users) us
            ON closer.user = us.user
            OR users.user = us.user
        LEFT JOIN (SELECT uniqueid,status,call_time FROM frdcall_auto_calls) auto
            ON closer.uniqueid = auto.uniqueid
        LEFT JOIN frdcall_live_agents live
            ON live.closer_campaigns RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
            AND live.user = ingrp_us.user
        LEFT JOIN (SELECT uniqueid,SUM(length_in_sec)length_in_sec FROM recording_log WHERE start_time > CONCAT( CASE WHEN HOUR(NOW()) < 6 THEN DATE_SUB(CURRENT_DATE, INTERVAL 1 DAY) ELSE CURRENT_DATE END,' 06:00:00') GROUP BY uniqueid ) rec
            ON closer.uniqueid = rec.uniqueid
        )acd
        GROUP BY group_id, group_name, full_name
        `,
        q0850: `
        SELECT group_id, group_name, full_name, live_status, 
            MAX(call_date) as last_date,
            MAX(CASE WHEN status IN ('LIVE') THEN live_queue_seconds ELSE 0 END) as max_queue,
            AVG(queue_seconds) as avg_queue, 
            AVG(talk_sec) as avg_talk, 
            COUNT(status) as cnt,
            COUNT(status NOT IN ('IVR','LIVE','TIMEOT','GONE','DROP','AFTHRS','QUEUE') OR NULL) / COUNT(status) as par_ans,
            COUNT(status='LIVE' OR NULL) as cnt_ivr,  
            COUNT(status='CLOSER' OR NULL) as cnt_call,  
            COUNT(status='TIMEOT' OR NULL) as cnt_timeout,  
            COUNT(status='GONE' OR NULL) as cnt_gone,  
            COUNT(status='AFTHRS' OR NULL) as cnt_aft, 
            COUNT(status IN ('DROP', 'QUEUE') OR NULL) as cnt_drop,  
            COUNT(ivr_status = 'OVER' OR NULL) as cnt_over,  
            COUNT(status NOT IN ('IVR','LIVE','TIMEOT','GONE','DROP','AFTHRS','QUEUE') OR NULL) as cnt_ans
        FROM (
        SELECT ingrp.group_id, ingrp.group_name, closer.call_date,
            us.user, us.full_name, closer.length_in_sec, closer.queue_seconds, 
            rec.length_in_sec talk_sec,
            COALESCE(auto.status, closer.status) as status, live.status as live_status, closer.ivr_status,
            TIMESTAMPDIFF(SECOND,auto.call_time,NOW())as live_queue_seconds
        FROM frdcall_inbound_groups ingrp
        LEFT JOIN (
                SELECT user, GROUP_CONCAT(DISTINCT ingroup SEPARATOR " ") as ingroup
                FROM (
                    SELECT DISTINCT user, campaign_id as ingroup FROM frdcall_closer_log WHERE call_date > '#P:0#' AND campaign_id IS NOT NULL
                    UNION ALL
                    SELECT DISTINCT user, closer_campaigns as ingroup FROM frdcall_users WHERE closer_campaigns IS NOT NULL
                )a
                GROUP BY user
            )users
            ON users.ingroup RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
        LEFT JOIN(
                SELECT list_id, campaign_id, call_date, user, queue_seconds, length_in_sec, status, uniqueid, ivr_status
                FROM frdcall_closer_log cl USE INDEX(call_date)
                WHERE call_date > '#P:0#'
                AND campaign_id IS NOT NULL
            ) closer
            ON closer.campaign_id = ingrp.group_id
            AND users.user = closer.user
        LEFT JOIN (SELECT user,closer_campaigns FROM frdcall_users) ingrp_us
            ON ingrp_us.closer_campaigns RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
            AND users.user = ingrp_us.user
        LEFT JOIN (SELECT user,full_name FROM frdcall_users) us
            ON closer.user = us.user
            OR users.user = us.user
        LEFT JOIN (SELECT uniqueid,status,call_time FROM frdcall_auto_calls) auto
            ON closer.uniqueid = auto.uniqueid
        LEFT JOIN frdcall_live_agents_copy live
            ON live.closer_campaigns RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
            AND live.user = ingrp_us.user
        LEFT JOIN (SELECT uniqueid,SUM(length_in_sec)length_in_sec FROM recording_log WHERE  start_time > '#P:0#' GROUP BY uniqueid ) rec
            ON closer.uniqueid = rec.uniqueid
        )acd
        GROUP BY group_id, group_name, full_name
            `,
        q0851: `
            SELECT group_id, group_name
            FROM frdcall_inbound_groups
            WHERE (SELECT GROUP_CONCAT(DISTINCT closer_campaigns SEPARATOR ' ') FROM frdcall_campaigns WHERE campaign_id IN ('#P:0#')) RLIKE CONCAT('\\\\b', group_id, '\\\\b')
            AND group_id <> 'OPERATORQUE'
        `,
        q0852: `
        SELECT 	cl.uniqueid, 
                robo.cmid, 
                robo.list_id, 
                robo.lead_id, 
                cl.start_time, 
                cl.end_time, 
                cl.length_in_sec, 
                robo.n + 1 process_no, 
                robo.q tts_text,
                robo.a selector 
        FROM call_log cl
        INNER JOIN (
            SELECT a.list_id ,a.lead_id ,jt.uniqueid ,jt.cmid ,jt.data ,jt_d.n ,jt_d.q ,jt_d.a
            FROM frdcall_list_extend a,
                JSON_TABLE(
                        a.research_results, 
                        '$[*]' columns (uniqueid VARCHAR(45) path '$.uniqueid',cmid VARCHAR(45) path '$.cmid',data JSON path '$.data')
                    ) as jt,
                JSON_TABLE(
                        jt.data, 
                        '$[*]' columns (a VARCHAR(45) path '$.a',n VARCHAR(45) path '$.n',q VARCHAR(1023) path '$.q')
                    ) as jt_d
            WHERE a.research_results IS NOT NULL
            AND a.list_id IN ('#P:2#')
            AND jt.uniqueid >= '#P:0#' AND jt.uniqueid <= '#P:1#'
        )robo ON SUBSTRING(cl.uniqueid , 1, CHAR_LENGTH(cl.uniqueid )-1) = SUBSTRING(robo.uniqueid , 1, CHAR_LENGTH(robo.uniqueid )-1)
        WHERE cl.channel_group <> 'DID_INBOUND' AND cl.type <> 'SIP'
        AND cl.uniqueid >= '#P:0#' AND cl.uniqueid <= '#P:1#'
        AND cl.caller_code LIKE CONCAT( '%' ,  robo.lead_id)
        `,
        // todo: unused リダイレクトでのstopMixMonitorはWARNINGが出るので使わない。
        q0853: `
        INSERT INTO frdcall_manager 
            values('','',NOW(),'NEW','N','#P:0#','',
            'Redirect',
            'stopMixMonitor',
            'Exten:#P:1#',
            'Context:hup_hdlr_8311',
            'Channel:#P:2#',
            'Priority:1',
            'Callerid:#P:3#','','','','','');
        `,
        q0854: `SELECT user, server_ip, conf_exten, extension, channel, last_update_time FROM frdcall_live_agents WHERE extension LIKE 'SIP%'`,
        q0855: `
            SELECT la.user,la.server_ip,la.conf_exten
            FROM frdcall_live_agents la
            LEFT JOIN frdcall_auto_calls ac
            USING(callerid)
            WHERE la.status = 'INCALL' AND ac.callerid IS NULL
        `,
        q0856: `SELECT * FROM live_channels WHERE extension = '#P:0#' OR extension = '#P:1#'`,
        q0857: `SELECT status, last_local_call_time, owner FROM frdcall_list WHERE lead_id = '#P:0#'`,
        q0858: `
        INSERT INTO frdcall_manager 
            values('','',NOW(),'NEW','N',
            '#P:0#','',
            'StopMixMonitor','','','',
            'Channel:#P:1#','','','','','','','');
        `,
        q0859: `
        SELECT la.extension, la.user, la.conf_exten, la.status, la.server_ip, last_call_time,
            la.last_call_finish, la.call_server_ip, la.campaign_id, us.user_group, us.full_name,
            la.comments ,la.calls_today, la.callerid, la.lead_id, la.last_state_change,
            la.on_hook_agent, la.ring_callerid, la.agent_log_id, la.closer_campaigns,
            ways_count ,pc.parked_time, ac.auto_call_id as auto_call_id, ac.uniqueid as auto_call_uniqueid, ac.channel as auto_call_channle
        FROM frdcall_live_agents la
        LEFT JOIN (SELECT lead_id, COUNT(*) as ways_count FROM frdcall_live_agents WHERE status = 'INCALL' GROUP BY lead_id) la2 USING(lead_id)
        LEFT JOIN frdcall_users us USING(user) 
        LEFT JOIN parked_channels pc ON pc.channel_group = la.callerid
        LEFT JOIN frdcall_auto_calls ac ON ac.callerid = la.callerid
        where us.user_hide_realtime='0';
        `,
        q0860: `
        SELECT status, campaign_id, phone_number, server_ip, call_time, call_type,queue_priority, agent_only
        FROM frdcall_auto_calls 
        WHERE status NOT IN('XFER')
        `,
        q0861: `UPDATE recording_log SET frdcall_id = CONCAT('x', frdcall_id), uniqueid = CONCAT('x', uniqueid) WHERE lead_id = '#P:0#' AND true`,
        q0862: `UPDATE recording_log a INNER JOIN frdcall_list b ON a.lead_id = b.lead_id SET frdcall_id = CONCAT('x', frdcall_id), uniqueid = CONCAT('x', uniqueid) WHERE b.list_id = '#P:0#' AND true`,
        q0863: `SELECT server_ip FROM phones WHERE user_group = '#P:0#' AND server_ip <> '${_configs.defaultCTIIP}' AND active = 'Y' LIMIT 1;`,
        q0864: `
            SELECT server_ip, COUNT(extension)
            FROM servers
            LEFT JOIN (SELECT server_ip, extension FROM phones INNER JOIN (SELECT phone_login as extension FROM frdcall_users WHERE user_level <= 6) us USING(extension)) phones
            USING(server_ip) 
            WHERE server_ip <> '${_configs.defaultCTIIP}'
            AND active = 'Y'
            GROUP BY server_ip
            ORDER BY COUNT(extension) ASC
        `,
        q0865: `
            SELECT frdcall_forms.*
            FROM frdcall_forms 
            INNER JOIN(
                SELECT admin_viewable_groups as viewable, user_level
                FROM (
                    SELECT user_group, user_level
                    FROM frdcall_users
                    WHERE user='#P:0#'
                    ) AS frdcall_users
                LEFT JOIN frdcall_user_groups
                USING(user_group)
                ) AS view_groups
            ON view_groups.user_level = 9
            OR view_groups.viewable RLIKE CONCAT('\\\\b', frdcall_forms.user_group, '\\\\b')
            WHERE is_delete = 0
        `,
        q0866: `UPDATE frdcall_forms SET update_datetime = NOW(), is_delete = 1 WHERE id = '#P:0#' LIMIT 1`,
        q0867: `
            INSERT INTO frdcall_forms ( name, form_data, form_json, user_group, extra_config, create_datetime) 
            SELECT  '#P:1#', form_data, form_json, '#P:2#', extra_config, now() FROM frdcall_forms WHERE id = '#P:0#'
        `,
        q0868: `
            INSERT INTO frdcall_forms (name, form_json, user_group, extra_config, create_datetime)
            VALUES( '#P:0#', '[]', '#P:1#', '[]', now() )
        `,
        q0869: `
            UPDATE frdcall_forms 
            SET detail = '#P:1#', 
                form_data='#P:2#', 
                form_json='#P:3#', 
                user_group='#P:4#', 
                extra_config='#P:5#', 
                last_update_user='#P:6#', 
                update_datetime=NOW() 
            WHERE id = '#P:0#' LIMIT 1
        `,
        q0870: `
            SELECT id as "formid", id as "formbuilderid", name, form_data as "cf_940", "" AS "promiseName"
            FROM frdcall_forms
            WHERE JSON_VALID(extra_config) = 1
            AND LOWER(extra_config->>"$[*].campid") RLIKE LOWER('"#P:0#"')
            AND extra_config ->> "$[*].dispoid[*]" RLIKE '"#P:1#"|"<ALL>"'
            AND is_delete = 0
        `,
        q0871: `UPDATE recording_log rl SET dispo_form = '#P:1#' WHERE recording_id = '#P:0#' LIMIT 1`,
        q0872: `
            SELECT
                a.id as formbuilderid,
                a.name,
                a.extra_config->>"$[*].campid" AS campids,
                a.extra_config->>"$[*].dispoid" AS dispoids,
                j.*
            FROM
                frdcall_forms a
                JOIN JSON_TABLE(
                    urldecode(a.form_data),
                    "$[*]" COLUMNS(
                        access BOOLEAN PATH "$.access", classname TEXT PATH "$.className", description_ TEXT PATH "$.description",
                        inline BOOLEAN PATH "$.inline", label TEXT PATH "$.label", max INT PATH "$.max",
                        maxlength INT PATH "$.maxlength", min INT PATH "$.min", multiple BOOLEAN PATH "$.multiple",
                        name_ TEXT PATH "$.name", other BOOLEAN PATH "$.other", placeholder TEXT PATH "$.placeholder",
                        required BOOLEAN PATH "$.required", step INT PATH "$.step", style TEXT PATH "$.style",
                        subtype TEXT PATH "$.subtype", toggle BOOLEAN PATH "$.toggle", type_ TEXT PATH "$.type",
                        values_ JSON PATH "$.values"
                    )
                ) AS j
            WHERE
                JSON_VALID(urldecode(a.form_data)) = 1 
                AND JSON_VALID(a.extra_config) = 1 
                AND (LOWER(a.extra_config->>"$[*].campid") RLIKE '"#P:0#"' OR a.extra_config->>"$[*].campid" RLIKE '"<ALL>"')
                AND j.type_ NOT IN ("button", "header", "paragraph")
                AND a.is_delete = 0;
        `,
        q0873: `
            WITH camp_form AS (
                SELECT lead_id, re.start_time, re.dispo_form
                FROM (SELECT list_id FROM frdcall_lists WHERE lower(campaign_id) = lower('#P:0#')) ls
                INNER JOIN frdcall_list li USING(list_id)
                INNER JOIN recording_log re USING(lead_id)
            )
            SELECT lead_id, cf.dispo_form->>"$[0]" AS form  
            FROM camp_form cf
            INNER JOIN (SELECT lead_id, MAX(start_time) start_time FROM camp_form GROUP BY lead_id) b
            USING(lead_id, start_time)
            where JSON_VALID(dispo_form)=1 
            and JSON_KEYS(cf.dispo_form->>"$[0]") is not null
            and JSON_KEYS(cf.dispo_form->>"$[0]") rlike '(#P:1#)' #P:2#;
        `,
        q0874: `
            WITH camp_form AS (
                SELECT lead_id, re.start_time, re.dispo_form
                FROM (
                    SELECT list_id 
                    FROM frdcall_lists 
                    WHERE campaign_id IN (#P:0#)
                    AND list_id IN (#P:1#)
                ) ls
                INNER JOIN frdcall_list li USING(list_id)
                INNER JOIN recording_log re USING(lead_id)
                WHERE start_time BETWEEN "#P:2# 00:00:00" AND "#P:3# 23:59:59"
            )
            SELECT start_time, lead_id AS leadid, cf.dispo_form->>"$[0]" AS formData
            FROM camp_form cf
            INNER JOIN (SELECT lead_id, MAX(start_time) start_time FROM camp_form GROUP BY lead_id) b
            USING(lead_id, start_time)
        `,
        q0875: `
            SELECT id AS value, name AS label, form_data AS data 
            FROM frdcall_forms
            WHERE JSON_VALID(extra_config) = 1
            AND LOWER(extra_config->>"$[*].campid") RLIKE LOWER('#P:0#')
            AND extra_config ->> "$[*].dispoid[*]" RLIKE '#P:1#|<ALL>'
            AND is_delete = 0;
        `,
        q0876: `
        SELECT feature_name, \`create\`, \`read\`, \`update\`, \`delete\`
        FROM frdcall_user_extend_features 
        WHERE feature_name = '#P:0#' AND user = '#P:1#' AND is_delete = 0;
        `,
        q0878: `SELECT \`create\`, \`read\`, \`update\`, \`delete\` FROM frdcall_admin_features WHERE feature_name = '#P:0#' AND customer_id = (SELECT a.id FROM frdcall_admins a LEFT JOIN frdcall_user_groups b ON a.customer_id = b.user_group WHERE is_delete = 0 AND LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user = "#P:1#" LIMIT 1),' '), b.admin_viewable_groups) > 0 LIMIT 1);`,
        //865
        q0879: `
            SELECT frdcall_webforms.*
            FROM frdcall_webforms 
            INNER JOIN(
                SELECT admin_viewable_groups as viewable, user_level
                FROM (
                    SELECT user_group, user_level
                    FROM frdcall_users
                    WHERE user='#P:0#'
                    ) AS frdcall_users
                LEFT JOIN frdcall_user_groups
                USING(user_group)
                ) AS view_groups
            ON view_groups.user_level = 9
            OR view_groups.viewable RLIKE CONCAT('\\\\b', frdcall_webforms.user_group, '\\\\b')
            WHERE is_delete = 0
        `,
        q0880: `UPDATE frdcall_webforms SET update_datetime = NOW(), is_delete = 1 WHERE id = '#P:0#' LIMIT 1`,
        q0881: `
            INSERT INTO frdcall_webforms ( name, form_html, form_json, user_group, customer_url, set_list_id, call_menu_id, create_datetime) 
            SELECT  '#P:1#', form_html, form_json, '#P:2#', customer_url, set_list_id, call_menu_id, now() FROM frdcall_webforms WHERE id = '#P:0#'
        `,
        q0882: `
            INSERT INTO frdcall_webforms (name, form_json, user_group, extra_config, create_datetime) 
            VALUES( '#P:0#', '[]', '#P:1#', '{}', now() )
        `,
        q0883: `
        UPDATE frdcall_webforms 
        SET detail = '#P:1#', 
            form_html='#P:2#', 
            form_json='#P:3#', 
            user_group='#P:4#', 
            extra_config='#P:5#', 
            customer_url='#P:6#', 
            set_list_id='#P:7#', 
            call_menu_id='#P:8#', 
            last_update_user='#P:9#', 
            update_datetime=NOW() 
        WHERE id = '#P:0#' LIMIT 1
        `,
        q0884: `SELECT menu_id as id, menu_name as name FROM frdcall_call_menu WHERE user_group = '#P:0#';`,
        q0885: `INSERT INTO frdcall_list (#P:0#) VALUES(#P:1#);`,
        q0886: `SELECT * FROM recording_log WHERE lead_id = '#P:0#' ORDER BY start_time DESC LIMIT 1;`,

        q0900: `select sms_data->>"$.a" as "a",sms_data->>"$.msg" as "msg" from frdcall_list_extend where lead_id='#P:0#' and list_id='#P:1#' and JSON_VALID(sms_data);`,
        q0901: `select smsId as ID, template_name as テンプレートタイトル,user_group as ユーザーグループ from frd_sms_template INNER JOIN (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = (SELECT user_group FROM frdcall_users WHERE user =  "#P:0#"))a 
            ON admin_viewable_groups LIKE '%-ALL-%' 
            OR LOCATE(CONCAT(' ', user_group, ' '), admin_viewable_groups) > 0`,
        q0902: `UPDATE frd_sms_template SET template_name = '#P:1#', message = '#P:2#' WHERE smsId = '#P:0#' LIMIT 1;`,
        q0903: `SELECT * FROM frd_sms_template WHERE smsId = '#P:0#';`,
        q0904: `DELETE FROM frd_sms_template WHERE smsId = '#P:0#';`,

        q0905: `SELECT * FROM sms_url_list WHERE smsId = '#P:0#';`,
        q0906: `SELECT * FROM frdcall_list WHERE user = '#P:0#' LIMIT 1;`,

        q0907: `SELECT
                DISTINCT c.account_entry
            FROM
                frdcall_server_carriers c
                JOIN frdcall_user_groups g ON c.user_group = g.user_group
            WHERE
                g.admin_viewable_groups RLIKE concat(
                    '\\\\b',
                    (
                        SELECT
                            u.user_group
                        FROM
                            frdcall_users u
                        WHERE
                            u.user LIKE "#P:0#"
                    ),
                    '\\\\b'
                )
                AND c.sms = 'yes'`,

        q0908: `SELECT 1 FROM frd_sms_template LIMIT 1`,
        q0909: `CREATE TABLE frd_sms_template (smsId INT AUTO_INCREMENT PRIMARY KEY, template_name VARCHAR(255), message TEXT)`,
        q0910: `SELECT * FROM frd_sms_template WHERE template_name = '#P:0#'`,
        q0911: `SELECT user_group FROM frdcall_users WHERE user = '#P:0#'`,
        q0912: `INSERT INTO frd_sms_template (template_name,message,user_group) VALUES ('#P:0#','#P:1#','#P:2#')`,
        q0913: `DELETE FROM frd_sms_template WHERE smsId = '#P:0#' LIMIT 1`,
        q0915: `INSERT INTO frd_sms_list (smsId, sender, list_id, receivers) VALUES ('#P:0#','#P:1#','#P:2#','#P:3#')`,
        q0916: `INSERT INTO sms_url_list (smsId, url, subject, body) VALUES ('#P:0#','#P:1#','#P:2#','#P:3#')`,
        q0917: `SELECT sender FROM frd_sms_list WHERE smsId = '#P:0#'`,
        q0918: `UPDATE sms_url_list SET replied_users = '#P:0#' WHERE smsId = '#P:1#' LIMIT 1`,
        q0919: `SELECT * FROM sms_url_list WHERE smsId = '#P:0#'`,
        q0920: `SELECT sms_url_list.smsId as agent_log_id,sms_url_list.subject,frd_sms_list.list_id,frd_sms_list.sender,sms_url_list.body as remark, sms_url_list.created_at FROM sms_url_list JOIN frd_sms_list ON sms_url_list.smsId = frd_sms_list.smsId WHERE frd_sms_list.receivers RLIKE '\\\\b#P:0#\\\\b'`,
        q0921: `SELECT lead_id FROM frdcall_users WHERE user = '#P:0#'`,
        q0922: `UPDATE frdcall_users SET sf_user = '#P:0#', sf_pass = '#P:1#', sf_securitytoken = '#P:2#',sk_channel = '#P:3#', sk_usertoken = '#P:4#', sk_bottoken = '#P:5#',sf_serverUrl = '#P:6#' WHERE user = '#P:7#' LIMIT 1`,
        q0923: `SELECT lead_id FROM frdcall_list WHERE list_id = '#P:0#'`,
        q0924: `SELECT u.user, c.sms FROM frdcall_users u INNER JOIN frdcall_server_carriers c ON u.user_group = c.user_group WHERE u.user = '#P:0#'`,
        q0925: `
            SELECT
                COALESCE(t2.last_name, "") AS last_name,
                COALESCE(t2.first_name, "") AS first_name,
                COALESCE(t2.title, "") AS title,
                COALESCE(t2.phone_number, "") AS phone_number
            FROM frdcall_live_agents t1
            INNER JOIN frdcall_list t2
                ON t1.lead_id = t2.lead_id
            WHERE t1.user = '#P:0#' AND t1.status = 'INCALL'
        `,
        q0926: `SELECT menu_id as value,menu_name as label FROM frdcall_call_menu #P:0#`,
        q0927: `SELECT research_results FROM frdcall_list_extend WHERE research_results IS NOT NULL`,
        q0928: `SELECT t1.uniqueid,t1.call_date,t1.length_in_sec,t1.status,t1.user_group,t2.last_name,t2.postal_code,t2.state,t2.city,t2.address1,t2.address2,t2.memo,t2.phone_number,t2.email,t3.status FROM frdcall_log t1 LEFT JOIN frdcall_list t2 ON t1.lead_id = t2.lead_id AND t1.list_id = t2.list_id LEFT JOIN frdcall_closer_log t3 ON t1.uniqueid = t3.uniqueid WHERE t1.uniqueid = #P:0# AND t1.status = '#P:1#' AND (t1.call_date BETWEEN '#P:2#' AND '#P:3#')`,
        q0929: `SELECT menu_name FROM frdcall_call_menu WHERE menu_id = '#P:0#'`,
        q0930: `SELECT Date(t1.call_date) as date, WEEKDAY(t1.call_date) as day,COUNT(*) as count,SUM(t1.length_in_sec) as length_in_sec,COUNT(CASE WHEN t2.status = 'AFTHER' THEN 1 END) as afther,COUNT(CASE WHEN t2.status = 'QUEUE' THEN 1 END) as queue,COUNT(CASE WHEN t2.status = 'GONE' THEN 1 END) as gone,COUNT(CASE WHEN t2.status NOT IN ('AFTHER', 'QUEUE','GONE') THEN 1 END) as withdraw,JSON_ARRAYAGG(robo.data) as data
                FROM frdcall_log t1 
                LEFT JOIN (
                    SELECT a.list_id ,a.lead_id,a.extend_col,jt.uniqueid ,jt.cmid ,jt.data
                    FROM frdcall_list_extend a,
                        JSON_TABLE(
                                a.research_results, 
                                '$[*]' columns (uniqueid VARCHAR(45) path '$.uniqueid',cmid VARCHAR(45) path '$.cmid',data JSON path '$.data')
                            ) as jt
                    WHERE a.research_results IS NOT NULL
                    AND JSON_VALID(a.research_results) = 1
                    AND a.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                    AND jt.uniqueid >= '#P:1#' AND jt.uniqueid <= '#P:2#'
                )robo ON SUBSTRING(t1.uniqueid , 1, CHAR_LENGTH(t1.uniqueid )-2) = SUBSTRING(robo.uniqueid , 1, CHAR_LENGTH(robo.uniqueid )-2)
                LEFT JOIN (
                    SELECT *
                    FROM frdcall_closer_log
                    WHERE uniqueid >= '#P:1#' AND uniqueid <= '#P:2#'
                    AND list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                ) t2 ON SUBSTRING(t1.uniqueid , 1, CHAR_LENGTH(t1.uniqueid )-2) = SUBSTRING(t2.uniqueid , 1, CHAR_LENGTH(t2.uniqueid )-2)
                WHERE (t1.uniqueid >= '#P:1#' AND t1.uniqueid <= '#P:2#') AND #P:3# AND robo.cmid IN (#P:4#)
                AND t1.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                GROUP BY DATE(call_date)
                ORDER BY date DESC
                `,
        q0931: `SELECT (CASE WHEN WEEKDAY(t1.call_date) IN (5,6) THEN 'Weekend' ELSE 'Weekday' END) AS day_category,COUNT(*) as count,SUM(t1.length_in_sec) as length_in_sec,COUNT(CASE WHEN t2.status = 'AFTHER' THEN 1 END) as afther,COUNT(CASE WHEN t2.status = 'QUEUE' THEN 1 END) as queue,COUNT(CASE WHEN t2.status = 'GONE' THEN 1 END) as gone,COUNT(CASE WHEN t2.status NOT IN ('AFTHER', 'QUEUE','GONE') THEN 1 END) as withdraw,JSON_ARRAYAGG(robo.data) as data
                FROM frdcall_log t1 
                LEFT JOIN (
                    SELECT a.list_id ,a.lead_id,a.extend_col,jt.uniqueid ,jt.cmid ,jt.data
                    FROM frdcall_list_extend a,
                        JSON_TABLE(
                                a.research_results, 
                                '$[*]' columns (uniqueid VARCHAR(45) path '$.uniqueid',cmid VARCHAR(45) path '$.cmid',data JSON path '$.data')
                            ) as jt
                    WHERE a.research_results IS NOT NULL
                    AND JSON_VALID(a.research_results) = 1
                    AND a.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                    AND jt.uniqueid >= '#P:1#' AND jt.uniqueid <= '#P:2#'
                )robo ON SUBSTRING(t1.uniqueid , 1, CHAR_LENGTH(t1.uniqueid )-2) = SUBSTRING(robo.uniqueid , 1, CHAR_LENGTH(robo.uniqueid )-2)
                LEFT JOIN (
                    SELECT *
                    FROM frdcall_closer_log
                    WHERE uniqueid >= '#P:1#' AND uniqueid <= '#P:2#'
                    AND list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                ) t2 ON SUBSTRING(t1.uniqueid , 1, CHAR_LENGTH(t1.uniqueid )-2) = SUBSTRING(t2.uniqueid , 1, CHAR_LENGTH(t2.uniqueid )-2)
                WHERE (t1.uniqueid >= '#P:1#' AND t1.uniqueid <= '#P:2#')
                AND #P:3#
                AND robo.cmid IN (#P:4#)
                AND t1.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                GROUP BY (CASE WHEN WEEKDAY(t1.call_date) IN (5,6) THEN 'Weekend' ELSE 'Weekday' END)`,
        q0932: `SELECT cl.uniqueid,cl.user_group,robo.cmid as menu_name,robo.extend_col,lg.start_time,lg.end_time,lg.length_in_sec,(CASE WHEN fcl.uniqueid IS NULL THEN 'QUEUE' ELSE fcl.status END) as status,lt.last_name,lt.postal_code,lt.state,lt.city,lt.address1,lt.address2,lt.memo,lt.phone_number,lt.email,robo.data
                FROM frdcall_log cl
                LEFT JOIN (
                    SELECT a.list_id ,a.lead_id,a.extend_col,jt.uniqueid ,jt.cmid ,jt.data 
                    FROM frdcall_list_extend a,
                        JSON_TABLE(
                                a.research_results, 
                                '$[*]' columns (uniqueid VARCHAR(45) path '$.uniqueid',cmid VARCHAR(45) path '$.cmid',data JSON path '$.data')
                            ) as jt
                    WHERE a.research_results IS NOT NULL
                    AND JSON_VALID(a.research_results) = 1
                    AND a.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                    AND jt.uniqueid >= '#P:0#' AND jt.uniqueid <= '#P:1#'
                )robo ON SUBSTRING(cl.uniqueid , 1, CHAR_LENGTH(cl.uniqueid )-2) = SUBSTRING(robo.uniqueid , 1, CHAR_LENGTH(robo.uniqueid )-2)
                LEFT JOIN (
                    SELECT *
                    FROM frdcall_closer_log
                    WHERE uniqueid >= '#P:0#' AND uniqueid <= '#P:1#'
                    AND list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                ) fcl ON SUBSTRING(cl.uniqueid , 1, CHAR_LENGTH(cl.uniqueid )-2) = SUBSTRING(fcl.uniqueid , 1, CHAR_LENGTH(fcl.uniqueid )-2)
                LEFT JOIN call_log lg ON cl.uniqueid = lg.uniqueid
                LEFT JOIN frdcall_list lt ON cl.lead_id = lt.lead_id
                WHERE #P:2#
                AND (cl.uniqueid >= '#P:0#' AND cl.uniqueid <= '#P:1#')  AND robo.cmid IN (#P:3#)
                AND cl.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
                ORDER BY cl.uniqueid DESC
                `,
        q0933: `SELECT robo.cmid as menu_name, WEEKDAY(t1.call_date) as day,COUNT(*) as count,SUM(t1.length_in_sec) as length_in_sec,COUNT(CASE WHEN t2.status = 'AFTHER' THEN 1 END) as afther,COUNT(CASE WHEN t2.status = 'QUEUE' THEN 1 END) as queue,COUNT(CASE WHEN t2.status = 'GONE' THEN 1 END) as gone,COUNT(CASE WHEN t2.status NOT IN ('AFTHER', 'QUEUE','GONE') THEN 1 END) as withdraw,JSON_ARRAYAGG(robo.data) as data
        FROM frdcall_log t1 
        LEFT JOIN (
            SELECT a.list_id ,a.lead_id,a.extend_col,jt.uniqueid ,jt.cmid ,jt.data
            FROM frdcall_list_extend a,
                JSON_TABLE(
                        a.research_results, 
                        '$[*]' columns (uniqueid VARCHAR(45) path '$.uniqueid',cmid VARCHAR(45) path '$.cmid',data JSON path '$.data')
                    ) as jt
            WHERE a.research_results IS NOT NULL
            AND JSON_VALID(a.research_results) = 1
            AND a.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
            AND jt.uniqueid >= '#P:1#' AND jt.uniqueid <= '#P:2#'
        )robo ON SUBSTRING(t1.uniqueid , 1, CHAR_LENGTH(t1.uniqueid )-2) = SUBSTRING(robo.uniqueid , 1, CHAR_LENGTH(robo.uniqueid )-2)
        LEFT JOIN (
            SELECT *
            FROM frdcall_closer_log
            WHERE uniqueid >= '#P:1#' AND uniqueid <= '#P:2#'
            AND list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
        ) t2 ON SUBSTRING(t1.uniqueid , 1, CHAR_LENGTH(t1.uniqueid )-2) = SUBSTRING(t2.uniqueid , 1, CHAR_LENGTH(t2.uniqueid )-2)
        WHERE (t1.uniqueid >= '#P:1#' AND t1.uniqueid <= '#P:2#')
        AND #P:3#
        AND robo.cmid IN (#P:4#)
        AND t1.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
        GROUP BY robo.cmid`,
        q0934: `SELECT DATE_FORMAT(STR_TO_DATE(t1.call_date, '%Y-%m-%d %H:%i:%s'), '%Y-%m') AS month, WEEKDAY(t1.call_date) as day,COUNT(*) as count,SUM(t1.length_in_sec) as length_in_sec,COUNT(CASE WHEN t2.status = 'AFTHER' THEN 1 END) as afther,COUNT(CASE WHEN t2.status = 'QUEUE' THEN 1 END) as queue,COUNT(CASE WHEN t2.status = 'GONE' THEN 1 END) as gone,COUNT(CASE WHEN t2.status NOT IN ('AFTHER', 'QUEUE','GONE') THEN 1 END) as withdraw,JSON_ARRAYAGG(robo.data) as data
        FROM frdcall_log t1 
        LEFT JOIN (
            SELECT a.list_id ,a.lead_id,a.extend_col,jt.uniqueid ,jt.cmid ,jt.data
            FROM frdcall_list_extend a,
                JSON_TABLE(
                        a.research_results, 
                        '$[*]' columns (uniqueid VARCHAR(45) path '$.uniqueid',cmid VARCHAR(45) path '$.cmid',data JSON path '$.data')
                    ) as jt
            WHERE a.research_results IS NOT NULL
            AND JSON_VALID(a.research_results) = 1
            AND a.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
            AND jt.uniqueid >= '#P:1#' AND jt.uniqueid <= '#P:2#'
        )robo ON SUBSTRING(t1.uniqueid , 1, CHAR_LENGTH(t1.uniqueid )-2) = SUBSTRING(robo.uniqueid , 1, CHAR_LENGTH(robo.uniqueid )-2)
        LEFT JOIN (
            SELECT *
            FROM frdcall_closer_log
            WHERE uniqueid >= '#P:1#' AND uniqueid <= '#P:2#'
            AND list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
        ) t2 ON SUBSTRING(t1.uniqueid , 1, CHAR_LENGTH(t1.uniqueid )-2) = SUBSTRING(t2.uniqueid , 1, CHAR_LENGTH(t2.uniqueid )-2)
        WHERE (t1.uniqueid >= '#P:1#' AND t1.uniqueid <= '#P:2#') AND #P:3# AND robo.cmid IN (#P:4#) GROUP BY DATE_FORMAT(STR_TO_DATE(t1.call_date, '%Y-%m-%d %H:%i:%s'), '%Y-%m')
        AND t1.list_id IN (SELECT list_id FROM frdcall_lists li INNER JOIN (SELECT campaign_id FROM frdcall_campaigns WHERE user_group IN (#P:5#)) ca ON li.campaign_id = ca.campaign_id)
        ORDER BY month DESC
        `,
        q0935: `SELECT status,campaign_id,closer_campaigns FROM frdcall_live_agents where user='#P:0#'`,
        q0936: `SELECT lead_id,campaign_id,phone_number,uniqueid,UNIX_TIMESTAMP(call_time),call_type,auto_call_id FROM frdcall_auto_calls WHERE status IN('LIVE') and ( (campaign_id='#P:0#') or (campaign_id IN(#P:1#)) #P:2#) order by queue_priority,call_time`,
 
        q0950: `SELECT last_name,first_name,title,phone_number,status FROM frdcall_list WHERE lead_id = '#P:0#'`,
        q0951: `
            select
                j.leadId as "lead_id"
            from
                frd_sms_list l inner join sms_url_list t on l.smsId = t.smsId
                JOIN JSON_TABLE(
                    t.replied_users,
                    "$[*]" COLUMNS(
                        urlId INT PATH "$.urlId",
                        ts DATETIME PATH "$.timeStamp",
                        leadId INT PATH "$.leadId"
                    )
                ) AS j
            where
                l.list_id = "#P:2#"
                and JSON_VALID(t.replied_users)
                and j.ts >= "#P:0#" and j.ts <= "#P:1# 23:59:59";`,
        q0952: `
            select
                t.lead_id
            from
                frdcall_list_extend t
                JOIN JSON_TABLE(
                    t.sms_data,
                    "$[*]" COLUMNS(
                        sent DATETIME PATH "$.sent",
                        success BOOLEAN PATH "$.success"
                    )
                ) AS j
            where
                t.list_id = "#P:2#"
                and JSON_VALID(t.sms_data)
                and j.success and j.sent >= "#P:0#" and j.sent <= "#P:1# 23:59:59";`,

        q0953: `
            truncate table frdcall_live_agents_copy;
        `,
        q0954: `
            insert into frdcall_live_agents_copy select * from frdcall_live_agents;
        `,
        q0955: ``,
        q0956: `
                SELECT
                    days_of_week.day_of_week,
                    IFNULL(COUNT(connected_calls.status = "Y" OR NULL), 0) AS connected_count,
                    IFNULL(COUNT(connected_calls.lead_id), 0) AS call_count
                FROM (
                    SELECT 1 AS day_num, '日曜日' AS day_of_week
                    UNION SELECT 2, '月曜日'
                    UNION SELECT 3, '火曜日'
                    UNION SELECT 4, '水曜日'
                    UNION SELECT 5, '木曜日'
                    UNION SELECT 6, '金曜日'
                    UNION SELECT 7, '土曜日'
                ) AS days_of_week
                LEFT JOIN (
                    SELECT
                        t2.lead_id,
                        t3.call_date,
                        COALESCE(s.#P:1#, cs.#P:1#) AS status
                    FROM
                        frdcall_list t2
                    LEFT JOIN
                        frdcall_log t3
                    ON
                        t2.lead_id = t3.lead_id
                    LEFT JOIN
                        frdcall_statuses s
                    ON
                        t3.status = s.status
                    LEFT JOIN
                        frdcall_campaign_statuses cs
                    ON
                        t3.status = cs.status AND t3.campaign_id = cs.campaign_id
                    WHERE
                        t2.list_id = '#P:0#'
                ) AS connected_calls
                ON
                    days_of_week.day_num = DAYOFWEEK(connected_calls.call_date)
                GROUP BY
                    days_of_week.day_num, days_of_week.day_of_week
                ORDER BY
                    days_of_week.day_num;          
        `,
        q0957: `
        SELECT
            CASE
                WHEN hours.hour_of_day = 0 THEN '午前 0時'
                WHEN hours.hour_of_day = 1 THEN '1時'
                WHEN hours.hour_of_day = 2 THEN '2時'
                WHEN hours.hour_of_day = 3 THEN '3時'
                WHEN hours.hour_of_day = 4 THEN '4時'
                WHEN hours.hour_of_day = 5 THEN '5時'
                WHEN hours.hour_of_day = 6 THEN '6時'
                WHEN hours.hour_of_day = 7 THEN '7時'
                WHEN hours.hour_of_day = 8 THEN '8時'
                WHEN hours.hour_of_day = 9 THEN '9時'
                WHEN hours.hour_of_day = 10 THEN '10時'
                WHEN hours.hour_of_day = 11 THEN '11時'
                WHEN hours.hour_of_day = 12 THEN '午後 0時'
                WHEN hours.hour_of_day = 13 THEN '1時'
                WHEN hours.hour_of_day = 14 THEN '2時'
                WHEN hours.hour_of_day = 15 THEN '3時'
                WHEN hours.hour_of_day = 16 THEN '4時'
                WHEN hours.hour_of_day = 17 THEN '5時'
                WHEN hours.hour_of_day = 18 THEN '6時'
                WHEN hours.hour_of_day = 19 THEN '7時'
                WHEN hours.hour_of_day = 20 THEN '8時'
                WHEN hours.hour_of_day = 21 THEN '9時'
                WHEN hours.hour_of_day = 22 THEN '10時'
                WHEN hours.hour_of_day = 23 THEN '11時'
            END AS hour_in_japanese,
            COALESCE(connected_calls.connected_count, 0) AS connected_calls,
            COALESCE(connected_calls.call_count, 0) AS call_count
        FROM (
            SELECT 0 AS hour_of_day
            UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4
            UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8
            UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12
            UNION SELECT 13 UNION SELECT 14 UNION SELECT 15 UNION SELECT 16
            UNION SELECT 17 UNION SELECT 18 UNION SELECT 19 UNION SELECT 20
            UNION SELECT 21 UNION SELECT 22 UNION SELECT 23
        ) AS hours
        LEFT JOIN (
            SELECT
                HOUR(t3.call_date) AS hour_of_day,
                COUNT(COALESCE(s.#P:1#, cs.#P:1#) = 'Y' OR NULL) AS connected_count,
                COUNT(*) AS call_count
            FROM
                frdcall_list t2
            LEFT JOIN frdcall_log t3 ON t2.lead_id = t3.lead_id
            LEFT JOIN frdcall_statuses s ON t3.status = s.status
            LEFT JOIN frdcall_campaign_statuses cs ON t3.status = cs.status AND t3.campaign_id = cs.campaign_id
            WHERE t2.list_id = '#P:0#'
            GROUP BY hour_of_day
        ) AS connected_calls ON hours.hour_of_day = connected_calls.hour_of_day
        ORDER BY hours.hour_of_day;
        `,
        q0958: `
            SELECT * from frdcall_industries;
        `,
        q0959: `
        WITH group_list AS (
			SELECT user_group 
            FROM frdcall_user_groups 
            WHERE (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = "#P:1#" ) RLIKE CONCAT("\\\\b",user_group,"\\\\b")
        ),
        rank_date AS (
            SELECT list_id,week,hour
            FROM (
                SELECT
                    t3.list_id,
                    DAYOFWEEK(t3.call_date) week,
                    HOUR(t3.call_date) hour,
                    RANK() OVER (PARTITION BY list_id ORDER BY COUNT(*) DESC) AS ra
                FROM
                    frdcall_log t3
                LEFT JOIN frdcall_statuses s ON t3.status = s.status
                LEFT JOIN frdcall_campaign_statuses cs ON t3.status = cs.status AND t3.campaign_id = cs.campaign_id
                WHERE
                t3.user_group IN (SELECT * FROM group_list)
                    AND COALESCE(s.#P:0#, cs.#P:0#) = 'Y'
                GROUP BY DAYOFWEEK(t3.call_date), HOUR(t3.call_date)
            ) AS tmp
            WHERE tmp.ra <= 2
        )
        SELECT
            l.list_id,
            l.list_name,
            ROUND(COALESCE(connected_calls.connected_count, 0) / COALESCE(connected_calls.call_count, 1) * 100, 0) AS connected_ratio,
            CASE
                WHEN COALESCE(connected_calls.connected_count, 0) > 0
                THEN CONCAT(
                    CASE
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1) = 1 THEN CONCAT('日曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1) = 2 THEN CONCAT('月曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1) = 3 THEN CONCAT('火曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1) = 4 THEN CONCAT('水曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1) = 5 THEN CONCAT('木曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1) = 6 THEN CONCAT('金曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1) = 7 THEN CONCAT('月曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week ASC LIMIT 1),'時')
                    END,
                    CASE
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1) = 1 THEN CONCAT(' - 日曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1) = 2 THEN CONCAT(' - 月曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1) = 3 THEN CONCAT(' - 火曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1) = 4 THEN CONCAT(' - 水曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1) = 5 THEN CONCAT(' - 木曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1) = 6 THEN CONCAT(' - 金曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1),'時')
                        WHEN (SELECT week FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1) = 7 THEN CONCAT(' - 月曜日午前 ',(SELECT hour FROM rank_date a WHERE a.list_id = l.list_id ORDER BY week DESC LIMIT 1),'時')
                    END
                )
                ELSE NULL
            END AS best_time_to_call_range,
            COALESCE(connected_calls.connected_count, 0) AS connected_calls,
            COALESCE(connected_calls.call_count, 0) AS call_count,
            COALESCE(leads.leads_count, 0) AS number_of_leads,
            l.list_lastcalldate
        FROM
            frdcall_lists l
        LEFT JOIN (
            SELECT
                t2.list_id,
                COUNT(COALESCE(s.#P:0#, cs.#P:0#) = 'Y' OR NULL) AS connected_count,
                COUNT(*) AS call_count,
                MIN(t3.call_date) AS first_connected_call,
                MAX(t3.call_date) AS last_connected_call
            FROM
                frdcall_list t2
            LEFT JOIN frdcall_log t3 ON t2.lead_id = t3.lead_id
            LEFT JOIN frdcall_statuses s ON t3.status = s.status
            LEFT JOIN frdcall_campaign_statuses cs ON t3.status = cs.status AND t3.campaign_id = cs.campaign_id
            GROUP BY t2.list_id) AS connected_calls ON l.list_id = connected_calls.list_id
        LEFT JOIN (
            SELECT
                t2.list_id,
                COUNT(DISTINCT t2.lead_id) AS leads_count
            FROM
                frdcall_list t2
            GROUP BY t2.list_id) AS leads ON l.list_id = leads.list_id
        WHERE
            (
                CASE
                    WHEN EXISTS (
                        SELECT 1
                        FROM frdcall_user_groups
                        WHERE user_group = '#P:1#'
                        AND allowed_campaigns LIKE '%-ALL-CAMPAIGNS-%'
                    )
                    THEN 1 -- Show all campaigns
                    ELSE FIND_IN_SET(l.campaign_id, (
                        SELECT REPLACE(allowed_campaigns, ' ', ',')
                        FROM frdcall_user_groups
                        WHERE user_group = '#P:1#'
                    )) > 0
                END
            )
            AND l.campaign_id != '53804164';
        `,
        q0960: `
            WITH group_list AS (
                SELECT user_group 
                FROM frdcall_user_groups 
                WHERE (SELECT admin_viewable_groups FROM frdcall_user_groups WHERE user_group = "#P:1#" ) RLIKE CONCAT("\\\\b",user_group,"\\\\b")
            ),
            rank_date AS (
                SELECT campaign_id,week,hour
                FROM (
                    SELECT
                        t3.campaign_id,
                        DAYOFWEEK(t3.call_date) week,
                        HOUR(t3.call_date) hour,
                        RANK() OVER (PARTITION BY campaign_id ORDER BY COUNT(*) DESC) AS ra
                    FROM
                        frdcall_log t3
                    LEFT JOIN frdcall_statuses s ON t3.status = s.status
                    LEFT JOIN frdcall_campaign_statuses cs ON t3.status = cs.status AND t3.campaign_id = cs.campaign_id
                    WHERE
                        t3.user_group IN (SELECT * FROM group_list)
                        AND COALESCE(s.#P:0#, cs.#P:0#) = 'Y'
                    GROUP BY DAYOFWEEK(t3.call_date), HOUR(t3.call_date)
                ) AS tmp
                WHERE tmp.ra <= 2
            )
            SELECT
            c.campaign_id,
            c.campaign_name,
            i.name AS industry_name,
            ROUND(COALESCE(connected_calls.connected_count, 0) / COALESCE(connected_calls.call_count, 1) * 100, 0) AS connected_ratio,
                CASE
                    WHEN COALESCE(connected_calls.connected_count, 0) > 0
                    THEN CONCAT(
                        CASE
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1) = 1 THEN CONCAT('日曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1) = 2 THEN CONCAT('月曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1) = 3 THEN CONCAT('火曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1) = 4 THEN CONCAT('水曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1) = 5 THEN CONCAT('木曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1) = 6 THEN CONCAT('金曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1) = 7 THEN CONCAT('土曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week ASC LIMIT 1),'時')
                        END,
                        CASE
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1) = 1 THEN CONCAT(' - 日曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1) = 2 THEN CONCAT(' - 月曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1) = 3 THEN CONCAT(' - 火曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1) = 4 THEN CONCAT(' - 水曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1) = 5 THEN CONCAT(' - 木曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1) = 6 THEN CONCAT(' - 金曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1),'時')
                            WHEN (SELECT week FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1) = 7 THEN CONCAT(' - 土曜日午前 ',(SELECT hour FROM rank_date a WHERE a.campaign_id = c.campaign_id ORDER BY week DESC LIMIT 1),'時')
                        END
                    )
                    ELSE NULL
                END AS best_time_to_call_range,
                COALESCE(connected_calls.call_count, 0) AS call_count,
                COALESCE(connected_calls.connected_count, 0) AS connected_calls,
                COALESCE(leads.leads_count, 0) AS number_of_leads,
                last_call.last_call_date AS last_call_date
            FROM
                frdcall_campaigns c
            LEFT JOIN frdcall_campaigns_extend ce ON c.campaign_id = ce.campaign_id
            LEFT JOIN frdcall_industries i ON ce.industry_id = i.industry_id
            LEFT JOIN (
                SELECT
                    cl.campaign_id,
                    COUNT(COALESCE(s.#P:0#, cs.#P:0#) = 'Y' OR NULL) AS connected_count,
                    COUNT(*) AS call_count,
                    MIN(cl.call_date) AS first_connected_call,
                    MAX(cl.call_date) AS last_connected_call
                FROM
                    frdcall_log cl
                LEFT JOIN frdcall_statuses s ON cl.status = s.status
                LEFT JOIN frdcall_campaign_statuses cs ON cl.status = cs.status AND cl.campaign_id = cs.campaign_id
                GROUP BY cl.campaign_id
            ) AS connected_calls ON c.campaign_id = connected_calls.campaign_id
            LEFT JOIN (
                SELECT
                    cl.campaign_id,
                    COUNT(DISTINCT fl.lead_id) AS leads_count
                FROM
                    frdcall_log cl
                LEFT JOIN frdcall_list fl ON cl.lead_id = fl.lead_id
                GROUP BY cl.campaign_id
            ) AS leads ON c.campaign_id = leads.campaign_id
            LEFT JOIN (
                SELECT
                    cl.campaign_id,
                    MAX(cl.call_date) AS last_call_date
                FROM
                    frdcall_log cl
                GROUP BY cl.campaign_id
            ) AS last_call ON c.campaign_id = last_call.campaign_id
            WHERE
                (
                    CASE
                        WHEN EXISTS (
                            SELECT 1
                            FROM frdcall_user_groups
                            WHERE user_group = '#P:1#'
                            AND allowed_campaigns LIKE '%-ALL-CAMPAIGNS-%'
                        )
                        THEN 1
                        ELSE FIND_IN_SET(c.campaign_id, (
                            SELECT REPLACE(allowed_campaigns, ' ', ',')
                            FROM frdcall_user_groups
                            WHERE user_group = '#P:1#'
                        )) > 0
                    END
                )
                AND c.campaign_id != '53804164'
            GROUP BY c.campaign_id, c.campaign_name, i.name, connected_calls.connected_count, leads.leads_count;
                `,
        q0961: `
            select user_group from frdcall_users where user = '#P:0#';
        `,
        q0962: `
            SELECT a.channel, a.server_ip
            FROM live_channels a 
            INNER JOIN frdcall_conferences b ON a.extension = b.conf_exten
            WHERE b.extension LIKE '%/#P:1#%'
            AND b.extension NOT LIKE '%#P:0#%'
            AND b.leave_3way = '1';
        `,
        q0963: `
                SELECT
                    days_of_week.day_of_week,
                    IFNULL(COUNT(connected_calls.status = "Y" OR NULL), 0) AS connected_count,
                    IFNULL(COUNT(connected_calls.campaign_id), 0) AS call_count
                FROM (
                    SELECT 1 AS day_num, '日曜日' AS day_of_week
                    UNION SELECT 2, '月曜日'
                    UNION SELECT 3, '火曜日'
                    UNION SELECT 4, '水曜日'
                    UNION SELECT 5, '木曜日'
                    UNION SELECT 6, '金曜日'
                    UNION SELECT 7, '土曜日'
                ) AS days_of_week
                LEFT JOIN (
                    SELECT
                        t3.call_date,
                        t3.campaign_id,
                        COALESCE(s.#P:1#, cs.#P:1#) AS status
                    FROM
                        frdcall_log t3
                    LEFT JOIN
                        frdcall_statuses s
                    ON
                        t3.status = s.status
                    LEFT JOIN
                        frdcall_campaign_statuses cs
                    ON
                        t3.status = cs.status AND t3.campaign_id = cs.campaign_id
                    WHERE
                        t3.campaign_id = '#P:0#'
                ) AS connected_calls
                ON
                    days_of_week.day_num = DAYOFWEEK(connected_calls.call_date)
                GROUP BY
                    days_of_week.day_num, days_of_week.day_of_week
                ORDER BY
                    days_of_week.day_num;
        `,
        q0964: `
                SELECT
                    CASE
                        WHEN hours.hour_of_day = 0 THEN '午前 0時'
                        WHEN hours.hour_of_day = 1 THEN '1時'
                        WHEN hours.hour_of_day = 2 THEN '2時'
                        WHEN hours.hour_of_day = 3 THEN '3時'
                        WHEN hours.hour_of_day = 4 THEN '4時'
                        WHEN hours.hour_of_day = 5 THEN '5時'
                        WHEN hours.hour_of_day = 6 THEN '6時'
                        WHEN hours.hour_of_day = 7 THEN '7時'
                        WHEN hours.hour_of_day = 8 THEN '8時'
                        WHEN hours.hour_of_day = 9 THEN '9時'
                        WHEN hours.hour_of_day = 10 THEN '10時'
                        WHEN hours.hour_of_day = 11 THEN '11時'
                        WHEN hours.hour_of_day = 12 THEN '午後 0時'
                        WHEN hours.hour_of_day = 13 THEN '1時'
                        WHEN hours.hour_of_day = 14 THEN '2時'
                        WHEN hours.hour_of_day = 15 THEN '3時'
                        WHEN hours.hour_of_day = 16 THEN '4時'
                        WHEN hours.hour_of_day = 17 THEN '5時'
                        WHEN hours.hour_of_day = 18 THEN '6時'
                        WHEN hours.hour_of_day = 19 THEN '7時'
                        WHEN hours.hour_of_day = 20 THEN '8時'
                        WHEN hours.hour_of_day = 21 THEN '9時'
                        WHEN hours.hour_of_day = 22 THEN '10時'
                        WHEN hours.hour_of_day = 23 THEN '11時'
                    END AS hour_in_japanese,
                    COALESCE(connected_calls.connected_count, 0) AS connected_calls,
                    COALESCE(connected_calls.call_count, 0) AS call_count
                FROM (
                    SELECT 0 AS hour_of_day
                    UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4
                    UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8
                    UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12
                    UNION SELECT 13 UNION SELECT 14 UNION SELECT 15 UNION SELECT 16
                    UNION SELECT 17 UNION SELECT 18 UNION SELECT 19 UNION SELECT 20
                    UNION SELECT 21 UNION SELECT 22 UNION SELECT 23
                ) AS hours
                LEFT JOIN (
                    SELECT
                        HOUR(t3.call_date) AS hour_of_day,
                        COUNT(COALESCE(s.#P:1#, cs.#P:1#) = 'Y' OR NULL) AS connected_count,
                        COUNT(*) AS call_count
                    FROM
                        frdcall_log t3
                    LEFT JOIN
                        frdcall_statuses s
                    ON
                        t3.status = s.status
                    LEFT JOIN
                        frdcall_campaign_statuses cs
                    ON
                        t3.status = cs.status AND t3.campaign_id = cs.campaign_id
                    WHERE
                        t3.campaign_id = '#P:0#'
                    GROUP BY hour_of_day
                ) AS connected_calls ON hours.hour_of_day = connected_calls.hour_of_day
                ORDER BY hours.hour_of_day;
        `,
        q0965: `SELECT list_id, list_name 
                    FROM frdcall_lists l
                WHERE
                        (
                            CASE
                                WHEN EXISTS (
                                    SELECT 1
                                    FROM frdcall_user_groups
                                    WHERE user_group = '#P:0#'
                                    AND allowed_campaigns LIKE '%-ALL-CAMPAIGNS-%'
                                )
                                THEN 1
                                ELSE FIND_IN_SET(l.campaign_id, (
                                    SELECT REPLACE(allowed_campaigns, ' ', ',')
                                    FROM frdcall_user_groups
                                    WHERE user_group = '#P:0#'
                                )) > 0
                            END
                        )
                AND l.campaign_id != '53804164';`,
        q0966: `SELECT sm_user_id, sm_api_token, sm_customer_id  FROM frdcall_admins WHERE customer_id = '#P:0#';`,
        q0967: `SELECT * FROM frdcall_ccdx WHERE customer_id = "#P:0#" AND is_delete = 0;`,
        q0968: `
        INSERT INTO frdcall_ccdx (\`id\`,\`customer_id\`,\`ccdx_name\`,\`gpt_script\`,\`simulation_data\`,\`edit_talkscript\`,\`input_form\`,\`page_convert\`,\`max_page\`,\`data_opts\`,\`list_input_name\`,\`list_input_name_arr_key\`,\`list_input_name_obj_conver_id_to_key\`,\`id_save_simulation\`,\`name_save_simulation\`,\`login_data\`,\`kakunin_form_flag\`,\`input_data_state_root\`,\`input_form_label\`) 
        VALUES( #P:0#,'#P:1#','#P:2#','#P:6#','#P:7#','#P:8#','#P:9#','#P:10#','#P:11#','#P:12#','#P:13#','#P:14#','#P:15#','#P:16#','#P:17#','#P:18#','#P:19#','#P:20#','#P:21#') 
        ON DUPLICATE KEY UPDATE \`customer_id\`='#P:1#',\`ccdx_name\`='#P:2#',\`gpt_script\`='#P:6#',\`simulation_data\`='#P:7#',\`edit_talkscript\`='#P:8#',\`input_form\`='#P:9#',\`page_convert\`='#P:10#',\`max_page\`='#P:11#',\`data_opts\`='#P:12#',\`list_input_name\`='#P:13#',\`list_input_name_arr_key\`='#P:14#',\`list_input_name_obj_conver_id_to_key\`='#P:15#',\`id_save_simulation\`='#P:16#',\`name_save_simulation\`='#P:17#',\`login_data\`='#P:18#',\`kakunin_form_flag\`='#P:19#',\`input_data_state_root\`='#P:20#',\`input_form_label\`='#P:21#';
        `,
        q0969: `UPDATE frdcall_ccdx SET is_delete = 1 WHERE id = "#P:0#" AND customer_id = "#P:1#" LIMIT 1`,
        q0970: `UPDATE frdcall_ccdx SET talk_select_html = "#P:2#", talk_script_html = "#P:3#" WHERE id = "#P:0#" AND customer_id = "#P:1#" LIMIT 1`,
        q0971: `UPDATE frdcall_ccdx SET gpt_script = "#P:2#" WHERE id = "#P:0#" AND customer_id = "#P:1#" LIMIT 1`,
        q0972: `INSERT INTO frdcall_industries (name, description) VALUES ('#P:0#', '#P:1#');`,
        q0973: `UPDATE frdcall_ccdx 
                SET gpt_script = 
                    CASE 
                        WHEN JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text1')) = '#P:0#' THEN JSON_SET(gpt_script, '$.text1', '#P:2#')
                        WHEN JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text2')) = '#P:0#' THEN JSON_SET(gpt_script, '$.text2', '#P:2#')
                        WHEN JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text3')) = '#P:0#' THEN JSON_SET(gpt_script, '$.text3', '#P:2#')
                        ELSE gpt_script
                    END
                WHERE JSON_VALID(gpt_script) AND
                    (JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text1')) = '#P:0#' OR
                    JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text2')) = '#P:0#' OR
                    JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text3')) = '#P:0#' ) AND customer_id = "#P:1#" LIMIT 1`,
        q0974: `UPDATE frdcall_ccdx 
                SET gpt_script = JSON_SET(gpt_script, '$.#P:2#', '#P:3#')
                WHERE JSON_VALID(gpt_script) AND id = "#P:0#" AND customer_id = "#P:1#" LIMIT 1`,
        q0975: `UPDATE frdcall_industries SET name = '#P:0#', description = '#P:1#' WHERE industry_id = '#P:2#' LIMIT 1;`,
        q0976: `DELETE FROM frdcall_industries WHERE industry_id = '#P:0#' LIMIT 1`,
        q0977: `SELECT id,ccdx_name,
                        CASE
                            WHEN JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text1')) = '#P:0#' THEN 'text1'
                            WHEN JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text2')) = '#P:0#' THEN 'text2'
                            WHEN JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text3')) = '#P:0#' THEN 'text3'
                            ELSE NULL
                        END AS matched_key
                FROM frdcall_ccdx 
                WHERE JSON_VALID(gpt_script) AND
                    (JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text1')) = '#P:0#' OR
                    JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text2')) = '#P:0#' OR
                    JSON_UNQUOTE(JSON_EXTRACT(gpt_script, '$.text3')) = '#P:0#' ) AND customer_id = "#P:1#" LIMIT 1`,
        q0978: `SELECT * FROM frdcall_ccdx WHERE customer_id = "#P:0#" AND id = "#P:1#" AND is_delete = 0;`,
        q0979: `
        SELECT CONCAT('admin_', feature_name) as feature_name, \`create\`, \`read\`, \`update\`, \`delete\` FROM frdcall_admin_features WHERE customer_id = "#P:0#"
        UNION ALL
        SELECT CONCAT('user_', feature_name) as feature_name,\`create\`, \`read\`, \`update\`, \`delete\` FROM frdcall_user_extend_features WHERE user = '#P:1#';
        `,
        q0980: `
            SELECT
                'frdcall_statuses' AS source,
                status AS status_name,
                CASE
                    WHEN completed = 'Y' THEN '完成'
                    WHEN sale = 'Y' THEN '成約'
                    WHEN human_answered = 'Y' THEN '有効接触'
                    WHEN customer_contact = 'Y' THEN '要継続対応'
                    WHEN unworkable = 'Y' THEN 'コンタクト不可'
                    WHEN dnc = 'Y' THEN '架電禁止'
                    ELSE NULL
                END AS status_value
            FROM
                frdcall_statuses
            WHERE
                status = '#P:0#'
            UNION
            
            SELECT
                'frdcall_campaign_statuses' AS source,
                status AS status_name,
                CASE
                    WHEN completed = 'Y' THEN '完成'
                    WHEN sale = 'Y' THEN '成約'
                    WHEN human_answered = 'Y' THEN '有効接触'
                    WHEN customer_contact = 'Y' THEN '要継続対応'
                    WHEN unworkable = 'Y' THEN 'コンタクト不可'
                    WHEN dnc = 'Y' THEN '架電禁止'
                    ELSE NULL
                END AS status_value
            FROM
                frdcall_campaign_statuses
            WHERE
                campaign_id = '#P:1#'
                AND status = '#P:0#';
        `,
        q0981: `
        SELECT sales_marker_project_id FROM frdcall_list_extend where lead_id = '#P:0#' LIMIT 1;
        `,
        q0982: `SELECT MAX(list_id) + 1 as next_list_id FROM frdcall_lists;`,
        q0983: `SELECT sm_user_id, sm_api_token FROM frdcall_admins a LEFT JOIN frdcall_user_groups b ON a.customer_id = b.user_group WHERE is_delete = 0 AND LOCATE(CONCAT(' ', (SELECT user_group FROM frdcall_users WHERE user = "#P:0#" LIMIT 1),' '), b.admin_viewable_groups) > 0 LIMIT 1;`,
        q0984: `
        SELECT 
            cl.uniqueid as ID,
            cl.call_date as 受電日時,
            cl.campaign_id as イングループ,
            cl.list_id as リスト,
            cl.phone_number as 電話番号,
            cl.status as 結果,
            rl.length_in_sec as 通話秒数,
            cl.user_group as ユーザーグループ,
            us.full_name as オペレーター,
            cl.lead_id as リード,
            rl.length_in_sec as tsec,
            al.dispo_sec as dsec,
            cl.queue_seconds as qsec,
            cs.human_answered as hu,
            cs.completed as comp
        FROM frdcall_closer_log cl
        LEFT JOIN frdcall_agent_log al USING(uniqueid)
        LEFT JOIN recording_log rl USING(uniqueid)
        LEFT JOIN frdcall_users us ON cl.user = us.user
        LEFT JOIN frdcall_campaign_statuses cs ON cs.campaign_id = "#P:1#" AND cl.status = cs.status
        WHERE cl.user = "#P:0#" AND list_id IN ('#P:2#') AND DATE(cl.call_date) = DATE(NOW());
        `,
        q0985: `
        SELECT 
            cl.uniqueid as ID,
            cl.call_date as コール日時,
            cl.campaign_id as 業務グループ,
            cl.list_id as リスト,
            cl.phone_number as 電話番号,
            cl.status as 結果,
            rl.length_in_sec as 通話秒数,
            cl.user_group as ユーザーグループ,
            us.full_name as オペレーター,
            cl.lead_id as リード,
            rl.length_in_sec as tsec,
            cs.human_answered as ha,
            cs.sale as sale,
            cs.category as category
        FROM frdcall_log cl
        LEFT JOIN recording_log rl USING(uniqueid)
        LEFT JOIN frdcall_users us ON cl.user = us.user
        LEFT JOIN frdcall_campaign_statuses cs ON cs.campaign_id = "#P:1#" AND cl.status = cs.status
        WHERE cl.user = "#P:0#" AND cl.campaign_id IN ('#P:2#') AND list_id IN ('#P:3#') AND DATE(cl.call_date) = DATE(NOW());
        `,
        q0986: `
        WITH rank_date AS (
            SELECT list_id,week,hour
            FROM (
                SELECT
                    t3.list_id,
                    DAYOFWEEK(t3.call_date) week,
                    HOUR(t3.call_date) hour,
                    RANK() OVER (PARTITION BY list_id ORDER BY COUNT(*) DESC) AS ra
                FROM
                    frdcall_log t3
                LEFT JOIN frdcall_statuses s ON t3.status = s.status
                LEFT JOIN frdcall_campaign_statuses cs ON t3.status = cs.status AND t3.campaign_id = cs.campaign_id
                WHERE
                    t3.campaign_id = "#P:0#" 
                    AND COALESCE(s.human_answered, cs.human_answered) = 'Y'
                GROUP BY DAYOFWEEK(t3.call_date), HOUR(t3.call_date)
            ) AS tmp
            WHERE tmp.ra <= 2
        )
        SELECT 
            a.list_id, -- *, DAYOFWEEK(NOW()), HOUR(NOW()),
            CASE
                WHEN a.start_week < DAYOFWEEK(NOW()) AND DAYOFWEEK(NOW()) < a.end_week THEN 1
                WHEN a.start_week <= DAYOFWEEK(NOW()) AND DAYOFWEEK(NOW()) < a.end_week AND b.hour <= HOUR(NOW()) THEN 1
                WHEN a.start_week < DAYOFWEEK(NOW()) AND DAYOFWEEK(NOW()) <= a.end_week AND c.hour >= HOUR(NOW()) THEN 1
                WHEN a.start_week = DAYOFWEEK(NOW()) AND DAYOFWEEK(NOW()) = a.end_week AND b.hour <= HOUR(NOW()) AND c.hour >= HOUR(NOW()) THEN 1
                ELSE 0
            END AS test
        FROM (
            SELECT
                list_id,
                MIN(week) AS start_week,
                MAX(week) AS end_week
            FROM
                rank_date
            GROUP BY list_id
        ) a
        LEFT JOIN rank_date b
            ON a.list_id = b.list_id AND a.start_week = b.week
        LEFT JOIN rank_date c
            ON a.list_id = c.list_id AND a.end_week = c.week
        GROUP BY a.list_id
        ;
        `,
        q0987: `
        SELECT
            *
        FROM
            frdcall_list li
        LEFT JOIN frdcall_statuses s ON li.status = s.status
        LEFT JOIN frdcall_campaign_statuses cs ON li.status = cs.status AND cs.campaign_id = "#P:1#"
        WHERE
            li.list_id = "#P:0#" 
            AND COALESCE(s.customer_contact, cs.customer_contact) = 'Y'
            AND lead_id NOT IN (
                SELECT
                    li.lead_id
                FROM
                    frdcall_list li
                LEFT JOIN frdcall_log fl USING(lead_id)
                LEFT JOIN frdcall_statuses s ON li.status = s.status
                LEFT JOIN frdcall_campaign_statuses cs ON li.status = cs.status AND cs.campaign_id = "#P:1#"
                WHERE
                    li.list_id = "#P:0#" 
                    AND COALESCE(s.customer_contact, cs.customer_contact) = 'Y'
                    AND (ABS(HOUR(fl.call_date) - HOUR(NOW())) < 3)
            )
        `,
        q0988: `
        SELECT
            *
        FROM frdcall_user_groups u
        WHERE (
                SELECT admin_viewable_groups 
                FROM frdcall_user_groups a 
                WHERE a.user_group = "#P:0#"
                LIMIT 1
            ) RLIKE CONCAT( "\\\\b", u.user_group, "\\\\b");
        `,
        q0989: `
        SELECT group_id, group_name, full_name, 
            MAX(call_date) as last_date,
            MAX(queue_seconds) as max_queue,
            AVG(queue_seconds) as avg_queue, 
            AVG(talk_sec) as avg_talk, 
            COUNT(status) as cnt,
            COUNT(status NOT IN ('IVR','LIVE','TIMEOT','GONE','DROP','AFTHRS','QUEUE') OR NULL) / COUNT(status) as par_ans,
            COUNT(status='LIVE' OR NULL) as cnt_ivr,  
            COUNT(status='CLOSER' OR NULL) as cnt_call,  
            COUNT(status='TIMEOT' OR NULL) as cnt_timeout,  
            COUNT(status='GONE' OR NULL) as cnt_gone,  
            COUNT(status='AFTHRS' OR NULL) as cnt_aft, 
            COUNT(status IN ('DROP', 'QUEUE') OR NULL) as cnt_drop,  
            COUNT(ivr_status = 'OVER' OR NULL) as cnt_over,  
            COUNT(status NOT IN ('IVR','LIVE','TIMEOT','GONE','DROP','AFTHRS','QUEUE') OR NULL) as cnt_ans
        FROM (
        SELECT ingrp.group_id, ingrp.group_name, closer.call_date,
            us.user, us.full_name, closer.length_in_sec, closer.queue_seconds, 
            rec.length_in_sec talk_sec,
            closer.status as status, closer.ivr_status
        FROM frdcall_inbound_groups ingrp
        LEFT JOIN (
                SELECT user, GROUP_CONCAT(DISTINCT ingroup SEPARATOR " ") as ingroup
                FROM (
                    SELECT DISTINCT user, campaign_id as ingroup FROM frdcall_closer_log WHERE call_date >= '#P:0#' AND call_date <= '#P:1#' AND campaign_id IS NOT NULL
                    UNION ALL
                    SELECT DISTINCT user, closer_campaigns as ingroup FROM frdcall_users WHERE closer_campaigns IS NOT NULL
                )a
                GROUP BY user
            )users
            ON users.ingroup RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
        LEFT JOIN(
                SELECT list_id, campaign_id, call_date, user, queue_seconds, length_in_sec, status, uniqueid, ivr_status
                FROM frdcall_closer_log cl
                WHERE call_date >= '#P:0#' AND call_date <= '#P:1#'
                AND campaign_id IS NOT NULL
            ) closer
            ON closer.campaign_id = ingrp.group_id
            AND users.user = closer.user
        LEFT JOIN (SELECT user,closer_campaigns FROM frdcall_users) ingrp_us
            ON ingrp_us.closer_campaigns RLIKE CONCAT('\\\\b', ingrp.group_id, '\\\\b')
            AND users.user = ingrp_us.user
        LEFT JOIN (SELECT user,full_name FROM frdcall_users) us
            ON closer.user = us.user
            OR users.user = us.user
        LEFT JOIN (SELECT uniqueid,SUM(length_in_sec)length_in_sec FROM recording_log WHERE  start_time >= '#P:0#' AND start_time <= '#P:1#' GROUP BY uniqueid ) rec
            ON closer.uniqueid = rec.uniqueid
        )acd
        GROUP BY group_id, group_name, full_name
            `,
        q0990: `SELECT * FROM frdcall_call_times WHERE user_group="#P:0#";`,
        q0991: `SELECT * FROM frdcall_call_times WHERE call_time_id="#P:0#";`,
        q0992: `
        SELECT 
            CASE 
                WHEN 
                    TIME_FORMAT(NOW(), '%k%i') BETWEEN ct_default_start AND ct_default_stop 
                    OR 
                    (DAYOFWEEK(NOW()) = 1 AND TIME_FORMAT(NOW(), '%k%i') BETWEEN ct_sunday_start AND ct_sunday_stop)
                    OR 
                    (DAYOFWEEK(NOW()) = 2 AND TIME_FORMAT(NOW(), '%k%i') BETWEEN ct_monday_start AND ct_monday_stop)
                    OR 
                    (DAYOFWEEK(NOW()) = 3 AND TIME_FORMAT(NOW(), '%k%i') BETWEEN ct_tuesday_start AND ct_tuesday_stop)
                    OR 
                    (DAYOFWEEK(NOW()) = 4 AND TIME_FORMAT(NOW(), '%k%i') BETWEEN ct_wednesday_start AND ct_wednesday_stop)
                    OR 
                    (DAYOFWEEK(NOW()) = 5 AND TIME_FORMAT(NOW(), '%k%i') BETWEEN ct_thursday_start AND ct_thursday_stop)
                    OR 
                    (DAYOFWEEK(NOW()) = 6 AND TIME_FORMAT(NOW(), '%k%i') BETWEEN ct_friday_start AND ct_friday_stop)
                    OR 
                    (DAYOFWEEK(NOW()) = 7 AND TIME_FORMAT(NOW(), '%k%i') BETWEEN ct_saturday_start AND ct_saturday_stop)
                THEN "Y"
                ELSE "N"
            END AS check_call_time
        FROM frdcall_call_times
        WHERE call_time_id="#P:0#" AND user_group = "#P:1#";
        `,
        q0993: `
            SELECT 
                u.full_name AS operator_name,
                l.user,
                ROUND(TIMESTAMPDIFF(HOUR, MIN(DISTINCT a.event_time), MAX(DISTINCT a.event_time))) as total_operating_time_sec,
                IFNULL(r.length_in_sec, IFNULL(a.talk_sec, l.length_in_sec)) AS total_talk_time,
                COUNT(distinct l.uniqueid) as number_of_calls,
                COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) AS number_of_contacts,
                ROUND((COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) / COUNT(l.uniqueid)) * 100, 2) AS contact_rate,
                COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) AS number_of_appointments,
                ROUND((COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / COUNT(l.uniqueid)) * 100, 2) AS call_appointment_rate,
                ROUND((COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL))) * 100, 2) AS spc_contact_appointment_rate,
                ROUND(COUNT(l.uniqueid) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS dph,
                ROUND(COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS cph,
                ROUND(COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS sph
            FROM frdcall_log l
            JOIN 
                frdcall_users u ON l.user = u.user
            JOIN 
                frdcall_agent_log a ON l.user = a.user
            JOIN (
                SELECT SUM(length_in_sec) as length_in_sec, user FROM recording_log WHERE user IN('#P:0#') group by user
                ) r ON l.user = r.user
            LEFT JOIN 
                frdcall_statuses s ON l.status = s.status
            LEFT JOIN 
                frdcall_campaign_statuses cs ON l.status = cs.status
            WHERE 
                l.user IN ('#P:0#') AND
                l.campaign_id IN ('#P:3#') AND
                l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY 
                l.user
        `,
        q0994: `
            SELECT 
                MIN(a.event_time) AS start_time,
                MAX(a.event_time) AS end_time,
                CASE
                    WHEN HOUR(start_time) < 9 THEN '～9時'
                    WHEN HOUR(start_time) = 9 THEN '9時ー10時'
                    WHEN HOUR(start_time) = 10 THEN '10時ー11時'
                    WHEN HOUR(start_time) = 11 THEN '11時ー12時'
                    WHEN HOUR(start_time) = 12 THEN '12時ー13時'
                    WHEN HOUR(start_time) = 13 THEN '13時ー14時'
                    WHEN HOUR(start_time) = 14 THEN '14時ー15時'
                    WHEN HOUR(start_time) = 15 THEN '15時ー16時'
                    WHEN HOUR(start_time) = 16 THEN '16時ー17時'
                    WHEN HOUR(start_time) = 17 THEN '17時ー18時'
                    WHEN HOUR(start_time) = 18 THEN '18時ー19時'
                    WHEN HOUR(start_time) = 19 THEN '19時ー20時'
                    ELSE '20時～'
                END AS time_by_hour,
                DATE_FORMAT(l.call_date, '%Y-%m') AS call_period,
                DATE_FORMAT(l.call_date, '%Y-%m-%d') AS time_date,
                u.full_name AS operator_name,
                l.status,
                COUNT(*) AS status_count,
                SUM(IFNULL(r.length_in_sec, IFNULL(a.talk_sec, l.length_in_sec))) AS total_talk_time_for_status
            FROM 
                frdcall_log l
            JOIN 
                frdcall_users u ON l.user = u.user
            JOIN 
                frdcall_agent_log a ON l.user = a.user
            LEFT JOIN 
                recording_log r ON l.uniqueid = r.uniqueid
            WHERE 
                l.user IN ('#P:0#') AND
                LOWER(l.campaign_id) IN ('#P:3#') AND
                l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY 
                l.status, u.full_name;  
        `,
        q0995: `
            SELECT DISTINCT l.status
            FROM frdcall_log l
            WHERE 
                l.user IN('#P:0#') AND
                l.campaign_id IN('#P:3#') AND
                l.call_date BETWEEN "#P:1#" AND "#P:2#";
        `,
        q0996: `
            SELECT 
                DATE_FORMAT(l.call_date, '%Y-%m') AS call_period,
                ROUND((TIMESTAMPDIFF(SECOND, MIN(a.event_time), MAX(a.event_time)) / 3600.0), 2) AS total_operating_time_sec,
                COUNT(DISTINCT a.user) AS total_users,
                IFNULL(r.length_in_sec, IFNULL(a.talk_sec, l.length_in_sec)) AS total_talk_time,
                COUNT(distinct l.uniqueid) as number_of_calls,
                COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) AS number_of_contacts,
                ROUND((COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) / COUNT(l.uniqueid)) * 100, 2) AS contact_rate,
                COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) AS number_of_appointments,
                ROUND((COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / COUNT(l.uniqueid)) * 100, 2) AS call_appointment_rate,
                ROUND((COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL))) * 100, 2) AS spc_contact_appointment_rate,
                ROUND(COUNT(l.uniqueid) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS dph,
                ROUND(COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS cph,
                ROUND(COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS sph
            FROM 
                frdcall_log l
            JOIN 
                frdcall_users u ON l.user = u.user
            JOIN 
                frdcall_agent_log a ON l.user = a.user
            JOIN (
                    SELECT SUM(length_in_sec) as length_in_sec, user FROM recording_log WHERE user IN('#P:0#') group by user
                    ) r ON l.user = r.user
            LEFT JOIN 
                frdcall_statuses s ON l.status = s.status
            LEFT JOIN 
                frdcall_campaign_statuses cs ON l.status = cs.status
            WHERE 
                LOWER(l.user) IN ('#P:0#') AND
                LOWER(l.campaign_id) IN ('#P:3#') AND
                l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY 
                DATE_FORMAT(l.call_date, '%Y-%m');
        `,
        q0997: `
            SELECT
                DATE_FORMAT(l.call_date, '%Y-%m-%d') AS time_date,
                DAYNAME(l.call_date) AS day_name,
                MIN(a.event_time) AS start_time,
                MAX(a.event_time) AS end_time,
                ROUND((TIMESTAMPDIFF(SECOND, MIN(a.event_time), MAX(a.event_time)) / 3600.0), 2) AS total_operating_time_sec,
                COUNT(DISTINCT a.user) AS total_users,
                IFNULL(r.length_in_sec, IFNULL(a.talk_sec, l.length_in_sec)) AS total_talk_time,
                COUNT(distinct l.uniqueid) as number_of_calls,
                COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) AS number_of_contacts,
                ROUND((COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) / COUNT(l.uniqueid)) * 100, 2) AS contact_rate,
                COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) AS number_of_appointments,
                ROUND((COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / COUNT(l.uniqueid)) * 100, 2) AS call_appointment_rate,
                ROUND((COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL))) * 100, 2) AS spc_contact_appointment_rate,
                ROUND(COUNT(l.uniqueid) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS dph,
                ROUND(COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS cph,
                ROUND(COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS sph
            FROM
                frdcall_log l
            JOIN
                frdcall_users u ON l.user = u.user
            JOIN
                frdcall_agent_log a ON l.user = a.user
            JOIN (
                    SELECT SUM(length_in_sec) as length_in_sec, user FROM recording_log WHERE user IN('#P:0#') group by user
                    ) r ON l.user = r.user
            LEFT JOIN
                frdcall_statuses s ON l.status = s.status
            LEFT JOIN
                frdcall_campaign_statuses cs ON l.status = cs.status
            WHERE
                LOWER(l.user) IN ('#P:0#') AND
                LOWER(l.campaign_id) IN ('#P:3#') AND
                l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY
                DATE_FORMAT(l.call_date, '%Y-%m'),
                DAYNAME(l.call_date);
        `,
        q0998: `
            SELECT
                CASE
                        WHEN HOUR(a.event_time) < 9 THEN '～9時'
                        WHEN HOUR(a.event_time) = 9 THEN '9時ー10時'
                        WHEN HOUR(a.event_time) = 10 THEN '10時ー11時'
                        WHEN HOUR(a.event_time) = 11 THEN '11時ー12時'
                        WHEN HOUR(a.event_time) = 12 THEN '12時ー13時'
                        WHEN HOUR(a.event_time) = 13 THEN '13時ー14時'
                        WHEN HOUR(a.event_time) = 14 THEN '14時ー15時'
                        WHEN HOUR(a.event_time) = 15 THEN '15時ー16時'
                        WHEN HOUR(a.event_time) = 16 THEN '16時ー17時'
                        WHEN HOUR(a.event_time) = 17 THEN '17時ー18時'
                        WHEN HOUR(a.event_time) = 18 THEN '18時ー19時'
                        WHEN HOUR(a.event_time) = 19 THEN '19時ー20時'
                    ELSE '20時～'
                END AS time_by_hour,
                COUNT(DISTINCT a.user) AS total_users,
                IFNULL(r.length_in_sec, IFNULL(a.talk_sec, l.length_in_sec)) AS total_talk_time,
                COUNT(distinct l.uniqueid) as number_of_calls,
                COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) AS number_of_contacts,
                ROUND((COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) / COUNT(l.uniqueid)) * 100, 2) AS contact_rate,
                COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) AS number_of_appointments,
                ROUND((COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / COUNT(l.uniqueid)) * 100, 2) AS call_appointment_rate,
                ROUND((COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL))) * 100, 2) AS spc_contact_appointment_rate,
                ROUND(COUNT(l.uniqueid) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS dph,
                ROUND(COUNT(IF(s.human_answered = 'Y' OR cs.human_answered = 'Y', 1, NULL)) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS cph,
                ROUND(COUNT(IF(s.sale = 'Y' OR cs.sale = 'Y', 1, NULL)) / TIMESTAMPDIFF(HOUR, MIN(a.event_time), MAX(a.event_time)), 2) AS sph
            FROM 
                frdcall_log l
            JOIN 
                frdcall_agent_log a ON l.user = a.user
            JOIN (
                SELECT SUM(length_in_sec) as length_in_sec, user FROM recording_log WHERE user IN('#P:0#') group by user
                ) r ON l.user = r.user
            LEFT JOIN 
                frdcall_statuses s ON l.status = s.status
            LEFT JOIN 
                frdcall_campaign_statuses cs ON l.status = cs.status
            WHERE 
                l.user IN('#P:0#') AND
                l.campaign_id IN ('#P:3#') AND
            l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY
                CASE
                    WHEN HOUR(a.event_time) < 9 THEN '～9時'
                    WHEN HOUR(a.event_time) = 9 THEN '9時ー10時'
                    WHEN HOUR(a.event_time) = 10 THEN '10時ー11時'
                    WHEN HOUR(a.event_time) = 11 THEN '11時ー12時'
                    WHEN HOUR(a.event_time) = 12 THEN '12時ー13時'
                    WHEN HOUR(a.event_time) = 13 THEN '13時ー14時'
                    WHEN HOUR(a.event_time) = 14 THEN '14時ー15時'
                    WHEN HOUR(a.event_time) = 15 THEN '15時ー16時'
                    WHEN HOUR(a.event_time) = 16 THEN '16時ー17時'
                    WHEN HOUR(a.event_time) = 17 THEN '17時ー18時'
                    WHEN HOUR(a.event_time) = 18 THEN '18時ー19時'
                    WHEN HOUR(a.event_time) = 19 THEN '19時ー20時'
                ELSE '20時～'
                END
        `,
        q0999: `
        SELECT
            u.full_name AS operator_name,
            ROUND(TIMESTAMPDIFF(SECOND, MIN(DISTINCT a.event_time), MAX(DISTINCT a.event_time))) as total_operating_time_sec,
            COUNT(distinct l.uniqueid) as number_of_calls,
            SUM(CASE WHEN l.status NOT IN ('IVR', 'LIVE', 'TIMEOT', 'GONE', 'DROP', 'AFTHRS', 'QUEUE') THEN 1 ELSE 0 END) AS number_of_responses,
            SUM(CASE WHEN l.status NOT IN ('IVR', 'LIVE', 'TIMEOT', 'GONE', 'DROP', 'AFTHRS', 'QUEUE') THEN 1 ELSE 0 END) / COUNT(*) * 100 AS response_rate_percentage,
            SUM(CASE WHEN l.status = 'AFTHRS' THEN 1 ELSE 0 END) AS number_of_outside_hours,
            SUM(CASE WHEN l.status = 'GONE' THEN 1 ELSE 0 END) AS number_of_leave,
            SUM(CASE WHEN l.status = 'TIMEOT' THEN 1 ELSE 0 END) AS number_of_time_out,
            SUM(CASE WHEN l.status = 'DROP' THEN 1 ELSE 0 END) AS number_of_abandoned,
            AVG(a.talk_sec) as att,
            AVG(a.dispo_sec) as aht,
            AVG(l.length_in_sec) as asa,
            SUM(a.dispo_sec) as post_processing_time
            FROM frdcall_closer_log l
            JOIN
            frdcall_users u ON l.user = u.user
            JOIN 
            frdcall_agent_log a ON l.user = a.user
            WHERE
            l.user IN('#P:0#') AND
            l.campaign_id IN ('#P:3#') AND
            l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY
            l.user
            `,
        q1000: `
            SELECT 
                DATE_FORMAT(l.call_date, '%Y-%m') AS call_period,
                ROUND((TIMESTAMPDIFF(SECOND, MIN(a.event_time), MAX(a.event_time)) / 3600.0), 2) AS total_operating_time_sec,
                COUNT(DISTINCT a.user) AS total_users,
                IFNULL(r.length_in_sec, IFNULL(a.talk_sec, l.length_in_sec)) AS total_talk_time,
                COUNT(distinct l.uniqueid) as number_of_calls,
                SUM(CASE WHEN l.status NOT IN ('IVR', 'LIVE', 'TIMEOT', 'GONE', 'DROP', 'AFTHRS', 'QUEUE') THEN 1 ELSE 0 END) AS number_of_responses,
                SUM(CASE WHEN l.status NOT IN ('IVR', 'LIVE', 'TIMEOT', 'GONE', 'DROP', 'AFTHRS', 'QUEUE') THEN 1 ELSE 0 END) / COUNT(*) * 100 AS response_rate_percentage,
                SUM(CASE WHEN l.status = 'AFTHRS' THEN 1 ELSE 0 END) AS number_of_outside_hours,
                SUM(CASE WHEN l.status = 'GONE' THEN 1 ELSE 0 END) AS number_of_leave,
                SUM(CASE WHEN l.status = 'TIMEOT' THEN 1 ELSE 0 END) AS number_of_time_out,
                SUM(CASE WHEN l.status = 'DROP' THEN 1 ELSE 0 END) AS number_of_abandoned,
                AVG(a.talk_sec) as att,
                AVG(a.dispo_sec) as aht,
                AVG(l.length_in_sec) as asa,
                SUM(a.dispo_sec) as post_processing_time
            FROM 
                frdcall_closer_log l
            JOIN 
                frdcall_users u ON l.user = u.user
            JOIN 
                frdcall_agent_log a ON l.user = a.user
            WHERE 
                l.user IN ('#P:0#') AND
                l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY 
                DATE_FORMAT(l.call_date, '%Y-%m');
        `,
        q1001: `
            SELECT
                DATE_FORMAT(l.call_date, '%Y-%m-%d') AS time_date,
                DAYNAME(l.call_date) AS day_name,
                ROUND((TIMESTAMPDIFF(SECOND, MIN(a.event_time), MAX(a.event_time)) / 3600.0), 2) AS total_operating_time_sec,
                COUNT(DISTINCT a.user) AS total_users,
                IFNULL(r.length_in_sec, IFNULL(a.talk_sec, l.length_in_sec)) AS total_talk_time,
                COUNT(distinct l.uniqueid) as number_of_calls,
                SUM(CASE WHEN l.status NOT IN ('IVR', 'LIVE', 'TIMEOT', 'GONE', 'DROP', 'AFTHRS', 'QUEUE') THEN 1 ELSE 0 END) AS number_of_responses,
                SUM(CASE WHEN l.status NOT IN ('IVR', 'LIVE', 'TIMEOT', 'GONE', 'DROP', 'AFTHRS', 'QUEUE') THEN 1 ELSE 0 END) / COUNT(*) * 100 AS response_rate_percentage,
                SUM(CASE WHEN l.status = 'AFTHRS' THEN 1 ELSE 0 END) AS number_of_outside_hours,
                SUM(CASE WHEN l.status = 'GONE' THEN 1 ELSE 0 END) AS number_of_leave,
                SUM(CASE WHEN l.status = 'TIMEOT' THEN 1 ELSE 0 END) AS number_of_time_out,
                SUM(CASE WHEN l.status = 'DROP' THEN 1 ELSE 0 END) AS number_of_abandoned,
                AVG(a.talk_sec) as att,
                AVG(a.dispo_sec) as aht,
                AVG(l.length_in_sec) as asa,
                SUM(a.dispo_sec) as post_processing_time
            FROM
                frdcall_log l
            JOIN
                frdcall_users u ON l.user = u.user
            JOIN 
                frdcall_agent_log a ON l.user = a.user
            WHERE
                l.user IN ('#P:0#') AND
                l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY
                DATE_FORMAT(l.call_date, '%Y-%m'),
                DAYNAME(l.call_date);
        `,
        q1002: `
            SELECT
                CASE
                        WHEN HOUR(a.event_time) < 9 THEN '～9時'
                        WHEN HOUR(a.event_time) = 9 THEN '9時ー10時'
                        WHEN HOUR(a.event_time) = 10 THEN '10時ー11時'
                        WHEN HOUR(a.event_time) = 11 THEN '11時ー12時'
                        WHEN HOUR(a.event_time) = 12 THEN '12時ー13時'
                        WHEN HOUR(a.event_time) = 13 THEN '13時ー14時'
                        WHEN HOUR(a.event_time) = 14 THEN '14時ー15時'
                        WHEN HOUR(a.event_time) = 15 THEN '15時ー16時'
                        WHEN HOUR(a.event_time) = 16 THEN '16時ー17時'
                        WHEN HOUR(a.event_time) = 17 THEN '17時ー18時'
                        WHEN HOUR(a.event_time) = 18 THEN '18時ー19時'
                        WHEN HOUR(a.event_time) = 19 THEN '19時ー20時'
                    ELSE '20時～'
                END AS time_by_hour,
                COUNT(DISTINCT a.user) AS total_users,
                IFNULL(r.length_in_sec, IFNULL(a.talk_sec, l.length_in_sec)) AS total_talk_time,
                COUNT(distinct l.uniqueid) as number_of_calls,
                SUM(CASE WHEN l.status NOT IN ('IVR', 'LIVE', 'TIMEOT', 'GONE', 'DROP', 'AFTHRS', 'QUEUE') THEN 1 ELSE 0 END) AS number_of_responses,
                SUM(CASE WHEN l.status NOT IN ('IVR', 'LIVE', 'TIMEOT', 'GONE', 'DROP', 'AFTHRS', 'QUEUE') THEN 1 ELSE 0 END) / COUNT(*) * 100 AS response_rate_percentage,
                SUM(CASE WHEN l.status = 'AFTHRS' THEN 1 ELSE 0 END) AS number_of_outside_hours,
                SUM(CASE WHEN l.status = 'GONE' THEN 1 ELSE 0 END) AS number_of_leave,
                SUM(CASE WHEN l.status = 'TIMEOT' THEN 1 ELSE 0 END) AS number_of_time_out,
                SUM(CASE WHEN l.status = 'DROP' THEN 1 ELSE 0 END) AS number_of_abandoned,
                AVG(a.talk_sec) as att,
                AVG(a.dispo_sec) as aht,
                AVG(l.length_in_sec) as asa,
                SUM(a.dispo_sec) as post_processing_time
            FROM 
                frdcall_log l
            JOIN 
                frdcall_agent_log a ON l.user = a.user
            JOIN (
                SELECT SUM(length_in_sec) as length_in_sec, user FROM recording_log WHERE user IN('#P:0#') group by user
                ) r ON l.user = r.user
            WHERE 
                l.user IN('#P:0#') AND
                l.call_date BETWEEN "#P:1#" AND "#P:2#"
            GROUP BY
                CASE
                    WHEN HOUR(a.event_time) < 9 THEN '～9時'
                    WHEN HOUR(a.event_time) = 9 THEN '9時ー10時'
                    WHEN HOUR(a.event_time) = 10 THEN '10時ー11時'
                    WHEN HOUR(a.event_time) = 11 THEN '11時ー12時'
                    WHEN HOUR(a.event_time) = 12 THEN '12時ー13時'
                    WHEN HOUR(a.event_time) = 13 THEN '13時ー14時'
                    WHEN HOUR(a.event_time) = 14 THEN '14時ー15時'
                    WHEN HOUR(a.event_time) = 15 THEN '15時ー16時'
                    WHEN HOUR(a.event_time) = 16 THEN '16時ー17時'
                    WHEN HOUR(a.event_time) = 17 THEN '17時ー18時'
                    WHEN HOUR(a.event_time) = 18 THEN '18時ー19時'
                    WHEN HOUR(a.event_time) = 19 THEN '19時ー20時'
                ELSE '20時～'
                END
                `,
        q1003: `
            SELECT 
                cl.*, 
                us.full_name, 
                coalesce(cst.status_name, st.status_name) AS status_name,
                coalesce(cst.human_answered, st.human_answered) AS human_answered,
                coalesce(cst.sale, st.sale) AS sale,
                coalesce(cst.dnc, st.dnc) AS dnc,
                coalesce(cst.unworkable, st.unworkable) AS unworkable,
                coalesce(cst.completed, st.completed) AS completed,
                coalesce(cst.category, st.category) AS category
            FROM frdcall_log cl
            LEFT JOIN (SELECT user,full_name FROM frdcall_users) us USING(user)
            LEFT JOIN (SELECT status, status_name, human_answered, sale, dnc, customer_contact, unworkable, completed, category FROM frdcall_statuses) st USING(status)
            LEFT JOIN (SELECT status, campaign_id, status_name, human_answered, sale, dnc, customer_contact, unworkable, completed, category FROM frdcall_campaign_statuses WHERE campaign_id IN ('#P:3#')) cst USING(status, campaign_id)
            WHERE 
                (cl.call_date >= '#P:0# 00:00:00' AND cl.call_date <= '#P:1# 23:59:59') 
                -- AND user_group IN ('#P:2#')
                AND campaign_id COLLATE utf8_general_ci IN ('#P:3#')
                AND user IN ('#P:4#');
        `,
        q1004: `
            SELECT 
                cl.*,
                al.*,
                us.full_name, 
                coalesce(cst.status_name, st.status_name) AS status_name
            FROM frdcall_closer_log cl
            LEFT JOIN (SELECT user,full_name FROM frdcall_users) us USING(user)
            LEFT JOIN (SELECT status, status_name FROM frdcall_statuses) st USING(status)
            LEFT JOIN (SELECT status, user_group, status_name FROM (SELECT user_group,status,status_name FROM frdcall_campaign_statuses LEFT JOIN (SELECT campaign_id, user_group FROM frdcall_campaigns)a USING(campaign_id) WHERE campaign_id IN ('#P:3#')
            GROUP BY user_group,status)b) cst USING(status, user_group)
            LEFT JOIN (SELECT uniqueid, wait_sec, talk_sec, dispo_sec FROM frdcall_agent_log WHERE event_time >= '#P:0# 00:00:00' AND event_time <= '#P:1# 23:59:59' ) al USING(uniqueid)
            WHERE 
                (cl.call_date >= '#P:0# 00:00:00' AND cl.call_date <= '#P:1# 23:59:59') 
                -- AND user_group IN ('#P:2#')
                AND campaign_id COLLATE utf8_general_ci IN ('#P:3#')
                AND user IN ('#P:4#');
        `,
        q1005: `
            INSERT INTO frdcall_remote_agents (user_start,number_of_lines,server_ip,conf_exten,status,campaign_id,closer_campaigns,extension_group,extension_group_order,on_hook_agent,on_hook_ring_time) 
            values('#P:0#','1','#P:1#','#P:0#','ACTIVE','#P:2#','#P:3# OPERATORQUE -',"NONE","NONE","Y", 15);
            `,
        q1006: `
            INSERT INTO frdcall_extension_groups (extension_group_id, extension, campaign_groups) VALUES("#P:0#", "#P:0#", "#P:1#");
            `,
        q1007: `UPDATE recording_log rl SET dispo_form = '#P:1#' WHERE lead_id = '#P:0#' AND start_time >= DATE_SUB(CURRENT_DATE, INTERVAL 1 DAY) #P:2# ORDER BY start_time DESC LIMIT 1`,
        q1008: `SELECT name, file, create_user, update_user, create_datetime, update_datetime, delete_datetime FROM frdcall_layouts WHERE customer_id IN ('#P:0#') AND is_delete = "0";`,
        q1009: `INSERT INTO frdcall_layouts (customer_id, name, file, create_user, update_user, create_datetime, update_datetime, delete_datetime, is_delete) VALUES("#P:0#","#P:2#","#P:3#","#P:1#","#P:1#",NOW(),NOW(),null,"0")`,
        q1010: `UPDATE frdcall_layouts SET update_user = '#P:1#', update_datetime = NOW() WHERE file = '#P:0#' AND is_delete = "0" LIMIT 1`,
        q1011: `UPDATE frdcall_layouts SET is_delete = "1" WHERE file = '#P:0#' AND is_delete = "0" LIMIT 1`,
        q1012: `SELECT customer_id AS id FROM frdcall_layouts WHERE is_delete = "0";`,
        q1100: (p0, p1, p2) => getUpdateQuery(p0, p1, p2),
        q1101: `SELECT CAST(extend_col->>'$."35_crmid"' AS UNSIGNED) FROM frdcall_list_extend WHERE lead_id = '#P:0#' AND JSON_VALID(extend_col) = 1  LIMIT 1;`,
        q1102: `SELECT fla.user, lsc.channel FROM frdcall_live_agents fla LEFT JOIN live_sip_channels lsc ON lsc.extension = fla.conf_exten  WHERE fla.user IN (#P:0#) AND lsc.channel IS NULL`,
        q1103: `SELECT op_audio_display FROM frdcall_user_features WHERE user_id = "#P:0#" AND is_delete = 0 LIMIT 1;`,
        q1104: `SELECT fla.user FROM live_sip_channels lsc LEFT JOIN frdcall_live_agents fla ON lsc.extension = fla.conf_exten WHERE lsc.channel LIKE 'Local%' AND fla.user IN (#P:0#)`,
    }
} as const
// -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
const getUpdateQuery = (key, value, crmid) => {
    let sql = ""
    if (key !== "extend_col") {
        if (key !== "last_name") {

        } else if (key !== "last_name_kana") {

        } else {

        }
        sql = `UPDATE risu.${columnOfCRM_table[key]} SET ${columnOfCRM[key]} = '${value}' WHERE contactid = '${crmid}' LIMIT 1`;

    }
    return sql
}
// -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
const getValidityGroupList = (target, loginId, additionalCondition) => {
    let sql = ""
    // const { userLevel } = selector(state => state.app)
    const viewableCampaignTable =
        // キャンペーンに所属するアイテムの取り方:グループの管理対象のキャンペーン
        `
        (
            SELECT 
                CONCAT( ' ', GROUP_CONCAT(DISTINCT(a.campaign_id) separator ' '),' ' )as viewable
            FROM 
                frdcall_campaigns a 
            WHERE 
                EXISTS(
                    SELECT 1 
                    FROM frdcall_user_groups b 
                    WHERE (LOCATE(CONCAT(' ', a.user_group, ' '), b.admin_viewable_groups) 
                    OR LOCATE('-ALL-', b.admin_viewable_groups) BETWEEN 1 AND 5)
                    AND b.user_group = (
                        SELECT user_group
                        FROM frdcall_users
                        WHERE user='${loginId}'
                        LIMIT 1
                        )
                )
        )
    `

    switch (target) {
        case "UNDIFINED":
            sql = `SELECT 1 WHERE false`
            break
        case "USER":
            sql = `SELECT frdcall_users.user AS id, frdcall_users.full_name AS name
                    FROM frdcall_users
                    INNER JOIN(
                        SELECT admin_viewable_groups as viewable
                        FROM (
                            SELECT user_group
                            FROM frdcall_users
                            WHERE user='${loginId}'
                            ) AS frdcall_users
                        LEFT JOIN frdcall_user_groups
                        ON frdcall_users.user_group = frdcall_user_groups.user_group
                        ) AS view_groups
                    ON LOCATE('-ALL-', view_groups.viewable) BETWEEN 1 AND 5
                    OR LOCATE(CONCAT(' ', frdcall_users.user_group, ' '), view_groups.viewable) > 0`
            break
        case "AGENT_GROUP":
            sql = `SELECT frdcall_user_groups.user_group AS id, frdcall_user_groups.group_name AS name
                    FROM frdcall_user_groups
                    INNER JOIN(
                        SELECT agent_status_viewable_groups as viewable
                        FROM (
                            SELECT user_group
                            FROM frdcall_users
                            WHERE user='${loginId}'
                            ) AS frdcall_users
                        LEFT JOIN frdcall_user_groups
                        ON frdcall_users.user_group = frdcall_user_groups.user_group
                        ) AS view_groups
                    ON LOCATE('-ALL-', view_groups.viewable) BETWEEN 1 AND 5
                    OR LOCATE(CONCAT(' ', frdcall_user_groups.user_group, ' '), view_groups.viewable) > 0`
            break
        case "ADMIN_GROUP":
            sql = `SELECT frdcall_user_groups.user_group AS id, frdcall_user_groups.group_name AS name
                    FROM frdcall_user_groups
                    INNER JOIN(
                        SELECT admin_viewable_groups as viewable
                        FROM (
                            SELECT user_group
                            FROM frdcall_users
                            WHERE user='${loginId}'
                            ) AS frdcall_users
                        LEFT JOIN frdcall_user_groups
                        ON frdcall_users.user_group = frdcall_user_groups.user_group
                        ) AS view_groups
                    ON LOCATE('-ALL-', view_groups.viewable) BETWEEN 1 AND 5
                    OR LOCATE(CONCAT(' ', frdcall_user_groups.user_group, ' '), view_groups.viewable) > 0`
            break
        case "CAMP":
            sql = `SELECT frdcall_campaigns.campaign_id AS id, frdcall_campaigns.campaign_name AS name
                    FROM frdcall_campaigns
                    INNER JOIN${viewableCampaignTable} AS view_groups
                    ON LOCATE(CONCAT(' ', frdcall_campaigns.campaign_id, ' '), view_groups.viewable) > 0
                    WHERE frdcall_campaigns.campaign_id <> '53804164'`
            break
        case "INBOUND":
            sql = `SELECT DISTINCT group_id AS id, group_name AS name
                    FROM(
                        SELECT closer_campaigns
                        FROM frdcall_campaigns
                        INNER JOIN${viewableCampaignTable} AS view_groups
                        ON LOCATE(CONCAT(' ', frdcall_campaigns.campaign_id, ' '), view_groups.viewable) > 0
                        WHERE frdcall_campaigns.campaign_id <> '53804164' ${additionalCondition ? additionalCondition.inbound || "" : ""}
                    )a
                    INNER JOIN frdcall_inbound_groups b
                    ON LOCATE(CONCAT(' ', b.group_id, ' '), a.closer_campaigns) > 0`
            break
        case "LIST":
            sql = `SELECT frdcall_lists.list_id AS id, frdcall_lists.list_name AS name
                    FROM frdcall_lists
                    INNER JOIN${viewableCampaignTable} AS view_groups
                    ON LOCATE(CONCAT(' ', frdcall_lists.campaign_id, ' '), view_groups.viewable) > 0
                    WHERE frdcall_lists.campaign_id <> '53804164'`
            break
        case "STATUS":
            sql = `SELECT status AS id,status_name AS name
                    FROM frdcall_statuses
                    UNION ALL
                    SELECT frdcall_campaign_statuses.status AS id, frdcall_campaign_statuses.status_name AS name
                    FROM frdcall_campaign_statuses
                    INNER JOIN${viewableCampaignTable} AS view_groups
                    ON LOCATE(CONCAT(' ', frdcall_campaign_statuses.campaign_id, ' '), view_groups.viewable) > 0
                    WHERE frdcall_campaign_statuses.campaign_id <> '53804164'`
            break
        case "CAMP_STATUS":
            sql = `SELECT frdcall_campaign_statuses.status AS id, frdcall_campaign_statuses.status_name AS name
                    FROM frdcall_campaign_statuses
                    INNER JOIN${viewableCampaignTable} AS view_groups
                    ON LOCATE(CONCAT(' ', frdcall_campaign_statuses.campaign_id, ' '), view_groups.viewable) > 0
                    WHERE frdcall_campaign_statuses.campaign_id <> '53804164'`
            break
        case "DEBUG":
            sql = `` + `SELECT user AS id, full_name AS name FROM frdcall_users WHERE user = '${loginId}' LIMIT 1`
            break
        default:
            sql = `SELECT 1`
            break
    }
    return sql
}

export default configs
